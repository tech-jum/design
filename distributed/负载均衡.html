<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ц╖▒хЕец╡ЕхЗ║ш┤Яш╜╜хЭЗшбб | DESIGN</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/design/favicon.ico">
    <meta name="description" content="DESIGN">
    
    <link rel="preload" href="/design/assets/css/0.styles.3c2ef156.css" as="style"><link rel="preload" href="/design/assets/js/app.31535b90.js" as="script"><link rel="preload" href="/design/assets/js/4.843d76c1.js" as="script"><link rel="preload" href="/design/assets/js/37.48dcf161.js" as="script"><link rel="preload" href="/design/assets/js/5.eb6f8f38.js" as="script"><link rel="prefetch" href="/design/assets/js/10.07f2584d.js"><link rel="prefetch" href="/design/assets/js/11.df166aa0.js"><link rel="prefetch" href="/design/assets/js/12.b7ade635.js"><link rel="prefetch" href="/design/assets/js/13.151414b4.js"><link rel="prefetch" href="/design/assets/js/14.5dd04c5d.js"><link rel="prefetch" href="/design/assets/js/15.14e9a635.js"><link rel="prefetch" href="/design/assets/js/16.8728dd67.js"><link rel="prefetch" href="/design/assets/js/17.1686b754.js"><link rel="prefetch" href="/design/assets/js/18.d815545e.js"><link rel="prefetch" href="/design/assets/js/19.d846ce2f.js"><link rel="prefetch" href="/design/assets/js/20.1dd8edb9.js"><link rel="prefetch" href="/design/assets/js/21.38ae8c29.js"><link rel="prefetch" href="/design/assets/js/22.26dcb0f5.js"><link rel="prefetch" href="/design/assets/js/23.d996c1df.js"><link rel="prefetch" href="/design/assets/js/24.84573b57.js"><link rel="prefetch" href="/design/assets/js/25.362291b4.js"><link rel="prefetch" href="/design/assets/js/26.287f6746.js"><link rel="prefetch" href="/design/assets/js/27.665cd644.js"><link rel="prefetch" href="/design/assets/js/28.2d373aaa.js"><link rel="prefetch" href="/design/assets/js/29.18195cfe.js"><link rel="prefetch" href="/design/assets/js/30.b8a39bf2.js"><link rel="prefetch" href="/design/assets/js/31.e6497a3e.js"><link rel="prefetch" href="/design/assets/js/32.7c78886f.js"><link rel="prefetch" href="/design/assets/js/33.3a07575c.js"><link rel="prefetch" href="/design/assets/js/34.53801173.js"><link rel="prefetch" href="/design/assets/js/35.fe943393.js"><link rel="prefetch" href="/design/assets/js/36.e9ecc031.js"><link rel="prefetch" href="/design/assets/js/38.bc65c12c.js"><link rel="prefetch" href="/design/assets/js/39.76a7947c.js"><link rel="prefetch" href="/design/assets/js/40.57c60fe7.js"><link rel="prefetch" href="/design/assets/js/41.64d1acff.js"><link rel="prefetch" href="/design/assets/js/42.2b13267e.js"><link rel="prefetch" href="/design/assets/js/43.bc12e4a9.js"><link rel="prefetch" href="/design/assets/js/44.05348389.js"><link rel="prefetch" href="/design/assets/js/45.a821f14b.js"><link rel="prefetch" href="/design/assets/js/46.4f6121ee.js"><link rel="prefetch" href="/design/assets/js/47.2331491d.js"><link rel="prefetch" href="/design/assets/js/48.e99e2990.js"><link rel="prefetch" href="/design/assets/js/49.97ac4425.js"><link rel="prefetch" href="/design/assets/js/50.9561222b.js"><link rel="prefetch" href="/design/assets/js/51.5a3682fc.js"><link rel="prefetch" href="/design/assets/js/52.41f6da09.js"><link rel="prefetch" href="/design/assets/js/53.f3cbdb44.js"><link rel="prefetch" href="/design/assets/js/54.b64ed791.js"><link rel="prefetch" href="/design/assets/js/55.0b2515c6.js"><link rel="prefetch" href="/design/assets/js/56.f87ff124.js"><link rel="prefetch" href="/design/assets/js/57.c351d3a3.js"><link rel="prefetch" href="/design/assets/js/58.68c1d0ee.js"><link rel="prefetch" href="/design/assets/js/59.8cc7450d.js"><link rel="prefetch" href="/design/assets/js/6.cbcf7f30.js"><link rel="prefetch" href="/design/assets/js/60.f2f8871f.js"><link rel="prefetch" href="/design/assets/js/61.8922cbcd.js"><link rel="prefetch" href="/design/assets/js/62.ccb7c5ee.js"><link rel="prefetch" href="/design/assets/js/63.8191a330.js"><link rel="prefetch" href="/design/assets/js/64.1d881bbb.js"><link rel="prefetch" href="/design/assets/js/65.f4089278.js"><link rel="prefetch" href="/design/assets/js/66.66cf1b40.js"><link rel="prefetch" href="/design/assets/js/67.27e2cf6f.js"><link rel="prefetch" href="/design/assets/js/68.6a688bec.js"><link rel="prefetch" href="/design/assets/js/69.f59b5cd7.js"><link rel="prefetch" href="/design/assets/js/7.159ffade.js"><link rel="prefetch" href="/design/assets/js/70.aa52fe1c.js"><link rel="prefetch" href="/design/assets/js/71.f7f17e5c.js"><link rel="prefetch" href="/design/assets/js/72.f0a76070.js"><link rel="prefetch" href="/design/assets/js/73.b454f9b3.js"><link rel="prefetch" href="/design/assets/js/74.748903ca.js"><link rel="prefetch" href="/design/assets/js/75.1abb30fc.js"><link rel="prefetch" href="/design/assets/js/76.38081e86.js"><link rel="prefetch" href="/design/assets/js/77.631fd31e.js"><link rel="prefetch" href="/design/assets/js/78.b642c4ea.js"><link rel="prefetch" href="/design/assets/js/79.09f8c9ad.js"><link rel="prefetch" href="/design/assets/js/8.bbc07c86.js"><link rel="prefetch" href="/design/assets/js/80.15162b19.js"><link rel="prefetch" href="/design/assets/js/81.0a02424d.js"><link rel="prefetch" href="/design/assets/js/82.0a6de1bd.js"><link rel="prefetch" href="/design/assets/js/83.8bd118c7.js"><link rel="prefetch" href="/design/assets/js/84.c9db97ea.js"><link rel="prefetch" href="/design/assets/js/85.ea23932a.js"><link rel="prefetch" href="/design/assets/js/86.a70e5ac7.js"><link rel="prefetch" href="/design/assets/js/9.c3d97cd4.js"><link rel="prefetch" href="/design/assets/js/vendors~flowchart.5fa23d41.js"><link rel="prefetch" href="/design/assets/js/vendors~notification.4b668bb8.js">
    <link rel="stylesheet" href="/design/assets/css/0.styles.3c2ef156.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/design/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="DESIGN" class="logo"> <span class="site-name can-hide">DESIGN</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/design/architecture/" class="nav-link">
  цЮ╢цЮД
</a></div><div class="nav-item"><a href="/design/distributed/" class="nav-link router-link-active">
  хИЖх╕Гх╝П
</a></div><div class="nav-item"><a href="/design/pattern/" class="nav-link">
  шо╛шобцибх╝П
</a></div><div class="nav-item"><a href="/design/refactor/" class="nav-link">
  щЗНцЮД
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ЁЯОп хНЪхов
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/design" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/design/architecture/" class="nav-link">
  цЮ╢цЮД
</a></div><div class="nav-item"><a href="/design/distributed/" class="nav-link router-link-active">
  хИЖх╕Гх╝П
</a></div><div class="nav-item"><a href="/design/pattern/" class="nav-link">
  шо╛шобцибх╝П
</a></div><div class="nav-item"><a href="/design/refactor/" class="nav-link">
  щЗНцЮД
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ЁЯОп хНЪхов
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/design" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ц╖▒хЕец╡ЕхЗ║ш┤Яш╜╜хЭЗшбб</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_1-ш┤Яш╜╜хЭЗшббчоАф╗Л" class="sidebar-link">1. ш┤Яш╜╜хЭЗшббчоАф╗Л</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_1-1-хдзхЮЛч╜СчлЩщЭвф╕┤чЪДцМСцИШ" class="sidebar-link">1.1. хдзхЮЛч╜СчлЩщЭвф╕┤чЪДцМСцИШ</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_1-2-ф╗Аф╣ИцШпш┤Яш╜╜хЭЗшбб" class="sidebar-link">1.2. ф╗Аф╣ИцШпш┤Яш╜╜хЭЗшбб</a></li></ul></li><li><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_2-ш┤Яш╜╜хЭЗшббчЪДхИЖч▒╗" class="sidebar-link">2. ш┤Яш╜╜хЭЗшббчЪДхИЖч▒╗</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_2-1-ш╜╜ф╜Уч╗┤х║жхИЖч▒╗" class="sidebar-link">2.1. ш╜╜ф╜Уч╗┤х║жхИЖч▒╗</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_2-2-ч╜Сч╗ЬщАЪф┐бхИЖч▒╗" class="sidebar-link">2.2. ч╜Сч╗ЬщАЪф┐бхИЖч▒╗</a></li></ul></li><li><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_3-ш┤Яш╜╜хЭЗшббчоЧц│Х" class="sidebar-link">3. ш┤Яш╜╜хЭЗшббчоЧц│Х</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_3-1-щЪПцЬ║" class="sidebar-link">3.1. щЪПцЬ║</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_3-2-ш╜ошпв" class="sidebar-link">3.2. ш╜ошпв</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_3-3-цЬАх░Пц┤╗ш╖ГцХ░" class="sidebar-link">3.3. цЬАх░Пц┤╗ш╖ГцХ░</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_3-4-хУИх╕М" class="sidebar-link">3.4. хУИх╕М</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_3-5-ф╕АшЗ┤цАзхУИх╕М" class="sidebar-link">3.5. ф╕АшЗ┤цАзхУИх╕М</a></li></ul></li><li><a href="/design/distributed/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html#_4-хПВшАГш╡ДцЦЩ" class="sidebar-link">4. хПВшАГш╡ДцЦЩ</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ц╖▒хЕец╡ЕхЗ║ш┤Яш╜╜хЭЗшбб"><a href="#ц╖▒хЕец╡ЕхЗ║ш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> ц╖▒хЕец╡ЕхЗ║ш┤Яш╜╜хЭЗшбб</h1> <blockquote><p>ЁЯУж цЬмцЦЗх╖▓х╜ТцбгхИ░я╝ЪуАМ<a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer">blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>уАН</p></blockquote> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200528155252.png" alt="img"></p> <ul><li><a href="#1-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%80%E4%BB%8B">1. ш┤Яш╜╜хЭЗшббчоАф╗Л</a> <ul><li><a href="#11-%E5%A4%A7%E5%9E%8B%E7%BD%91%E7%AB%99%E9%9D%A2%E4%B8%B4%E7%9A%84%E6%8C%91%E6%88%98">1.1. хдзхЮЛч╜СчлЩщЭвф╕┤чЪДцМСцИШ</a></li> <li><a href="#12-%E4%BB%80%E4%B9%88%E6%98%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">1.2. ф╗Аф╣ИцШпш┤Яш╜╜хЭЗшбб</a></li></ul></li> <li><a href="#2-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%9A%84%E5%88%86%E7%B1%BB">2. ш┤Яш╜╜хЭЗшббчЪДхИЖч▒╗</a> <ul><li><a href="#21-%E8%BD%BD%E4%BD%93%E7%BB%B4%E5%BA%A6%E5%88%86%E7%B1%BB">2.1. ш╜╜ф╜Уч╗┤х║жхИЖч▒╗</a></li> <li><a href="#22-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E5%88%86%E7%B1%BB">2.2. ч╜Сч╗ЬщАЪф┐бхИЖч▒╗</a></li></ul></li> <li><a href="#3-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95">3. ш┤Яш╜╜хЭЗшббчоЧц│Х</a> <ul><li><a href="#31-%E9%9A%8F%E6%9C%BA">3.1. щЪПцЬ║</a></li> <li><a href="#32-%E8%BD%AE%E8%AF%A2">3.2. ш╜ошпв</a></li> <li><a href="#33-%E6%9C%80%E5%B0%8F%E6%B4%BB%E8%B7%83%E6%95%B0">3.3. цЬАх░Пц┤╗ш╖ГцХ░</a></li> <li><a href="#34-%E6%BA%90%E5%9C%B0%E5%9D%80%E5%93%88%E5%B8%8C">3.4. ц║РхЬ░хЭАхУИх╕М</a></li> <li><a href="#35-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C">3.5. ф╕АшЗ┤цАзхУИх╕М</a></li></ul></li> <li><a href="#4-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">4. хПВшАГш╡ДцЦЩ</a></li></ul> <h2 id="_1-ш┤Яш╜╜хЭЗшббчоАф╗Л"><a href="#_1-ш┤Яш╜╜хЭЗшббчоАф╗Л" class="header-anchor">#</a> 1. ш┤Яш╜╜хЭЗшббчоАф╗Л</h2> <h3 id="_1-1-хдзхЮЛч╜СчлЩщЭвф╕┤чЪДцМСцИШ"><a href="#_1-1-хдзхЮЛч╜СчлЩщЭвф╕┤чЪДцМСцИШ" class="header-anchor">#</a> 1.1. хдзхЮЛч╜СчлЩщЭвф╕┤чЪДцМСцИШ</h3> <p>хдзхЮЛч╜СчлЩщГ╜шжБщЭвхп╣х║ЮхдзчЪДчФицИ╖щЗПя╝МщлШх╣╢хПСя╝Мц╡╖щЗПцХ░цНочнЙцМСцИШуАВ</p> <p>ф╕║ф║ЖцПРхНЗч│╗ч╗ЯцХ┤ф╜УчЪДцАзшГ╜я╝МхПпф╗ещЗЗчФихЮВчЫ┤цЙйх▒ХхТМц░┤х╣│цЙйх▒Хф╕дчзНцЦ╣х╝ПуАВ</p> <ul><li><strong>хЮВчЫ┤цЙйх▒Х</strong>я╝ЪхЬич╜СчлЩхПСх▒ХцЧйцЬЯя╝МхПпф╗еф╗ОхНХцЬ║чЪДшзТх║жщАЪш┐З<strong>хвЮхКачбмф╗╢хдДчРЖшГ╜хКЫ</strong>я╝МцпФхжВ CPU хдДчРЖшГ╜хКЫя╝МхЖЕхнШхо╣щЗПя╝МчгБчЫШчнЙцЦ╣щЭвя╝МхоЮчО░цЬНхКбхЩихдДчРЖшГ╜хКЫчЪДцПРхНЗуАВф╜ЖцШпя╝МхНХцЬ║цШпцЬЙцАзшГ╜чУ╢щвИчЪДя╝Мф╕АцЧжшзжхПКчУ╢щвИя╝МхЖНцГ│цПРхНЗя╝Мф╗ШхЗ║чЪДцИРцЬмхТМф╗гф╗╖ф╝ЪцЮБщлШуАВш┐ЩцШ╛чД╢ф╕НшГ╜ц╗бш╢│хдзхЮЛхИЖх╕Гх╝Пч│╗ч╗Яя╝Ич╜СчлЩя╝ЙцЙАцЬЙх║Фхп╣чЪДхдзц╡БщЗПя╝МщлШх╣╢хПСя╝Мц╡╖щЗПцХ░цНочнЙцМСцИШуАВ</li> <li><strong>ц░┤х╣│цЙйх▒Х</strong>я╝ЪщАЪш┐ЗщЫЖч╛дцЭехИЖцЛЕхдзхЮЛч╜СчлЩчЪДц╡БщЗПуАВщЫЖч╛дф╕нчЪДх║ФчФицЬНхКбхЩия╝ИшКВчВ╣я╝ЙщАЪх╕╕швлшо╛шобцИРцЧачК╢цАБя╝МчФицИ╖хПпф╗ешп╖ц▒Вф╗╗ф╜Хф╕Аф╕кшКВчВ╣я╝Мш┐Щф║ЫшКВчВ╣хЕ▒хРМхИЖцЛЕшо┐щЧохОЛхКЫуАВц░┤х╣│цЙйх▒ХцЬЙф╕дф╕кшжБчВ╣я╝Ъ
<ul><li><strong>х║ФчФищЫЖч╛д</strong>я╝Ъх░ЖхРМф╕Ах║ФчФищГич╜▓хИ░хдЪхП░цЬ║хЩиф╕Кя╝Мч╗ДцИРхдДчРЖщЫЖч╛дя╝МцОецФ╢ш┤Яш╜╜хЭЗшббшо╛хдЗхИЖхПСчЪДшп╖ц▒Вя╝Мш┐ЫшбМхдДчРЖя╝Мх╣╢ш┐ФхЫЮчЫ╕х║ФцХ░цНоуАВ</li> <li><strong>ш┤Яш╜╜хЭЗшбб</strong>я╝Ъх░ЖчФицИ╖шо┐щЧошп╖ц▒Вя╝МщАЪш┐ЗцЯРчзНчоЧц│Хя╝МхИЖхПСхИ░щЫЖч╛дф╕нчЪДшКВчВ╣уАВ</li></ul></li></ul> <h3 id="_1-2-ф╗Аф╣ИцШпш┤Яш╜╜хЭЗшбб"><a href="#_1-2-ф╗Аф╣ИцШпш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> 1.2. ф╗Аф╣ИцШпш┤Яш╜╜хЭЗшбб</h3> <p>ш┤Яш╜╜хЭЗшббя╝ИLoad Balanceя╝МчоАчз░ LBя╝ЙцШпщлШх╣╢хПСуАБщлШхПпчФич│╗ч╗Ях┐Еф╕НхПпх░СчЪДхЕ│щФоч╗Дф╗╢я╝МчЫоцаЗцШп <strong>х░╜хКЫх░Жч╜Сч╗Ьц╡БщЗПх╣│хЭЗхИЖхПСхИ░хдЪф╕кцЬНхКбхЩиф╕Кя╝Мф╗ецПРщлШч│╗ч╗ЯцХ┤ф╜УчЪДхУНх║ФщАЯх║жхТМхПпчФицАз</strong>уАВ</p> <p>ш┤Яш╜╜хЭЗшббчЪДф╕╗шжБф╜ЬчФихжВф╕Ля╝Ъ</p> <ul><li><strong>щлШх╣╢хПС</strong>я╝Ъш┤Яш╜╜хЭЗшббщАЪш┐ЗчоЧц│Хш░ГцХ┤ш┤Яш╜╜я╝Мх░╜хКЫхЭЗхМАчЪДхИЖщЕНх║ФчФищЫЖч╛дф╕нхРДшКВчВ╣чЪДх╖еф╜ЬщЗПя╝Мф╗ецндцПРщлШх║ФчФищЫЖч╛дчЪДх╣╢хПСхдДчРЖшГ╜хКЫя╝ИхРЮхРРщЗПя╝ЙуАВ</li> <li><strong>ф╝╕ч╝йцАз</strong>я╝Ъц╖╗хКацИЦхЗПх░СцЬНхКбхЩицХ░щЗПя╝МчД╢хРОчФ▒ш┤Яш╜╜хЭЗшббш┐ЫшбМхИЖхПСцОзхИ╢уАВш┐Щф╜┐х╛Чх║ФчФищЫЖч╛дхЕ╖хдЗф╝╕ч╝йцАзуАВ</li> <li><strong>щлШхПпчФи</strong>я╝Ъш┤Яш╜╜хЭЗшббхЩихПпф╗ечЫСцОзхАЩщАЙцЬНхКбхЩия╝Мх╜УцЬНхКбхЩиф╕НхПпчФицЧ╢я╝МшЗкхКиш╖│ш┐Зя╝Мх░Жшп╖ц▒ВхИЖхПСч╗ЩхПпчФичЪДцЬНхКбхЩиуАВш┐Щф╜┐х╛Чх║ФчФищЫЖч╛дхЕ╖хдЗщлШхПпчФичЪДчЙ╣цАзуАВ</li> <li><strong>хоЙхЕищШ▓цКд</strong>я╝ЪцЬЙф║Ыш┤Яш╜╜хЭЗшббш╜пф╗╢цИЦчбмф╗╢цПРф╛Ыф║ЖхоЙхЕицАзхКЯшГ╜я╝МхжВя╝Ъщ╗СчЩ╜хРНхНХхдДчРЖуАБщШ▓чБлхвЩя╝МщШ▓ DDos цФ╗хЗ╗чнЙуАВ</li></ul> <h2 id="_2-ш┤Яш╜╜хЭЗшббчЪДхИЖч▒╗"><a href="#_2-ш┤Яш╜╜хЭЗшббчЪДхИЖч▒╗" class="header-anchor">#</a> 2. ш┤Яш╜╜хЭЗшббчЪДхИЖч▒╗</h2> <p>цФпцМБш┤Яш╜╜хЭЗшббчЪДцКАцЬпх╛ИхдЪя╝МцИСф╗мхПпф╗ещАЪш┐Зф╕НхРМч╗┤х║жхО╗ш┐ЫшбМхИЖч▒╗уАВ</p> <h3 id="_2-1-ш╜╜ф╜Уч╗┤х║жхИЖч▒╗"><a href="#_2-1-ш╜╜ф╜Уч╗┤х║жхИЖч▒╗" class="header-anchor">#</a> 2.1. ш╜╜ф╜Уч╗┤х║жхИЖч▒╗</h3> <p>ф╗ОцФпцМБш┤Яш╜╜хЭЗшббчЪДш╜╜ф╜УцЭечЬЛя╝МхПпф╗ех░Жш┤Яш╜╜хЭЗшббхИЖф╕║ф╕дч▒╗я╝Ъ</p> <ul><li>чбмф╗╢ш┤Яш╜╜хЭЗшбб</li> <li>ш╜пф╗╢ш┤Яш╜╜хЭЗшбб</li></ul> <h4 id="чбмф╗╢ш┤Яш╜╜хЭЗшбб"><a href="#чбмф╗╢ш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> чбмф╗╢ш┤Яш╜╜хЭЗшбб</h4> <p>чбмф╗╢ш┤Яш╜╜хЭЗшббя╝Мф╕АшИмцШпхЬихоЪхИ╢хдДчРЖхЩиф╕Кш┐РшбМчЪДчЛмчлЛш┤Яш╜╜хЭЗшббцЬНхКбхЩия╝М<strong>ф╗╖ца╝цШВш┤╡я╝МхЬЯш▒кф╕Ух▒Ю</strong>уАВ</p> <p>чбмф╗╢ш┤Яш╜╜хЭЗшббчЪД <strong>ф╕╗ц╡Бф║зхУБ</strong> цЬЙя╝Ъ<a href="https://f5.com/zh" target="_blank" rel="noopener noreferrer">F5<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> хТМ <a href="https://www.a10networks.com.cn/" target="_blank" rel="noopener noreferrer">A10<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>уАВ</p> <p>чбмф╗╢ш┤Яш╜╜хЭЗшббчЪД <strong>ф╝ШчВ╣</strong>я╝Ъ</p> <ul><li><strong>хКЯшГ╜х╝║хдз</strong>я╝ЪцФпцМБхЕих▒Аш┤Яш╜╜хЭЗшббх╣╢цПРф╛Ыш╛ГхЕищЭвчЪДуАБхдНцЭВчЪДш┤Яш╜╜хЭЗшббчоЧц│ХуАВ</li> <li><strong>цАзшГ╜х╝║цВН</strong>я╝Ъчбмф╗╢ш┤Яш╜╜хЭЗшббчФ▒ф║ОцШпхЬиф╕УчФихдДчРЖхЩиф╕Кш┐РшбМя╝МхЫацндхРЮхРРщЗПхдзя╝МхПпцФпцМБхНХцЬ║чЩ╛ф╕Зф╗еф╕КчЪДх╣╢хПСуАВ</li> <li><strong>хоЙхЕицАзщлШ</strong>я╝Ъх╛Ах╛АхЕ╖хдЗщШ▓чБлхвЩя╝МщШ▓ DDos цФ╗хЗ╗чнЙхоЙхЕихКЯшГ╜уАВ</li></ul> <p>чбмф╗╢ш┤Яш╜╜хЭЗшббчЪД <strong>ч╝║чВ╣</strong>я╝Ъ</p> <ul><li><strong>цИРцЬмцШВш┤╡</strong>я╝Ъш┤нф╣░хТМч╗┤цКдчбмф╗╢ш┤Яш╜╜хЭЗшббчЪДцИРцЬмщГ╜х╛ИщлШуАВ</li> <li><strong>цЙйх▒ХцАзх╖о</strong>я╝Ъх╜Ушо┐щЧощЗПчкБхвЮцЧ╢я╝Мш╢Еш┐ЗщЩРх║жф╕НшГ╜хКицАБцЙйхо╣уАВ</li></ul> <h4 id="ш╜пф╗╢ш┤Яш╜╜хЭЗшбб"><a href="#ш╜пф╗╢ш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> ш╜пф╗╢ш┤Яш╜╜хЭЗшбб</h4> <p>ш╜пф╗╢ш┤Яш╜╜хЭЗшббя╝М<strong>х║ФчФицЬАх╣┐ц│Ы</strong>я╝МцЧашо║хдзхЕмхП╕ш┐ШцШпх░ПхЕмхП╕щГ╜ф╝Ъф╜┐чФиуАВ</p> <p>ш╜пф╗╢ш┤Яш╜╜хЭЗшббф╗Ош╜пф╗╢х▒ВщЭвхоЮчО░ш┤Яш╜╜хЭЗшббя╝Мф╕АшИмхПпф╗ехЬиф╗╗ф╜ХцаЗхЗЖчЙйчРЖшо╛хдЗф╕Кш┐РшбМуАВ</p> <p>ш╜пф╗╢ш┤Яш╜╜хЭЗшббчЪД <strong>ф╕╗ц╡Бф║зхУБ</strong> цЬЙя╝Ъ<a href="https://www.nginx.com/" target="_blank" rel="noopener noreferrer">Nginx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>уАБ<a href="http://www.haproxy.org/" target="_blank" rel="noopener noreferrer">HAProxy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>уАБ<a href="https://github.com/alibaba/LVS" target="_blank" rel="noopener noreferrer">LVS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>уАВ</p> <ul><li><a href="https://github.com/alibaba/LVS" target="_blank" rel="noopener noreferrer">LVS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> хПпф╗еф╜Ьф╕║хЫЫх▒Вш┤Яш╜╜хЭЗшббхЩиуАВхЕ╢ш┤Яш╜╜хЭЗшббчЪДцАзшГ╜шжБф╝Шф║О NginxуАВ</li> <li><a href="http://www.haproxy.org/" target="_blank" rel="noopener noreferrer">HAProxy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> хПпф╗еф╜Ьф╕║ HTTP хТМ TCP ш┤Яш╜╜хЭЗшббхЩиуАВ</li> <li><a href="https://www.nginx.com/" target="_blank" rel="noopener noreferrer">Nginx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>уАБ<a href="http://www.haproxy.org/" target="_blank" rel="noopener noreferrer">HAProxy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> хПпф╗еф╜Ьф╕║хЫЫх▒ВцИЦф╕Гх▒Вш┤Яш╜╜хЭЗшббхЩиуАВ</li></ul> <p>ш╜пф╗╢ш┤Яш╜╜хЭЗшббчЪД <strong>ф╝ШчВ╣</strong>я╝Ъ</p> <ul><li><strong>цЙйх▒ХцАзхе╜</strong>я╝ЪщАВх║ФхКицАБхПШхМЦя╝МхПпф╗ещАЪш┐Зц╖╗хКаш╜пф╗╢ш┤Яш╜╜хЭЗшббхоЮф╛Ля╝МхКицАБцЙйх▒ХхИ░ш╢ЕхЗ║хИЭхзЛхо╣щЗПчЪДшГ╜хКЫуАВ</li> <li><strong>цИРцЬмф╜Ох╗Й</strong>я╝Ъш╜пф╗╢ш┤Яш╜╜хЭЗшббхПпф╗ехЬиф╗╗ф╜ХцаЗхЗЖчЙйчРЖшо╛хдЗф╕Кш┐РшбМя╝МщЩНф╜Оф║Жш┤нф╣░хТМш┐Рч╗┤чЪДцИРцЬмуАВ</li></ul> <p>ш╜пф╗╢ш┤Яш╜╜хЭЗшббчЪД <strong>ч╝║чВ╣</strong>я╝Ъ</p> <ul><li><strong>цАзшГ╜чХех╖о</strong>я╝ЪчЫ╕цпФф║Очбмф╗╢ш┤Яш╜╜хЭЗшббя╝Мш╜пф╗╢ш┤Яш╜╜хЭЗшббчЪДцАзшГ╜шжБчХеф╜Оф╕Аф║ЫуАВ</li></ul> <h3 id="_2-2-ч╜Сч╗ЬщАЪф┐бхИЖч▒╗"><a href="#_2-2-ч╜Сч╗ЬщАЪф┐бхИЖч▒╗" class="header-anchor">#</a> 2.2. ч╜Сч╗ЬщАЪф┐бхИЖч▒╗</h3> <p>ш╜пф╗╢ш┤Яш╜╜хЭЗшббф╗ОщАЪф┐бх▒ВщЭвцЭечЬЛя╝МхПИхПпф╗ехИЖф╕║хЫЫх▒ВхТМф╕Гх▒Вш┤Яш╜╜хЭЗшббуАВ</p> <ul><li>ф╕Гх▒Вш┤Яш╜╜хЭЗшббя╝Ъх░▒цШпхПпф╗еца╣цНошо┐щЧочФицИ╖чЪД HTTP шп╖ц▒Вхд┤уАБURL ф┐бцБпх░Жшп╖ц▒Вш╜мхПСхИ░чЙ╣хоЪчЪДф╕╗цЬ║уАВ
<ul><li>DNS щЗНхоЪхРС</li> <li>HTTP щЗНхоЪхРС</li> <li>хПНхРСф╗гчРЖ</li></ul></li> <li>хЫЫх▒Вш┤Яш╜╜хЭЗшббя╝ЪхЯ║ф║О IP хЬ░хЭАхТМчлпхПгш┐ЫшбМшп╖ц▒ВчЪДш╜мхПСуАВ
<ul><li>ф┐оцФ╣ IP хЬ░хЭА</li> <li>ф┐оцФ╣ MAC хЬ░хЭА</li></ul></li></ul> <h4 id="dns-ш┤Яш╜╜хЭЗшбб"><a href="#dns-ш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> DNS ш┤Яш╜╜хЭЗшбб</h4> <p>DNS ш┤Яш╜╜хЭЗшббф╕АшИмчФиф║Оф║ТшБФч╜СхЕмхП╕я╝МхдНцЭВчЪДф╕ЪхКбч│╗ч╗Яф╕НщАВхРИф╜┐чФиуАВхдзхЮЛч╜СчлЩф╕АшИмф╜┐чФи DNS ш┤Яш╜╜хЭЗшббф╜Ьф╕║ <strong>чммф╕Ач║зш┤Яш╜╜хЭЗшббцЙЛцо╡</strong>я╝МчД╢хРОхЬихЖЕщГиф╜┐чФихЕ╢хоГцЦ╣х╝ПхБЪчммф║Мч║зш┤Яш╜╜хЭЗшббуАВDNS ш┤Яш╜╜хЭЗшббх▒Юф║Оф╕Гх▒Вш┤Яш╜╜хЭЗшббуАВ</p> <p>DNS хН│ <strong>хЯЯхРНшзгцЮРцЬНхКб</strong>я╝МцШп OSI чммф╕Гх▒Вч╜Сч╗ЬхНПшооуАВDNS швлшо╛шобф╕║ф╕Аф╕кцаСх╜вч╗УцЮДчЪДхИЖх╕Гх╝Пх║ФчФия╝МшЗкф╕КшАМф╕Лф╛Эцмбф╕║я╝Ъца╣хЯЯхРНцЬНхКбхЩия╝Мф╕Ач║зхЯЯхРНцЬНхКбхЩия╝Мф║Мч║зхЯЯхРНцЬНхКбхЩия╝М... я╝МцЬмхЬ░хЯЯхРНцЬНхКбхЩиуАВцШ╛чД╢я╝МхжВцЮЬцЙАцЬЙцХ░цНощГ╜хнШхВихЬица╣хЯЯхРНцЬНхКбхЩия╝МщВгф╣И DNS цЯешпвчЪДш┤Яш╜╜хТМх╝АщФАф╝ЪщЭЮх╕╕х║ЮхдзуАВ</p> <p>хЫацндя╝МDNS цЯешпвчЫ╕хп╣ф║О DNS х▒Вч║зч╗УцЮДя╝МцШпф╕Аф╕кщАЖхРСчЪДщАТх╜Тц╡БчиЛя╝МDNS ховцИ╖члпф╛Эцмбшп╖ц▒ВцЬмхЬ░ DNS цЬНхКбхЩия╝Мф╕Кф╕Ач║з DNS цЬНхКбхЩия╝Мф╕Кф╕Кф╕Ач║з DNS цЬНхКбхЩия╝М... я╝Мца╣ DNS цЬНхКбхЩия╝ИхПИхПлцЭГхиБ DNS цЬНхКбхЩия╝Йя╝Мф╕АцЧжхС╜ф╕ня╝МчлЛхН│ш┐ФхЫЮуАВф╕║ф║ЖхЗПх░СцЯешпвцмбцХ░я╝МцпПф╕Ач║з DNS цЬНхКбхЩищГ╜ф╝Ъшо╛ч╜о DNS цЯешпвч╝УхнШуАВ</p> <p>DNS ш┤Яш╜╜хЭЗшббчЪДх╖еф╜ЬхОЯчРЖх░▒цШпя╝Ъ<strong>хЯ║ф║О DNS цЯешпвч╝УхнШя╝МцМЙчЕзш┤Яш╜╜цГЕхЖ╡ш┐ФхЫЮф╕НхРМцЬНхКбхЩичЪД IP хЬ░хЭА</strong>уАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210117220007.png" alt="img"></p> <p>DNS щЗНхоЪхРСчЪД <strong>ф╝ШчВ╣</strong>я╝Ъ</p> <ul><li><strong>ф╜┐чФичоАхНХ</strong>я╝Ъш┤Яш╜╜хЭЗшббх╖еф╜Ья╝Мф║дч╗Щ DNS цЬНхКбхЩихдДчРЖя╝МчЬБцОЙф║Жш┤Яш╜╜хЭЗшббцЬНхКбхЩич╗┤цКдчЪДщ║╗чГж</li> <li><strong>цПРщлШцАзшГ╜</strong>я╝ЪхПпф╗ецФпцМБхЯ║ф║ОхЬ░хЭАчЪДхЯЯхРНшзгцЮРя╝МшзгцЮРцИРш╖Эчж╗чФицИ╖цЬАш┐СчЪДцЬНхКбхЩихЬ░хЭАя╝Ич▒╗ф╝╝ CDN чЪДхОЯчРЖя╝Йя╝МхПпф╗ехКах┐лшо┐щЧощАЯх║жя╝МцФ╣хЦДцАзшГ╜я╝Ы</li></ul> <p>DNS щЗНхоЪхРСчЪД <strong>ч╝║чВ╣</strong>я╝Ъ</p> <ul><li><strong>хПпчФицАзх╖о</strong>я╝ЪDNS шзгцЮРцШпхдЪч║зшзгцЮРя╝МцЦ░хвЮ/ф┐оцФ╣ DNS хРОя╝МшзгцЮРцЧ╢щЧ┤ш╛ГщХ┐я╝ЫшзгцЮРш┐ЗчиЛф╕ня╝МчФицИ╖шо┐щЧоч╜СчлЩх░Жхд▒ш┤ея╝Ы</li> <li><strong>цЙйх▒ХцАзф╜О</strong>я╝ЪDNS ш┤Яш╜╜хЭЗшббчЪДцОзхИ╢цЭГхЬихЯЯхРНхХЖщВгщЗМя╝МцЧац│Ххп╣хЕ╢хБЪцЫ┤хдЪчЪДцФ╣хЦДхТМцЙйх▒Хя╝Ы</li> <li><strong>ч╗┤цКдцАзх╖о</strong>я╝Ъф╣Яф╕НшГ╜хПНцШацЬНхКбхЩичЪДх╜УхЙНш┐РшбМчК╢цАБя╝ЫцФпцМБчЪДчоЧц│Хх░Ся╝Ыф╕НшГ╜хМ║хИЖцЬНхКбхЩичЪДх╖ох╝Вя╝Иф╕НшГ╜ца╣цНоч│╗ч╗Яф╕ОцЬНхКбчЪДчК╢цАБцЭехИдцЦнш┤Яш╜╜я╝Й</li></ul> <h4 id="http-ш┤Яш╜╜хЭЗшбб"><a href="#http-ш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> HTTP ш┤Яш╜╜хЭЗшбб</h4> <p><strong>HTTP ш┤Яш╜╜хЭЗшббцШпхЯ║ф║О HTTP щЗНхоЪхРСхоЮчО░чЪД</strong>уАВHTTP ш┤Яш╜╜хЭЗшббх▒Юф║Оф╕Гх▒Вш┤Яш╜╜хЭЗшббуАВ</p> <p>HTTP щЗНхоЪхРСхОЯчРЖцШпя╝Ъ<strong>ца╣цНочФицИ╖чЪД HTTP шп╖ц▒ВшобчоЧхЗ║ф╕Аф╕кчЬЯхоЮчЪДцЬНхКбхЩихЬ░хЭАя╝Мх░ЖшпецЬНхКбхЩихЬ░хЭАхЖЩхЕе HTTP щЗНхоЪхРСхУНх║Фф╕ня╝Мш┐ФхЫЮч╗Щц╡ПшзИхЩия╝МчФ▒ц╡ПшзИхЩищЗНцЦ░ш┐ЫшбМшо┐щЧо</strong>уАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210117220310.png" alt="img"></p> <p>HTTP щЗНхоЪхРСчЪД <strong>ф╝ШчВ╣</strong>я╝Ъ<strong>цЦ╣цбИчоАхНХ</strong>уАВ</p> <p>HTTP щЗНхоЪхРСчЪД <strong>ч╝║чВ╣</strong>я╝Ъ</p> <ul><li><strong>цАзшГ╜ш╛Гх╖о</strong>я╝ЪцпПцмбшо┐щЧощЬАшжБф╕дцмбшп╖ц▒ВцЬНхКбхЩия╝МхвЮхКаф║Жшо┐щЧочЪДх╗╢ш┐ЯуАВ</li> <li><strong>щЩНф╜ОцРЬч┤вцОТхРН</strong>я╝Ъф╜┐чФищЗНхоЪхРСхРОя╝МцРЬч┤вх╝ХцУОф╝ЪшзЖф╕║ SEO ф╜Ьх╝КуАВ</li> <li>хжВцЮЬш┤Яш╜╜хЭЗшббхЩихоХцЬ║я╝Мх░▒цЧац│Хшо┐щЧошпечлЩчВ╣уАВ</li></ul> <p>чФ▒ф║ОхЕ╢ч╝║чВ╣цпФш╛ГцШОцШ╛я╝МцЙАф╗еш┐ЩчзНш┤Яш╜╜хЭЗшббчнЦчХехоЮщЩЕх║ФчФиш╛Гх░СуАВ</p> <h4 id="хПНхРСф╗гчРЖш┤Яш╜╜хЭЗшбб"><a href="#хПНхРСф╗гчРЖш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> хПНхРСф╗гчРЖш┤Яш╜╜хЭЗшбб</h4> <p>хПНхРСф╗гчРЖя╝ИReverse Proxyя╝ЙцЦ╣х╝ПцШпцМЗф╗е <strong>ф╗гчРЖцЬНхКбхЩи</strong> цЭецОехПЧч╜Сч╗Ьшп╖ц▒Вя╝МчД╢хРО <strong>х░Жшп╖ц▒Вш╜мхПСч╗ЩхЖЕч╜Сф╕нчЪДцЬНхКбхЩи</strong>я╝Мх╣╢х░Жф╗ОхЖЕч╜Сф╕нчЪДцЬНхКбхЩиф╕Кх╛ЧхИ░чЪДч╗УцЮЬш┐ФхЫЮч╗Щч╜Сч╗Ьшп╖ц▒ВчЪДховцИ╖члпуАВхПНхРСф╗гчРЖш┤Яш╜╜хЭЗшббх▒Юф║Оф╕Гх▒Вш┤Яш╜╜хЭЗшббуАВ</p> <p>хПНхРСф╗гчРЖцЬНхКбчЪДф╕╗ц╡Бф║зхУБя╝Ъ<strong>Nginx</strong>уАБ<strong>Apache</strong>уАВ</p> <p>цнгхРСф╗гчРЖф╕ОхПНхРСф╗гчРЖцЬЙф╗Аф╣ИхМ║хИля╝Я</p> <ul><li>цнгхРСф╗гчРЖя╝ЪхПСчФЯхЬи <strong>ховцИ╖члп</strong>я╝МцШпчФ▒чФицИ╖ф╕╗хКихПСш╡╖чЪДуАВч┐╗хвЩш╜пф╗╢х░▒цШпхЕ╕хЮЛчЪДцнгхРСф╗гчРЖя╝МховцИ╖члпщАЪш┐Зф╕╗хКишо┐щЧоф╗гчРЖцЬНхКбхЩия╝Мшойф╗гчРЖцЬНхКбхЩишО╖х╛ЧщЬАшжБчЪДхдЦч╜СцХ░цНоя╝МчД╢хРОш╜мхПСхЫЮховцИ╖члпуАВ</li> <li>хПНхРСф╗гчРЖя╝ЪхПСчФЯхЬи <strong>цЬНхКбчлп</strong>я╝МчФицИ╖ф╕НчЯещБУф╗гчРЖчЪДхнШхЬиуАВ</li></ul> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210117222209.png" alt="img"></p> <p>хПНхРСф╗гчРЖцШпхжВф╜ХхоЮчО░ш┤Яш╜╜хЭЗшббчЪДхСвя╝Яф╗е Nginx ф╕║ф╛Ля╝МхжВф╕ЛцЙАчд║я╝Ъ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/web/nginx/nginx-load-balance.png" alt="img"></p> <p>щжЦхЕИя╝МхЬиф╗гчРЖцЬНхКбхЩиф╕Кшо╛хоЪхе╜ш┤Яш╜╜хЭЗшббшзДхИЩуАВчД╢хРОя╝Мх╜УцФ╢хИ░ховцИ╖члпшп╖ц▒Вя╝МхПНхРСф╗гчРЖцЬНхКбхЩицЛжцИкцМЗхоЪчЪДхЯЯхРНцИЦ IP шп╖ц▒Вя╝Мца╣цНош┤Яш╜╜хЭЗшббчоЧц│Хя╝Мх░Жшп╖ц▒ВхИЖхПСхИ░хАЩщАЙцЬНхКбхЩиф╕КуАВхЕ╢цмбя╝МхжВцЮЬцЯРхП░хАЩщАЙцЬНхКбхЩихоХцЬ║я╝МхПНхРСф╗гчРЖцЬНхКбхЩиф╝ЪцЬЙхо╣щФЩхдДчРЖя╝МцпФхжВхИЖхПСшп╖ц▒Вхд▒ш┤е 3 цмбф╗еф╕Кя╝Мх░Жшп╖ц▒ВхИЖхПСхИ░хЕ╢ф╗ЦхАЩщАЙцЬНхКбхЩиф╕КуАВ</p> <p>хПНхРСф╗гчРЖчЪД <strong>ф╝ШчВ╣</strong>я╝Ъ</p> <ul><li><strong>хдЪчзНш┤Яш╜╜хЭЗшббчоЧц│Х</strong>я╝ЪцФпцМБхдЪчзНш┤Яш╜╜хЭЗшббчоЧц│Хя╝Мф╗ех║Фхп╣ф╕НхРМчЪДхЬ║цЩпщЬАц▒ВуАВ</li> <li><strong>хПпф╗ечЫСцОзцЬНхКбхЩи</strong>я╝ЪхЯ║ф║О HTTP хНПшооя╝МхПпф╗ечЫСцОзш╜мхПСцЬНхКбхЩичЪДчК╢цАБя╝МхжВя╝Ъч│╗ч╗Яш┤Яш╜╜уАБхУНх║ФцЧ╢щЧ┤уАБцШпхРжхПпчФиуАБш┐ЮцОецХ░уАБц╡БщЗПчнЙя╝Мф╗ОшАМца╣цНош┐Щф║ЫцХ░цНош░ГцХ┤ш┤Яш╜╜хЭЗшббчЪДчнЦчХеуАВ</li></ul> <p>хПНхРСф╗гчРЖчЪД <strong>ч╝║чВ╣</strong>я╝Ъ</p> <ul><li><p><strong>щвЭхдЦчЪДш╜мхПСх╝АщФА</strong>я╝ЪхПНхРСф╗гчРЖчЪДш╜мхПСцУНф╜ЬцЬмш║лцШпцЬЙцАзшГ╜х╝АщФАчЪДя╝МхПпшГ╜ф╝ЪхМЕцЛмхИЫх╗║ш┐ЮцОея╝МчнЙх╛Еш┐ЮцОехУНх║Фя╝МхИЖцЮРхУНх║Фч╗УцЮЬчнЙцУНф╜ЬуАВ</p></li> <li><p><strong>хвЮхКач│╗ч╗ЯхдНцЭВх║ж</strong>я╝ЪхПНхРСф╗гчРЖх╕╕чФиф║ОхБЪхИЖх╕Гх╝Пх║ФчФичЪДц░┤х╣│цЙйх▒Хя╝Мф╜ЖхПНхРСф╗гчРЖцЬНхКбхнШхЬиф╗еф╕ЛщЧощвШя╝Мф╕║ф║ЖшзгхЖ│ф╗еф╕ЛщЧощвШф╝Ъч╗Щч│╗ч╗ЯцХ┤ф╜УхвЮхКащвЭхдЦчЪДхдНцЭВх║жхТМш┐Рч╗┤цИРцЬмя╝Ъ</p> <ul><li>хПНхРСф╗гчРЖцЬНхКбхжВцЮЬшЗкш║лхоХцЬ║я╝Мх░▒цЧац│Хшо┐щЧочлЩчВ╣я╝МцЙАф╗ещЬАшжБцЬЙ <strong>щлШхПпчФи</strong> цЦ╣цбИя╝Мх╕╕шзБчЪДцЦ╣цбИцЬЙя╝Ъф╕╗хдЗцибх╝Пя╝Иф╕Аф╕╗ф╕АхдЗя╝ЙуАБхПМф╕╗цибх╝Пя╝Иф║Тф╕║ф╕╗хдЗя╝ЙуАВ</li> <li>хПНхРСф╗гчРЖцЬНхКбшЗкш║лф╣ЯхнШхЬицАзшГ╜чУ╢щвИя╝МщЪПчЭАщЬАшжБш╜мхПСчЪДшп╖ц▒ВщЗПф╕НцЦнцФАхНЗя╝МщЬАшжБцЬЙ <strong>хПпцЙйх▒Х</strong> цЦ╣цбИуАВ</li></ul></li></ul> <h4 id="ip-ш┤Яш╜╜хЭЗшбб"><a href="#ip-ш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> IP ш┤Яш╜╜хЭЗшбб</h4> <p>IP ш┤Яш╜╜хЭЗшббцШпхЬич╜Сч╗Ьх▒ВщАЪш┐Зф┐оцФ╣шп╖ц▒ВчЫочЪДхЬ░хЭАш┐ЫшбМш┤Яш╜╜хЭЗшббуАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210119000529.png" alt="img"></p> <p>хжВф╕КхЫ╛цЙАчд║я╝МIP хЭЗшббхдДчРЖц╡БчиЛхдзшЗ┤ф╕║я╝Ъ</p> <ol><li>ховцИ╖члпшп╖ц▒В 192.168.137.10я╝МчФ▒ш┤Яш╜╜хЭЗшббцЬНхКбхЩицОецФ╢хИ░цКецЦЗуАВ</li> <li>ш┤Яш╜╜хЭЗшббцЬНхКбхЩица╣цНочоЧц│ХщАЙхЗ║ф╕Аф╕кцЬНхКбшКВчВ╣ 192.168.0.1я╝МчД╢хРОх░ЖцКецЦЗшп╖ц▒ВхЬ░хЭАцФ╣ф╕║шпешКВчВ╣чЪД IPуАВ</li> <li>чЬЯхоЮцЬНхКбшКВчВ╣цФ╢хИ░шп╖ц▒ВцКецЦЗя╝МхдДчРЖхРОя╝Мш┐ФхЫЮхУНх║ФцХ░цНохИ░ш┤Яш╜╜хЭЗшббцЬНхКбхЩиуАВ</li> <li>ш┤Яш╜╜хЭЗшббцЬНхКбхЩих░ЖхУНх║ФцХ░цНочЪДц║РхЬ░хЭАцФ╣ш┤Яш╜╜хЭЗшббцЬНхКбхЩихЬ░хЭАя╝Мш┐ФхЫЮч╗ЩховцИ╖члпуАВ</li></ol> <p>IP ш┤Яш╜╜хЭЗшббхЬихЖЕца╕ш┐ЫчиЛхоМцИРцХ░цНохИЖхПСя╝Мш╛ГхПНхРСф╗гчРЖш┤Яш╜╜хЭЗшббцЬЙцЫ┤хе╜чЪДф╗ОхдДчРЖцАзшГ╜уАВф╜ЖцШпя╝МчФ▒ф║ОцЙАцЬЙшп╖ц▒ВхУНх║ФщГ╜шжБч╗Пш┐Зш┤Яш╜╜хЭЗшббцЬНхКбхЩия╝МщЫЖч╛дчЪДхРЮхРРщЗПхПЧхИ╢ф║Ош┤Яш╜╜хЭЗшббцЬНхКбхЩичЪДх╕жхо╜уАВ</p> <h4 id="цХ░цНощУ╛ш╖пх▒Вш┤Яш╜╜хЭЗшбб"><a href="#цХ░цНощУ╛ш╖пх▒Вш┤Яш╜╜хЭЗшбб" class="header-anchor">#</a> цХ░цНощУ╛ш╖пх▒Вш┤Яш╜╜хЭЗшбб</h4> <p>цХ░цНощУ╛ш╖пх▒Вш┤Яш╜╜хЭЗшббцШпцМЗхЬищАЪф┐бхНПшоочЪДцХ░цНощУ╛ш╖пх▒Вф┐оцФ╣ mac хЬ░хЭАш┐ЫшбМш┤Яш╜╜хЭЗшббуАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210117222127.png" alt="img"></p> <p>хЬи Linux х╣│хП░ф╕КцЬАхе╜чЪДщУ╛ш╖пх▒Вш┤Яш╜╜хЭЗшббх╝Ац║Рф║зхУБцШп LVS (Linux Virtual Server)уАВ</p> <p>LVS цШпхЯ║ф║О Linux хЖЕца╕ф╕н netfilter цбЖцЮ╢хоЮчО░чЪДш┤Яш╜╜хЭЗшббч│╗ч╗ЯуАВnetfilter цШпхЖЕца╕цАБчЪД Linux щШ▓чБлхвЩцЬ║хИ╢я╝МхПпф╗ехЬицХ░цНохМЕц╡Бч╗Пш┐ЗчиЛф╕ня╝Мца╣цНошзДхИЩшо╛ч╜ошЛех╣▓ф╕кхЕ│хНбя╝Иhook хЗ╜цХ░я╝ЙцЭецЙзшбМчЫ╕хЕ│чЪДцУНф╜ЬуАВ</p> <p>LVS чЪДх╖еф╜Ьц╡БчиЛхдзшЗ┤хжВф╕Ля╝Ъ</p> <ul><li>х╜УчФицИ╖шо┐щЧо www.sina.com.cn цЧ╢я╝МчФицИ╖цХ░цНощАЪш┐Зх▒Вх▒Вч╜Сч╗Ья╝МцЬАхРОщАЪш┐Зф║дцНвцЬ║ш┐ЫхЕе LVS цЬНхКбхЩич╜СхНбя╝Мх╣╢ш┐ЫхЕехЖЕца╕ч╜Сч╗Ьх▒ВуАВ</li> <li>ш┐ЫхЕе PREROUTING хРОч╗Пш┐Зш╖пчФ▒цЯецЙ╛я╝МчбохоЪшо┐щЧочЪДчЫочЪД VIP цШпцЬмцЬ║ IP хЬ░хЭАя╝МцЙАф╗ецХ░цНохМЕш┐ЫхЕехИ░ INPUT щУ╛ф╕К</li> <li>IPVS цШпх╖еф╜ЬхЬи INPUT щУ╛ф╕Кя╝Мф╝Ъца╣цНошо┐щЧочЪД <code>vip+port</code> хИдцЦншп╖ц▒ВцШпхРж IPVS цЬНхКбя╝МхжВцЮЬцШпхИЩш░ГчФиц│ихЖМчЪД IPVS HOOK хЗ╜цХ░я╝Мш┐ЫшбМ IPVS чЫ╕хЕ│ф╕╗ц╡БчиЛя╝Мх╝║шбМф┐оцФ╣цХ░цНохМЕчЪДчЫ╕хЕ│цХ░цНоя╝Мх╣╢х░ЖцХ░цНохМЕхПСх╛А POSTROUTING щУ╛ф╕КуАВ</li> <li>POSTROUTING ф╕КцФ╢хИ░цХ░цНохМЕхРОя╝Мца╣цНочЫоцаЗ IP хЬ░хЭАя╝ИхРОчлпцЬНхКбхЩия╝Йя╝МщАЪш┐Зш╖пчФ▒щАЙш╖пя╝Мх░ЖцХ░цНохМЕцЬАч╗ИхПСх╛АхРОчлпчЪДцЬНхКбхЩиф╕КуАВ</li></ul> <p>х╝Ац║Р LVS чЙИцЬмцЬЙ 3 чзНх╖еф╜Ьцибх╝Пя╝МцпПчзНцибх╝Пх╖еф╜ЬхОЯчРЖцИкчД╢ф╕НхРМя╝Мшп┤хРДчзНцибх╝ПщГ╜цЬЙшЗкх╖▒чЪДф╝Шч╝║чВ╣я╝МхИЖхИлщАВхРИф╕НхРМчЪДх║ФчФихЬ║цЩпя╝Мф╕Нш┐ЗцЬАч╗ИцЬмш┤ичЪДхКЯшГ╜щГ╜цШпшГ╜хоЮчО░хЭЗшббчЪДц╡БщЗПш░Гх║жхТМшЙпхе╜чЪДцЙйх▒ХцАзуАВф╕╗шжБхМЕцЛмф╕ЙчзНцибх╝Пя╝ЪDR цибх╝ПуАБNAT цибх╝ПуАБTunnel цибх╝ПуАВ</p> <h2 id="_3-ш┤Яш╜╜хЭЗшббчоЧц│Х"><a href="#_3-ш┤Яш╜╜хЭЗшббчоЧц│Х" class="header-anchor">#</a> 3. ш┤Яш╜╜хЭЗшббчоЧц│Х</h2> <p>ш┤Яш╜╜хЭЗшббхЩичЪДхоЮчО░хПпф╗ехИЖф╕║ф╕дф╕кщГихИЖя╝Ъ</p> <ul><li>ца╣цНош┤Яш╜╜хЭЗшббчоЧц│ХхЬихАЩщАЙцЬНхКбхЩихИЧшбищАЙхЗ║ф╕Аф╕кцЬНхКбхЩия╝Ы</li> <li>х░Жшп╖ц▒ВцХ░цНохПСщАБхИ░шпецЬНхКбхЩиф╕КуАВ</li></ul> <p>ш┤Яш╜╜хЭЗшббчоЧц│ХцШпш┤Яш╜╜хЭЗшббцЬНхКбца╕х┐Гф╕нчЪДца╕х┐ГуАВш┤Яш╜╜хЭЗшббф║зхУБхдЪчзНхдЪца╖я╝Мф╜ЖцШпхРДчзНш┤Яш╜╜хЭЗшббчоЧц│ХхОЯчРЖцШпхЕ▒цАзчЪДуАВ</p> <p>ш┤Яш╜╜хЭЗшббчоЧц│ХцЬЙх╛ИхдЪчзНя╝МхИЖхИлщАВчФиф║Оф╕НхРМчЪДх║ФчФихЬ║цЩпя╝МцЬмцЦЗф╗Еф╗Лч╗НцЬАф╕║х╕╕шзБчЪДш┤Яш╜╜хЭЗшббчоЧц│ХчЪДчЙ╣цАзхПКхОЯчРЖя╝Ъш╜ошпвуАБщЪПцЬ║уАБцЬАх░Пц┤╗ш╖ГцХ░уАБц║РхЬ░хЭАхУИх╕МуАБф╕АшЗ┤цАзхУИх╕МуАВ</p> <blockquote><p>ц│ия╝Ъш┤Яш╜╜хЭЗшббчоЧц│ХчЪДхоЮчО░я╝МцОишНРщШЕшп╗ <a href="https://dubbo.apache.org/zh/docs/v2.7/dev/source/loadbalance/" target="_blank" rel="noopener noreferrer">Dubbo хоШцЦ╣ш┤Яш╜╜хЭЗшббчоЧц│Хшп┤цШО<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> я╝Мц║РчаБшо▓шзгщЭЮх╕╕шпжч╗Жя╝МщЭЮх╕╕хА╝х╛ЧхАЯщЙ┤уАВ</p> <p>ф╕ЛцЦЗф╕нчЪДхРДчзНчоЧц│ХчЪДхПпцЙзшбМчд║ф╛Лх╖▓х╜ТцбгхЬи Github ф╗Ух║Уя╝Ъhttps://github.com/dunwu/java-tutorial/tree/master/codes/java-distributed/java-load-balanceя╝МхПпф╗ещАЪш┐ЗцЙзшбМ io.github.dunwu.javatech.LoadBalanceDemo цЯечЬЛхРДчоЧц│ХцЙзшбМцХИцЮЬуАВ</p></blockquote> <h3 id="_3-1-щЪПцЬ║"><a href="#_3-1-щЪПцЬ║" class="header-anchor">#</a> 3.1. щЪПцЬ║</h3> <h4 id="щЪПцЬ║чоЧц│Х"><a href="#щЪПцЬ║чоЧц│Х" class="header-anchor">#</a> щЪПцЬ║чоЧц│Х</h4> <p><strong><code>щЪПцЬ║я╝ИRandomя╝Й</code></strong> чоЧц│Х <strong>х░Жшп╖ц▒ВщЪПцЬ║хИЖхПСхИ░хАЩщАЙцЬНхКбхЩи</strong>уАВ</p> <p>щЪПцЬ║чоЧц│Х <strong>щАВхРИцЬНхКбхЩичбмф╗╢чЫ╕хРМчЪДхЬ║цЩп</strong>уАВхнжф╣аш┐ЗцжВчОЗшо║чЪДщГ╜чЯещБУя╝Мш░ГчФищЗПш╛Гх░ПчЪДцЧ╢хАЩя╝МхПпшГ╜ш┤Яш╜╜х╣╢ф╕НхЭЗхМАя╝М<strong>ш░ГчФищЗПш╢Кхдзя╝Мш┤Яш╜╜ш╢КхЭЗшбб</strong>уАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210415165323.png" alt=""></p> <p>уАРчд║ф╛ЛуАСщЪПцЬ║чоЧц│ХхоЮчО░чд║ф╛Л</p> <p>ш┤Яш╜╜хЭЗшббцОехПг</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">N</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>ш┤Яш╜╜хЭЗшббцК╜ш▒бч▒╗</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">N</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// хжВцЮЬ nodes хИЧшбиф╕нф╗ЕцЬЙф╕Аф╕к nodeя╝МчЫ┤цОеш┐ФхЫЮхН│хПпя╝МцЧащЬАш┐ЫшбМш┤Яш╜╜хЭЗшбб</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token function">doSelect</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token class-name">N</span> <span class="token function">doSelect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>цЬНхКбхЩишКВчВ╣ч▒╗</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token class-name">Integer</span> weight<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token class-name">Integer</span> active<span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>щЪПцЬ║чоЧц│ХхоЮчО░</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">N</span> <span class="token function">doSelect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// хЬихИЧшбиф╕нщЪПцЬ║щАЙхПЦф╕Аф╕кшКВчВ╣</span>
        <span class="token keyword">int</span> index <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="хКацЭГщЪПцЬ║чоЧц│Х"><a href="#хКацЭГщЪПцЬ║чоЧц│Х" class="header-anchor">#</a> хКацЭГщЪПцЬ║чоЧц│Х</h4> <p><strong><code>хКацЭГщЪПцЬ║я╝ИWeighted Randomя╝Й</code></strong> чоЧц│ХхЬищЪПцЬ║чоЧц│ХчЪДхЯ║чбАф╕Кя╝МцМЙчЕзцжВчОЗш░ГцХ┤цЭГщЗНя╝Мш┐ЫшбМш┤Яш╜╜хИЖщЕНуАВ</p> <p>уАРчд║ф╛ЛуАСхКацЭГщЪПцЬ║чоЧц│ХхоЮчО░чд║ф╛Л</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeightRandomLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">N</span> <span class="token function">doSelect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> length <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AtomicInteger</span> totalWeight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">N</span> node <span class="token operator">:</span> nodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Integer</span> weight <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            totalWeight<span class="token punctuation">.</span><span class="token function">getAndAdd</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>totalWeight<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> offset <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>totalWeight<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">N</span> node <span class="token operator">:</span> nodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// шойщЪПцЬ║хА╝ offset хЗПхО╗цЭГщЗНхА╝</span>
                offset <span class="token operator">-=</span> node<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// ш┐ФхЫЮчЫ╕х║ФчЪД Node</span>
                    <span class="token keyword">return</span> node<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// чЫ┤цОещЪПцЬ║ш┐ФхЫЮф╕Аф╕к</span>
        <span class="token keyword">return</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-2-ш╜ошпв"><a href="#_3-2-ш╜ошпв" class="header-anchor">#</a> 3.2. ш╜ошпв</h3> <h4 id="ш╜ошпвчоЧц│Х"><a href="#ш╜ошпвчоЧц│Х" class="header-anchor">#</a> ш╜ошпвчоЧц│Х</h4> <p><strong><code>ш╜ошпвя╝ИRound Robinя╝Й</code></strong> чоЧц│ХчЪДчнЦчХецШпя╝Ъ<strong>х░Жшп╖ц▒Вф╛ЭцмбхИЖхПСхИ░хАЩщАЙцЬНхКбхЩи</strong>уАВ</p> <p>хжВф╕ЛхЫ╛цЙАчд║я╝Мш┤Яш╜╜хЭЗшббхЩицФ╢хИ░цЭешЗкховцИ╖члпчЪД 6 ф╕кшп╖ц▒Вя╝М(1, 3, 5) чЪДшп╖ц▒Вф╝ЪшвлхПСщАБхИ░цЬНхКбхЩи 1я╝М(2, 4, 6) чЪДшп╖ц▒Вф╝ЪшвлхПСщАБхИ░цЬНхКбхЩи 2уАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210415164758.png" alt=""></p> <p>шпечоЧц│ХщАВхРИхЬ║цЩпя╝ЪхРДцЬНхКбхЩихдДчРЖшГ╜хКЫчЫ╕ш┐Ся╝Мф╕ФцпПф╕кф║ЛхКбх╖еф╜ЬщЗПх╖ох╝Вф╕НхдзуАВхжВцЮЬхнШхЬиш╛Гхдзх╖ох╝Вя╝МщВгф╣ИхдДчРЖш╛ГцЕвчЪДцЬНхКбхЩих░▒хПпшГ╜ф╝ЪчзпхОЛшп╖ц▒Вя╝МцЬАч╗ИцЧац│ХцЙ┐цЛЕш┐ЗхдзчЪДш┤Яш╜╜уАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210415165041.png" alt=""></p> <p>уАРчд║ф╛ЛуАСш╜ошпвчоЧц│Хчд║ф╛Л</p> <p>ш╜ошпвш┤Яш╜╜хЭЗшббчоЧц│ХхоЮчО░</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoundRobinLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> position <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">N</span> <span class="token function">doSelect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> length <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// хжВцЮЬф╜Нч╜охА╝х╖▓ч╗ПчнЙф║ОшКВчВ╣цХ░я╝МщЗНч╜оф╕║ 0</span>
        position<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>length<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">N</span> node <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        position<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> node<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="хКацЭГш╜ошпвчоЧц│Х"><a href="#хКацЭГш╜ошпвчоЧц│Х" class="header-anchor">#</a> хКацЭГш╜ошпвчоЧц│Х</h4> <p><strong><code>хКацЭГш╜ошпвя╝ИWeighted Round Robbinя╝Й</code></strong> чоЧц│ХхЬиш╜ошпвчоЧц│ХчЪДхЯ║чбАф╕Кя╝МхвЮхКаф║ЖцЭГщЗНх▒ЮцАзцЭеш░ГшКВш╜мхПСцЬНхКбхЩичЪДшп╖ц▒ВцХ░чЫоуАВцАзшГ╜щлШуАБхдДчРЖщАЯх║жх┐лчЪДшКВчВ╣х║Фшпешо╛ч╜оцЫ┤щлШчЪДцЭГщЗНя╝Мф╜┐х╛ЧхИЖхПСцЧ╢ф╝ШхЕИх░Жшп╖ц▒ВхИЖхПСхИ░цЭГщЗНш╛ГщлШчЪДшКВчВ╣ф╕КуАВ</p> <p>хжВф╕ЛхЫ╛цЙАчд║я╝МцЬНхКбхЩи A шо╛ч╜оцЭГщЗНф╕║ 5я╝МцЬНхКбхЩи B шо╛ч╜оцЭГщЗНф╕║ 1я╝Мш┤Яш╜╜хЭЗшббхЩицФ╢хИ░цЭешЗкховцИ╖члпчЪД 6 ф╕кшп╖ц▒Вя╝МщВгф╣И (1, 2, 3, 4, 5) шп╖ц▒Вф╝ЪшвлхПСщАБхИ░цЬНхКбхЩи Aя╝М(6) шп╖ц▒Вф╝ЪшвлхПСщАБхИ░цЬНхКбхЩи BуАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210415165140.png" alt=""></p> <p>уАРчд║ф╛ЛуАСхКацЭГш╜ошпвчоЧц│ХхоЮчО░чд║ф╛Л</p> <p>ф╗еф╕ЛхоЮчО░хЯ║ф║О Dubbo хКацЭГш╜ошпвчоЧц│ХхБЪф║Жф╕Аф║ЫчоАхМЦуАВ</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeightRoundRobinLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 60чзТ
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> RECYCLE_PERIOD <span class="token operator">=</span> <span class="token number">60000</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Node hashcode хИ░ WeightedRoundRobin чЪДцШах░ДхЕ│ч│╗
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">WeightedRoundRobin</span><span class="token punctuation">&gt;</span></span> weightMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * хОЯхнРцЫ┤цЦ░щФБ
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicBoolean</span> updateLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">N</span> <span class="token function">doSelect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> totalWeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> maxCurrent <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span>MIN_VALUE<span class="token punctuation">;</span>

        <span class="token comment">// шО╖хПЦх╜УхЙНцЧ╢щЧ┤</span>
        <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">N</span> selectedNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">WeightedRoundRobin</span> selectedWRR <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token comment">// ф╕ЛщЭвш┐Щф╕кх╛кчОпф╕╗шжБхБЪф║Жш┐Щца╖хЗаф╗╢ф║ЛцГЕя╝Ъ</span>
        <span class="token comment">//   1. щБНхОЖ Node хИЧшбия╝МцгАц╡Лх╜УхЙН Node цШпхРжцЬЙчЫ╕х║ФчЪД WeightedRoundRobinя╝Мц▓бцЬЙхИЩхИЫх╗║</span>
        <span class="token comment">//   2. цгАц╡Л Node цЭГщЗНцШпхРжхПСчФЯф║ЖхПШхМЦя╝МшЛехПШхМЦф║Жя╝МхИЩцЫ┤цЦ░ WeightedRoundRobin чЪД weight хнЧцо╡</span>
        <span class="token comment">//   3. шой current хнЧцо╡хКаф╕КшЗкш║лцЭГщЗНя╝МчнЙф╗╖ф║О current += weight</span>
        <span class="token comment">//   4. шо╛ч╜о lastUpdate хнЧцо╡я╝МхН│ lastUpdate = now</span>
        <span class="token comment">//   5. хп╗цЙ╛хЕ╖цЬЙцЬАхдз current чЪД Nodeя╝Мф╗ехПК Node хп╣х║ФчЪД WeightedRoundRobinя╝М</span>
        <span class="token comment">//      цЪВхнШш╡╖цЭея╝МчХЩф╜ЬхРОчФи</span>
        <span class="token comment">//   6. шобчоЧцЭГщЗНцА╗хТМ</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">N</span> node <span class="token operator">:</span> nodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> hashCode <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">WeightedRoundRobin</span> weightedRoundRobin <span class="token operator">=</span> weightMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>hashCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> weight <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>weight <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                weight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// цгАц╡Лх╜УхЙН Node цШпхРжцЬЙхп╣х║ФчЪД WeightedRoundRobinя╝Мц▓бцЬЙхИЩхИЫх╗║</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>weightedRoundRobin <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                weightedRoundRobin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeightedRoundRobin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// шо╛ч╜о Node цЭГщЗН</span>
                weightedRoundRobin<span class="token punctuation">.</span><span class="token function">setWeight</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// хнШхВи url хФпф╕АцаЗшпЖ identifyString хИ░ weightedRoundRobin чЪДцШах░ДхЕ│ч│╗</span>
                weightMap<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>hashCode<span class="token punctuation">,</span> weightedRoundRobin<span class="token punctuation">)</span><span class="token punctuation">;</span>
                weightedRoundRobin <span class="token operator">=</span> weightMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>hashCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Node цЭГщЗНф╕НчнЙф║О WeightedRoundRobin ф╕нф┐ЭхнШчЪДцЭГщЗНя╝Мшп┤цШОцЭГщЗНхПШхМЦф║Жя╝МцндцЧ╢ш┐ЫшбМцЫ┤цЦ░</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>weight <span class="token operator">!=</span> weightedRoundRobin<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                weightedRoundRobin<span class="token punctuation">.</span><span class="token function">setWeight</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// шой current хКаф╕КшЗкш║лцЭГщЗНя╝МчнЙф╗╖ф║О current += weight</span>
            <span class="token keyword">long</span> current <span class="token operator">=</span> weightedRoundRobin<span class="token punctuation">.</span><span class="token function">increaseCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// шо╛ч╜о lastUpdateя╝Мшбичд║ш┐СцЬЯцЫ┤цЦ░ш┐З</span>
            weightedRoundRobin<span class="token punctuation">.</span><span class="token function">setLastUpdate</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// цЙ╛хЗ║цЬАхдзчЪД current</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">&gt;</span> maxCurrent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                maxCurrent <span class="token operator">=</span> current<span class="token punctuation">;</span>
                <span class="token comment">// х░ЖхЕ╖цЬЙцЬАхдз current цЭГщЗНчЪД Node ш╡ЛхА╝ч╗Щ selectedNode</span>
                selectedNode <span class="token operator">=</span> node<span class="token punctuation">;</span>
                <span class="token comment">// х░Ж Node хп╣х║ФчЪД weightedRoundRobin ш╡ЛхА╝ч╗Щ selectedWRRя╝МчХЩф╜ЬхРОчФи</span>
                selectedWRR <span class="token operator">=</span> weightedRoundRobin<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// шобчоЧцЭГщЗНцА╗хТМ</span>
            totalWeight <span class="token operator">+=</span> weight<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// хп╣ weightMap ш┐ЫшбМцгАцЯея╝Мш┐Зц╗дцОЙщХ┐цЧ╢щЧ┤цЬкшвлцЫ┤цЦ░чЪДшКВчВ╣уАВ</span>
        <span class="token comment">// шпешКВчВ╣хПпшГ╜цМВф║Жя╝Мnodes ф╕нф╕НхМЕхРлшпешКВчВ╣я╝МцЙАф╗ешпешКВчВ╣чЪД lastUpdate щХ┐цЧ╢щЧ┤цЧац│ХшвлцЫ┤цЦ░уАВ</span>
        <span class="token comment">// шЛецЬкцЫ┤цЦ░цЧ╢щХ┐ш╢Еш┐ЗщШИхА╝хРОя╝Мх░▒ф╝Ъшвлчз╗щЩдцОЙя╝Мщ╗ШшодщШИхА╝ф╕║60чзТуАВ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>updateLock<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> weightMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>updateLock<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// щБНхОЖф┐оцФ╣я╝МхН│чз╗щЩдш┐ЗцЬЯшо░х╜Х</span>
                    weightMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeIf</span><span class="token punctuation">(</span>item <span class="token operator">-&gt;</span> now <span class="token operator">-</span> item<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLastUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> RECYCLE_PERIOD<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    updateLock<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// шой current хЗПхО╗цЭГщЗНцА╗хТМя╝МчнЙф╗╖ф║О current -= totalWeight</span>
            selectedWRR<span class="token punctuation">.</span><span class="token function">decreaseCurrent</span><span class="token punctuation">(</span>totalWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ш┐ФхЫЮхЕ╖цЬЙцЬАхдз current чЪД Node</span>
            <span class="token keyword">return</span> selectedNode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// should not happen here</span>
        <span class="token keyword">return</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WeightedRoundRobin</span> <span class="token punctuation">{</span>

        <span class="token comment">// цЬНхКбцПРф╛ЫшАЕцЭГщЗН</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> weight<span class="token punctuation">;</span>
        <span class="token comment">// х╜УхЙНцЭГщЗН</span>
        <span class="token keyword">private</span> <span class="token class-name">AtomicLong</span> current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// цЬАхРОф╕АцмбцЫ┤цЦ░цЧ╢щЧ┤</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> lastUpdate<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">increaseCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// current = current + weightя╝Ы</span>
            <span class="token keyword">return</span> current<span class="token punctuation">.</span><span class="token function">addAndGet</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">decreaseCurrent</span><span class="token punctuation">(</span><span class="token keyword">int</span> total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// current = current - total;</span>
            <span class="token keyword">return</span> current<span class="token punctuation">.</span><span class="token function">addAndGet</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> weight<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWeight</span><span class="token punctuation">(</span><span class="token keyword">int</span> weight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight<span class="token punctuation">;</span>
            <span class="token comment">// хИЭхзЛцГЕхЖ╡ф╕Ля╝Мcurrent = 0</span>
            current<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">AtomicLong</span> <span class="token function">getCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> current<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCurrent</span><span class="token punctuation">(</span><span class="token class-name">AtomicLong</span> current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> current<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getLastUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> lastUpdate<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLastUpdate</span><span class="token punctuation">(</span><span class="token keyword">long</span> lastUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lastUpdate <span class="token operator">=</span> lastUpdate<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-3-цЬАх░Пц┤╗ш╖ГцХ░"><a href="#_3-3-цЬАх░Пц┤╗ш╖ГцХ░" class="header-anchor">#</a> 3.3. цЬАх░Пц┤╗ш╖ГцХ░</h3> <p><strong><code>цЬАх░Пц┤╗ш╖ГцХ░я╝ИLeast Activeя╝Й</code></strong> чоЧц│Х <strong>х░Жшп╖ц▒ВхИЖхПСхИ░ш┐ЮцОецХ░/шп╖ц▒ВцХ░цЬАх░СчЪДхАЩщАЙцЬНхКбхЩи</strong>я╝ИчЫохЙНхдДчРЖшп╖ц▒ВцЬАх░СчЪДцЬНхКбхЩия╝ЙуАВ</p> <ul><li>чЙ╣чВ╣я╝Ъца╣цНохАЩщАЙцЬНхКбхЩих╜УхЙНчЪДшп╖ц▒Вш┐ЮцОецХ░я╝МхКицАБхИЖщЕНуАВ</li> <li>хЬ║цЩпя╝Ъ<strong>щАВчФиф║Охп╣ч│╗ч╗Яш┤Яш╜╜ш╛Гф╕║цХПцДЯцИЦшп╖ц▒Вш┐ЮцОецЧ╢щХ┐чЫ╕х╖ош╛ГхдзчЪДхЬ║цЩп</strong>уАВ</li></ul> <p>чФ▒ф║ОцпПф╕кшп╖ц▒ВчЪДш┐ЮцОецЧ╢щХ┐ф╕Нф╕Аца╖я╝МхжВцЮЬщЗЗчФичоАхНХчЪДш╜ох╛кцИЦщЪПцЬ║чоЧц│Хя╝МщГ╜хПпшГ╜хЗ║чО░<strong>цЯРф║ЫцЬНхКбхЩих╜УхЙНш┐ЮцОецХ░ш┐Зхдзя╝МшАМхПжф╕Аф║ЫцЬНхКбхЩичЪДш┐ЮцОеш┐Зх░П</strong>чЪДцГЕхЖ╡я╝Мш┐Щх░▒щАацИРф║Жш┤Яш╜╜х╣╢щЭЮчЬЯцнгхЭЗшббуАВшЩ╜чД╢я╝Мш╜ошпвцИЦчоЧц│ХщГ╜хПпф╗ещАЪш┐ЗхКацЭГщЗНх▒ЮцАзчЪДцЦ╣х╝Пш┐ЫшбМш┤Яш╜╜ш░ГцХ┤я╝Мф╜ЖхКацЭГцЦ╣х╝ПщЪ╛ф╗ех║Фхп╣хКицАБхПШхМЦуАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210415171432.png" alt=""></p> <p>цЬАх░Пц┤╗ш╖ГцХ░чоЧц│Хф╝Ъшо░х╜Хх╜УхЙНцЧ╢хИ╗я╝МцпПф╕кхАЩщАЙшКВчВ╣цнгхЬихдДчРЖчЪДш┐ЮцОецХ░я╝МчД╢хРОщАЙцЛйш┐ЮцОецХ░цЬАх░ПчЪДшКВчВ╣уАВшпечнЦчХешГ╜хдЯхКицАБуАБхоЮцЧ╢хЬ░хПНх║ФцЬНхКбхЩичЪДх╜УхЙНчК╢хЖ╡я╝Мш╛Гф╕║хРИчРЖхЬ░х░Жш┤Яш┤гхИЖщЕНхЭЗхМАя╝МщАВчФиф║Охп╣х╜УхЙНч│╗ч╗Яш┤Яш╜╜ш╛Гф╕║цХПцДЯчЪДхЬ║цЩпуАВ</p> <p>ф╛ЛхжВф╕ЛхЫ╛ф╕ня╝МцЬНхКбхЩи 1 х╜УхЙНш┐ЮцОецХ░цЬАх░Пя╝МщВгф╣ИцЦ░хИ░цЭечЪДшп╖ц▒В 6 х░▒ф╝ЪшвлхПСщАБхИ░цЬНхКбхЩи 1 ф╕КуАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210415165935.png" alt=""></p> <p>хКацЭГцЬАх░Пц┤╗ш╖ГцХ░я╝ИWeighted Least Connectionя╝ЙхЬицЬАх░Пц┤╗ш╖ГцХ░чЪДхЯ║чбАф╕Кя╝Мца╣цНоцЬНхКбхЩичЪДцАзшГ╜ф╕║цпПхП░цЬНхКбхЩихИЖщЕНцЭГщЗНя╝МхЖНца╣цНоцЭГщЗНшобчоЧхЗ║цпПхП░цЬНхКбхЩишГ╜хдДчРЖчЪДш┐ЮцОецХ░уАВ</p> <p>цЬАх░Пц┤╗ш╖ГцХ░чоЧц│ХхоЮчО░шжБчВ╣я╝Ъц┤╗ш╖Гш░ГчФицХ░ш╢Кх░Пя╝МшбицШОшпецЬНхКбшКВчВ╣хдДчРЖшГ╜хКЫш╢КщлШя╝МхНХф╜НцЧ╢щЧ┤хЖЕхПпхдДчРЖцЫ┤хдЪчЪДшп╖ц▒Вя╝Мх║Фф╝ШхЕИх░Жшп╖ц▒ВхИЖхПСч╗ЩшпецЬНхКбуАВхЬихЕ╖ф╜УхоЮчО░ф╕ня╝МцпПф╕кцЬНхКбшКВчВ╣хп╣х║Фф╕Аф╕кц┤╗ш╖ГцХ░ activeуАВхИЭхзЛцГЕхЖ╡ф╕Ля╝МцЙАцЬЙцЬНхКбцПРф╛ЫшАЕц┤╗ш╖ГцХ░хЭЗф╕║ 0уАВцпПцФ╢хИ░ф╕Аф╕кшп╖ц▒Вя╝Мц┤╗ш╖ГцХ░хКа 1я╝МхоМцИРшп╖ц▒ВхРОхИЩх░Жц┤╗ш╖ГцХ░хЗП 1уАВхЬицЬНхКбш┐РшбМф╕Ацо╡цЧ╢щЧ┤хРОя╝МцАзшГ╜хе╜чЪДцЬНхКбцПРф╛ЫшАЕхдДчРЖшп╖ц▒ВчЪДщАЯх║жцЫ┤х┐ля╝МхЫацндц┤╗ш╖ГцХ░ф╕ЛщЩНчЪДф╣Яш╢Кх┐ля╝МцндцЧ╢ш┐Щца╖чЪДцЬНхКбцПРф╛ЫшАЕшГ╜хдЯф╝ШхЕИшО╖хПЦхИ░цЦ░чЪДцЬНхКбшп╖ц▒ВуАБш┐Щх░▒цШпцЬАх░Пц┤╗ш╖ГцХ░ш┤Яш╜╜хЭЗшббчоЧц│ХчЪДхЯ║цЬмцАЭцГ│уАВ</p> <p>уАРчд║ф╛ЛуАСцЬАх░Пц┤╗ш╖ГцХ░чоЧц│ХхоЮчО░</p> <p>ф╗еф╕ЛхоЮчО░хЯ║ф║О Dubbo цЬАх░Пц┤╗ш╖ГцХ░ш┤Яш╜╜хЭЗшббчоЧц│ХхБЪф║Жф║Ышо╕цФ╣хКиуАВ</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeastActiveLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">N</span> <span class="token function">doSelect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> length <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// цЬАх░ПчЪДц┤╗ш╖ГцХ░</span>
        <span class="token keyword">int</span> leastActive <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">// хЕ╖цЬЙчЫ╕хРМтАЬцЬАх░Пц┤╗ш╖ГцХ░тАЭчЪДцЬНхКбшАЕцПРф╛ЫшАЕя╝Иф╗еф╕ЛчФи Node ф╗гчз░я╝ЙцХ░щЗП</span>
        <span class="token keyword">int</span> leastCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// leastIndexs чФиф║Ошо░х╜ХхЕ╖цЬЙчЫ╕хРМтАЬцЬАх░Пц┤╗ш╖ГцХ░тАЭчЪД Node хЬи nodes хИЧшбиф╕нчЪДф╕ЛцаЗф┐бцБп</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> leastIndexs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> totalWeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// чммф╕Аф╕кцЬАх░Пц┤╗ш╖ГцХ░чЪД Node цЭГщЗНхА╝я╝МчФиф║Оф╕ОхЕ╢ф╗ЦхЕ╖цЬЙчЫ╕хРМцЬАх░Пц┤╗ш╖ГцХ░чЪД Node чЪДцЭГщЗНш┐ЫшбМхп╣цпФя╝М</span>
        <span class="token comment">// ф╗ецгАц╡ЛцШпхРжтАЬцЙАцЬЙхЕ╖цЬЙчЫ╕хРМцЬАх░Пц┤╗ш╖ГцХ░чЪД Node чЪДцЭГщЗНтАЭхЭЗчЫ╕чнЙ</span>
        <span class="token keyword">int</span> firstWeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> sameWeight <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token comment">// щБНхОЖ nodes хИЧшби</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">N</span> node <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// хПСчО░цЫ┤х░ПчЪДц┤╗ш╖ГцХ░я╝МщЗНцЦ░х╝АхзЛ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>leastActive <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> node<span class="token punctuation">.</span><span class="token function">getActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> leastActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ф╜┐чФих╜УхЙНц┤╗ш╖ГцХ░цЫ┤цЦ░цЬАх░Пц┤╗ш╖ГцХ░ leastActive</span>
                leastActive <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// цЫ┤цЦ░ leastCount ф╕║ 1</span>
                leastCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token comment">// шо░х╜Хх╜УхЙНф╕ЛцаЗхА╝хИ░ leastIndexs ф╕н</span>
                leastIndexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
                totalWeight <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                firstWeight <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sameWeight <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                <span class="token comment">// х╜УхЙН Node чЪДц┤╗ш╖ГцХ░ node.getActive() ф╕ОцЬАх░Пц┤╗ш╖ГцХ░ leastActive чЫ╕хРМ</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">getActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> leastActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// хЬи leastIndexs ф╕ншо░х╜Хф╕Лх╜УхЙН Node хЬи nodes щЫЖхРИф╕нчЪДф╕ЛцаЗ</span>
                leastIndexs<span class="token punctuation">[</span>leastCount<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
                <span class="token comment">// ч┤пхКацЭГщЗН</span>
                totalWeight <span class="token operator">+=</span> node<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// цгАц╡Лх╜УхЙН Node чЪДцЭГщЗНф╕О firstWeight цШпхРжчЫ╕чнЙя╝М</span>
                <span class="token comment">// ф╕НчЫ╕чнЙхИЩх░Ж sameWeight ч╜оф╕║ false</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>sameWeight <span class="token operator">&amp;&amp;</span> i <span class="token operator">&gt;</span> <span class="token number">0</span>
                    <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> firstWeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    sameWeight <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// х╜УхПкцЬЙф╕Аф╕к Node хЕ╖цЬЙцЬАх░Пц┤╗ш╖ГцХ░я╝МцндцЧ╢чЫ┤цОеш┐ФхЫЮшпе Node хН│хПп</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>leastCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>leastIndexs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// цЬЙхдЪф╕к Node хЕ╖цЬЙчЫ╕хРМчЪДцЬАх░Пц┤╗ш╖ГцХ░я╝Мф╜ЖхоГф╗мф╣ЛщЧ┤чЪДцЭГщЗНф╕НхРМ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sameWeight <span class="token operator">&amp;&amp;</span> totalWeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// щЪПцЬ║чФЯцИРф╕Аф╕к [0, totalWeight) ф╣ЛщЧ┤чЪДцХ░хнЧ</span>
            <span class="token keyword">int</span> offsetWeight <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>totalWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// х╛кчОпшойщЪПцЬ║цХ░хЗПхО╗хЕ╖цЬЙцЬАх░Пц┤╗ш╖ГцХ░чЪД Node чЪДцЭГщЗНхА╝я╝М</span>
            <span class="token comment">// х╜У offset х░Пф║ОчнЙф║О0цЧ╢я╝Мш┐ФхЫЮчЫ╕х║ФчЪД Node</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> leastCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> leastIndex <span class="token operator">=</span> leastIndexs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">// шО╖хПЦцЭГщЗНхА╝я╝Мх╣╢шойщЪПцЬ║цХ░хЗПхО╗цЭГщЗНхА╝</span>
                offsetWeight <span class="token operator">-=</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>leastIndex<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>offsetWeight <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>leastIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// хжВцЮЬцЭГщЗНчЫ╕хРМцИЦцЭГщЗНф╕║0цЧ╢я╝МщЪПцЬ║ш┐ФхЫЮф╕Аф╕к Node</span>
        <span class="token keyword">return</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>leastIndexs<span class="token punctuation">[</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>leastCount<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-4-хУИх╕М"><a href="#_3-4-хУИх╕М" class="header-anchor">#</a> 3.4. хУИх╕М</h3> <p><code>хУИх╕Мя╝ИIP Hashя╝Й</code> чоЧц│Х<strong>ца╣цНоф╕Аф╕к key я╝ИхПпф╗ецШпхФпф╕АIDуАБIP чнЙя╝Йя╝МщАЪш┐ЗхУИх╕МшобчоЧх╛ЧхИ░ф╕Аф╕кцХ░хА╝я╝МчФишпецХ░хА╝хЬихАЩщАЙцЬНхКбхЩихИЧшбичЪДш┐ЫшбМхПЦцибш┐РчоЧя╝Мх╛ЧхИ░чЪДч╗УцЮЬф╛┐цШпщАЙф╕нчЪДцЬНхКбхЩи</strong>уАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210415172716.png" alt=""></p> <p>хПпф╗еф┐ЭшпБхРМф╕А IP чЪДховцИ╖члпчЪДшп╖ц▒Вф╝Ъш╜мхПСхИ░хРМф╕АхП░цЬНхКбхЩиф╕Кя╝МчФицЭехоЮчО░ф╝ЪшпЭч▓Шц╗Юя╝ИSticky Sessionя╝ЙуАВ</p> <ul><li>чЙ╣чВ╣я╝Ъф┐ЭшпБчЙ╣хоЪчФицИ╖цА╗цШпшп╖ц▒ВхИ░чЫ╕хРМчЪДцЬНхКбхЩия╝МшЛецЬНхКбхЩихоХцЬ║я╝Мф╝ЪшпЭф╝Ъф╕вхд▒уАВ</li></ul> <p>уАРчд║ф╛ЛуАСц║РхЬ░хЭАхУИх╕МчоЧц│ХхоЮчО░чд║ф╛Л</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IpHashLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">N</span> <span class="token function">doSelect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ip <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">int</span> length <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span> <span class="token operator">%</span> length<span class="token punctuation">;</span>
        <span class="token keyword">return</span> nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">HashUtil</span><span class="token punctuation">.</span><span class="token function">fnvHash</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-5-ф╕АшЗ┤цАзхУИх╕М"><a href="#_3-5-ф╕АшЗ┤цАзхУИх╕М" class="header-anchor">#</a> 3.5. ф╕АшЗ┤цАзхУИх╕М</h3> <p>ф╕АшЗ┤цАзхУИх╕Мя╝ИConsistent Hashя╝ЙчоЧц│ХчЪДчЫоцаЗцШпя╝Ъ<strong>чЫ╕хРМчЪДшп╖ц▒Вх░╜хПпшГ╜шР╜хИ░хРМф╕Аф╕кцЬНхКбхЩиф╕К</strong>уАВ</p> <p><strong>ф╕АшЗ┤цАзхУИх╕М</strong> хПпф╗ех╛Ихе╜чЪДшзгхЖ│ <strong>чи│хоЪцАзщЧощвШ</strong>я╝МхПпф╗ех░ЖцЙАцЬЙчЪД <strong>хнШхВишКВчВ╣</strong> цОТхИЧхЬи <strong>щжЦх░╛чЫ╕цОе</strong> чЪД <code>Hash</code> чОпф╕Кя╝МцпПф╕к <code>key</code> хЬишобчоЧ <code>Hash</code> хРОф╝Ъ <strong>щб║цЧ╢щТИ</strong> цЙ╛хИ░ <strong>ф╕┤цОе</strong> чЪД <strong>хнШхВишКВчВ╣</strong> хнШцФ╛уАВшАМх╜УцЬЙшКВчВ╣ <strong>хКахЕе</strong> цИЦ <strong>щААхЗ║</strong> цЧ╢я╝Мф╗Ех╜▒хУНшпешКВчВ╣хЬи <code>Hash</code> чОпф╕К <strong>щб║цЧ╢щТИчЫ╕щВ╗</strong> чЪД <strong>хРОч╗ншКВчВ╣</strong>уАВ</p> <p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/design/architecture/partition-consistent-hash.png" alt="img"></p> <ul><li>чЫ╕хРМчЪДшп╖ц▒ВцШпцМЗя╝Ъф╕АшИмхЬиф╜┐чФиф╕АшЗ┤цАзхУИх╕МцЧ╢я╝МщЬАшжБцМЗхоЪф╕Аф╕к key чФиф║О hash шобчоЧя╝МхПпшГ╜цШпя╝Ъ
<ul><li>чФицИ╖ ID</li> <li>шп╖ц▒ВцЦ╣ IP</li> <li>шп╖ц▒ВцЬНхКбхРНчз░я╝МхПВцХ░хИЧшбицЮДцИРчЪДф╕▓</li></ul></li> <li>х░╜хПпшГ╜цШпцМЗя╝ЪцЬНхКбхЩихПпшГ╜хПСчФЯф╕Кф╕Лч║┐я╝Мх░СцХ░цЬНхКбхЩичЪДхПШхМЦф╕Нх║Фшпех╜▒хУНхдзхдЪцХ░чЪДшп╖ц▒ВуАВ</li></ul> <p>х╜УцЯРхП░хАЩщАЙцЬНхКбхЩихоХцЬ║цЧ╢я╝МхОЯцЬмхПСх╛АшпецЬНхКбхЩичЪДшп╖ц▒Вя╝Мф╝ЪхЯ║ф║ОшЩЪцЛЯшКВчВ╣я╝Мх╣│цСКхИ░хЕ╢хоГхАЩщАЙцЬНхКбхЩия╝Мф╕Нф╝Ъх╝Хш╡╖хЙзчГИхПШхКиуАВ</p> <ul><li><strong>ф╝ШчВ╣</strong></li></ul> <p><strong>хКахЕе</strong> хТМ <strong>хИащЩд</strong> шКВчВ╣хПкх╜▒хУН <strong>хУИх╕МчОп</strong> ф╕н <strong>щб║цЧ╢щТИцЦ╣хРС</strong> чЪД <strong>чЫ╕щВ╗чЪДшКВчВ╣</strong>я╝Мхп╣хЕ╢ф╗ЦшКВчВ╣цЧах╜▒хУНуАВ</p> <ul><li><strong>ч╝║чВ╣</strong></li></ul> <p><strong>хКахЗПшКВчВ╣</strong> ф╝ЪщАацИР <strong>хУИх╕МчОп</strong> ф╕нщГихИЖцХ░цНо <strong>цЧац│ХхС╜ф╕н</strong>уАВх╜Уф╜┐чФи <strong>х░СщЗПшКВчВ╣</strong> цЧ╢я╝М<strong>шКВчВ╣хПШхМЦ</strong> х░ЖхдзшМГхЫ┤х╜▒хУН <strong>хУИх╕МчОп</strong> ф╕н <strong>цХ░цНоцШах░Д</strong>я╝Мф╕НщАВхРИ <strong>х░СщЗПцХ░цНошКВчВ╣</strong> чЪДхИЖх╕Гх╝ПцЦ╣цбИуАВ<strong>цЩощАЪ</strong> чЪД <strong>ф╕АшЗ┤цАзхУИх╕МхИЖхМ║</strong> хЬихвЮхЗПшКВчВ╣цЧ╢щЬАшжБ <strong>хвЮхКаф╕АхАН</strong> цИЦ <strong>хЗПхО╗ф╕АхНК</strong> шКВчВ╣цЙНшГ╜ф┐ЭшпБ <strong>цХ░цНо</strong> хТМ <strong>ш┤Яш╜╜чЪДхЭЗшбб</strong>уАВ</p> <blockquote><p><strong>ц│ицДП</strong>я╝ЪхЫаф╕║ <strong>ф╕АшЗ┤цАзхУИх╕МхИЖхМ║</strong> чЪДш┐Щф║Ыч╝║чВ╣я╝Мф╕Аф║ЫхИЖх╕Гх╝Пч│╗ч╗ЯщЗЗчФи <strong>шЩЪцЛЯцз╜</strong> хп╣ <strong>ф╕АшЗ┤цАзхУИх╕М</strong> ш┐ЫшбМцФ╣ш┐Ыя╝МцпФхжВ <code>Dynamo</code> ч│╗ч╗ЯуАВ</p></blockquote> <p>уАРчд║ф╛ЛуАСф╕АшЗ┤цАзхУИх╕МчоЧц│Хчд║ф╛Л</p> <p>ф╗еф╕Лчд║ф╛ЛхЯ║ф║О Dubbo чЪДф╕АшЗ┤цАзхУИх╕Мш┤Яш╜╜хЭЗшббчоЧц│ХхБЪф║Жф╕Аф║ЫчоАхМЦуАВ</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsistentHashLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">BaseLoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalance</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ConsistentHashSelector</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> selectors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">N</span> <span class="token function">doSelect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token class-name">String</span> ip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// хИЖчЙЗцХ░я╝Мш┐ЩщЗМшо╛ф╕║шКВчВ╣цХ░чЪД 4 хАН</span>
        <span class="token class-name">Integer</span> replicaNum <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token comment">// шО╖хПЦ nodes хОЯхзЛчЪД hashcode</span>
        <span class="token keyword">int</span> identityHashCode <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">identityHashCode</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// хжВцЮЬ nodes цШпф╕Аф╕кцЦ░чЪД List хп╣ш▒бя╝МцДПхС│чЭАшКВчВ╣цХ░щЗПхПСчФЯф║ЖхПШхМЦ</span>
        <span class="token comment">// цндцЧ╢ selector.identityHashCode != identityHashCode цЭбф╗╢цИРчлЛ</span>
        <span class="token class-name">ConsistentHashSelector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> selector <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ConsistentHashSelector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> selectors<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>selector <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> selector<span class="token punctuation">.</span>identityHashCode <span class="token operator">!=</span> identityHashCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// хИЫх╗║цЦ░чЪД ConsistentHashSelector</span>
            selectors<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ConsistentHashSelector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> identityHashCode<span class="token punctuation">,</span> replicaNum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            selector <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ConsistentHashSelector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> selectors<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ш░ГчФи ConsistentHashSelector чЪД select цЦ╣ц│ХщАЙцЛй Node</span>
        <span class="token keyword">return</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * ф╕АшЗ┤цАзхУИх╕МщАЙцЛйхЩи
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ConsistentHashSelector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span> <span class="token keyword">extends</span> <span class="token class-name">Node</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

        <span class="token comment">/**
         * хнШхВишЩЪцЛЯшКВчВ╣
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> virtualNodes<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> identityHashCode<span class="token punctuation">;</span>

        <span class="token comment">/**
         * цЮДщАахЩи
         *
         * @param nodes            шКВчВ╣хИЧшби
         * @param identityHashCode hashcode
         * @param replicaNum       хИЖчЙЗцХ░
         */</span>
        <span class="token class-name">ConsistentHashSelector</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> nodes<span class="token punctuation">,</span> <span class="token keyword">int</span> identityHashCode<span class="token punctuation">,</span> <span class="token class-name">Integer</span> replicaNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>virtualNodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>identityHashCode <span class="token operator">=</span> identityHashCode<span class="token punctuation">;</span>
            <span class="token comment">// шО╖хПЦшЩЪцЛЯшКВчВ╣цХ░я╝Мщ╗Шшодф╕║ 100</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>replicaNum <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                replicaNum <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">N</span> node <span class="token operator">:</span> nodes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> replicaNum <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// хп╣ url ш┐ЫшбМ md5 ш┐РчоЧя╝Мх╛ЧхИ░ф╕Аф╕кщХ┐х║жф╕║16чЪДхнЧшКВцХ░ч╗Д</span>
                    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> digest <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// хп╣ digest щГихИЖхнЧшКВш┐ЫшбМ 4 цмб hash ш┐РчоЧя╝Мх╛ЧхИ░хЫЫф╕кф╕НхРМчЪД long хЮЛцнгцХ┤цХ░</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// h = 0 цЧ╢я╝МхПЦ digest ф╕нф╕ЛцаЗф╕║ 0 ~ 3 чЪД4ф╕кхнЧшКВш┐ЫшбМф╜Нш┐РчоЧ</span>
                        <span class="token comment">// h = 1 цЧ╢я╝МхПЦ digest ф╕нф╕ЛцаЗф╕║ 4 ~ 7 чЪД4ф╕кхнЧшКВш┐ЫшбМф╜Нш┐РчоЧ</span>
                        <span class="token comment">// h = 2, h = 3 цЧ╢ш┐ЗчиЛхРМф╕К</span>
                        <span class="token keyword">long</span> m <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>digest<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// х░Ж hash хИ░ node чЪДцШах░ДхЕ│ч│╗хнШхВихИ░ virtualNodes ф╕ня╝М</span>
                        <span class="token comment">// virtualNodes щЬАшжБцПРф╛ЫщлШцХИчЪДцЯешпвцУНф╜Ья╝МхЫацндщАЙчФи TreeMap ф╜Ьф╕║хнШхВич╗УцЮД</span>
                        virtualNodes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">N</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// хп╣хПВцХ░ key ш┐ЫшбМ md5 ш┐РчоЧ</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> digest <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// хПЦ digest цХ░ч╗ДчЪДхЙНхЫЫф╕кхнЧшКВш┐ЫшбМ hash ш┐РчоЧя╝МхЖНх░Ж hash хА╝ф╝ач╗Щ selectForKey цЦ╣ц│Хя╝М</span>
            <span class="token comment">// хп╗цЙ╛хРИщАВчЪД Node</span>
            <span class="token keyword">return</span> <span class="token function">selectForKey</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>digest<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token class-name">N</span> <span class="token function">selectForKey</span><span class="token punctuation">(</span><span class="token keyword">long</span> hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// цЯецЙ╛чммф╕Аф╕кхдзф║ОцИЦчнЙф║Ох╜УхЙН hash чЪДшКВчВ╣</span>
            <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">N</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">=</span> virtualNodes<span class="token punctuation">.</span><span class="token function">ceilingEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// хжВцЮЬ hash хдзф║О Node хЬихУИх╕МчОпф╕КцЬАхдзчЪДф╜Нч╜оя╝МцндцЧ╢ entry = nullя╝М</span>
            <span class="token comment">// щЬАшжБх░Ж TreeMap чЪДхд┤шКВчВ╣ш╡ЛхА╝ч╗Щ entry</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                entry <span class="token operator">=</span> virtualNodes<span class="token punctuation">.</span><span class="token function">firstEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// ш┐ФхЫЮ Node</span>
            <span class="token keyword">return</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * шобчоЧ hash хА╝
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> digest<span class="token punctuation">,</span> <span class="token keyword">int</span> number<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>digest<span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">+</span> number <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>digest<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">+</span> number <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>digest<span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">+</span> number <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span>
            <span class="token operator">|</span> <span class="token punctuation">(</span>digest<span class="token punctuation">[</span>number <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">&amp;</span> <span class="token number">0</span>xFFFFFFFFL<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * шобчоЧ MD5 хА╝
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MessageDigest</span> md5<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            md5 <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;MD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchAlgorithmException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        md5<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        md5<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> md5<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-хПВшАГш╡ДцЦЩ"><a href="#_4-хПВшАГш╡ДцЦЩ" class="header-anchor">#</a> 4. хПВшАГш╡ДцЦЩ</h2> <ul><li><a href="https://www.youtube.com/watch?reload=9&amp;app=desktop&amp;v=iqOTT7_7qXY" target="_blank" rel="noopener noreferrer">Comparing Load Balancing Algorithms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://item.jd.com/11322972.html" target="_blank" rel="noopener noreferrer">уАКхдзхЮЛч╜СчлЩцКАцЬпцЮ╢цЮДя╝Ъца╕х┐ГхОЯчРЖф╕ОцбИф╛ЛхИЖцЮРуАЛ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/itfly8/p/5043435.html" target="_blank" rel="noopener noreferrer">хдзхЮЛч╜СчлЩцЮ╢цЮДч│╗хИЧя╝Ъш┤Яш╜╜хЭЗшббшпжшзгя╝И1я╝Й<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/32841479" target="_blank" rel="noopener noreferrer">ф╗Аф╣ИцШпш┤Яш╜╜хЭЗшбб<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://avinetworks.com/what-is-load-balancing/" target="_blank" rel="noopener noreferrer">What Is Load Balancing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://dubbo.apache.org/zh/docs/v2.7/dev/source/loadbalance/" target="_blank" rel="noopener noreferrer">Dubbo хоШцЦ╣ш┤Яш╜╜хЭЗшббчоЧц│Хшп┤цШО<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000004492447" target="_blank" rel="noopener noreferrer">ш┤Яш╜╜хЭЗшббчоЧц│ХхПКцЙЛцо╡<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://segmentfault.com/a/1190000002578457" target="_blank" rel="noopener noreferrer">хИйчФи dns шзгцЮРцЭехоЮчО░ч╜СчлЩчЪДш┤Яш╜╜хЭЗшбб<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/design/edit/master/docs/distributed/ш┤Яш╜╜хЭЗшбб.md" target="_blank" rel="noopener noreferrer">х╕охКйцИСф╗мцФ╣хЦДцндщб╡щЭвя╝Б</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░:</span> <span class="time">3 months ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/design/assets/js/app.31535b90.js" defer></script><script src="/design/assets/js/4.843d76c1.js" defer></script><script src="/design/assets/js/37.48dcf161.js" defer></script><script src="/design/assets/js/5.eb6f8f38.js" defer></script>
  </body>
</html>
