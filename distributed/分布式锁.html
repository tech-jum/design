<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>хИЖх╕Гх╝ПщФБхЯ║цЬмхОЯчРЖ | DESIGN</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/design/favicon.ico">
    <meta name="description" content="DESIGN">
    
    <link rel="preload" href="/design/assets/css/0.styles.3c2ef156.css" as="style"><link rel="preload" href="/design/assets/js/app.31535b90.js" as="script"><link rel="preload" href="/design/assets/js/4.843d76c1.js" as="script"><link rel="preload" href="/design/assets/js/33.3a07575c.js" as="script"><link rel="preload" href="/design/assets/js/5.eb6f8f38.js" as="script"><link rel="prefetch" href="/design/assets/js/10.07f2584d.js"><link rel="prefetch" href="/design/assets/js/11.df166aa0.js"><link rel="prefetch" href="/design/assets/js/12.b7ade635.js"><link rel="prefetch" href="/design/assets/js/13.151414b4.js"><link rel="prefetch" href="/design/assets/js/14.5dd04c5d.js"><link rel="prefetch" href="/design/assets/js/15.14e9a635.js"><link rel="prefetch" href="/design/assets/js/16.8728dd67.js"><link rel="prefetch" href="/design/assets/js/17.1686b754.js"><link rel="prefetch" href="/design/assets/js/18.d815545e.js"><link rel="prefetch" href="/design/assets/js/19.d846ce2f.js"><link rel="prefetch" href="/design/assets/js/20.1dd8edb9.js"><link rel="prefetch" href="/design/assets/js/21.38ae8c29.js"><link rel="prefetch" href="/design/assets/js/22.26dcb0f5.js"><link rel="prefetch" href="/design/assets/js/23.d996c1df.js"><link rel="prefetch" href="/design/assets/js/24.84573b57.js"><link rel="prefetch" href="/design/assets/js/25.362291b4.js"><link rel="prefetch" href="/design/assets/js/26.287f6746.js"><link rel="prefetch" href="/design/assets/js/27.665cd644.js"><link rel="prefetch" href="/design/assets/js/28.2d373aaa.js"><link rel="prefetch" href="/design/assets/js/29.18195cfe.js"><link rel="prefetch" href="/design/assets/js/30.b8a39bf2.js"><link rel="prefetch" href="/design/assets/js/31.e6497a3e.js"><link rel="prefetch" href="/design/assets/js/32.7c78886f.js"><link rel="prefetch" href="/design/assets/js/34.53801173.js"><link rel="prefetch" href="/design/assets/js/35.fe943393.js"><link rel="prefetch" href="/design/assets/js/36.e9ecc031.js"><link rel="prefetch" href="/design/assets/js/37.48dcf161.js"><link rel="prefetch" href="/design/assets/js/38.bc65c12c.js"><link rel="prefetch" href="/design/assets/js/39.76a7947c.js"><link rel="prefetch" href="/design/assets/js/40.57c60fe7.js"><link rel="prefetch" href="/design/assets/js/41.64d1acff.js"><link rel="prefetch" href="/design/assets/js/42.2b13267e.js"><link rel="prefetch" href="/design/assets/js/43.bc12e4a9.js"><link rel="prefetch" href="/design/assets/js/44.05348389.js"><link rel="prefetch" href="/design/assets/js/45.a821f14b.js"><link rel="prefetch" href="/design/assets/js/46.4f6121ee.js"><link rel="prefetch" href="/design/assets/js/47.2331491d.js"><link rel="prefetch" href="/design/assets/js/48.e99e2990.js"><link rel="prefetch" href="/design/assets/js/49.97ac4425.js"><link rel="prefetch" href="/design/assets/js/50.9561222b.js"><link rel="prefetch" href="/design/assets/js/51.5a3682fc.js"><link rel="prefetch" href="/design/assets/js/52.41f6da09.js"><link rel="prefetch" href="/design/assets/js/53.f3cbdb44.js"><link rel="prefetch" href="/design/assets/js/54.b64ed791.js"><link rel="prefetch" href="/design/assets/js/55.0b2515c6.js"><link rel="prefetch" href="/design/assets/js/56.f87ff124.js"><link rel="prefetch" href="/design/assets/js/57.c351d3a3.js"><link rel="prefetch" href="/design/assets/js/58.68c1d0ee.js"><link rel="prefetch" href="/design/assets/js/59.8cc7450d.js"><link rel="prefetch" href="/design/assets/js/6.cbcf7f30.js"><link rel="prefetch" href="/design/assets/js/60.f2f8871f.js"><link rel="prefetch" href="/design/assets/js/61.8922cbcd.js"><link rel="prefetch" href="/design/assets/js/62.ccb7c5ee.js"><link rel="prefetch" href="/design/assets/js/63.8191a330.js"><link rel="prefetch" href="/design/assets/js/64.1d881bbb.js"><link rel="prefetch" href="/design/assets/js/65.f4089278.js"><link rel="prefetch" href="/design/assets/js/66.66cf1b40.js"><link rel="prefetch" href="/design/assets/js/67.27e2cf6f.js"><link rel="prefetch" href="/design/assets/js/68.6a688bec.js"><link rel="prefetch" href="/design/assets/js/69.f59b5cd7.js"><link rel="prefetch" href="/design/assets/js/7.159ffade.js"><link rel="prefetch" href="/design/assets/js/70.aa52fe1c.js"><link rel="prefetch" href="/design/assets/js/71.f7f17e5c.js"><link rel="prefetch" href="/design/assets/js/72.f0a76070.js"><link rel="prefetch" href="/design/assets/js/73.b454f9b3.js"><link rel="prefetch" href="/design/assets/js/74.748903ca.js"><link rel="prefetch" href="/design/assets/js/75.1abb30fc.js"><link rel="prefetch" href="/design/assets/js/76.38081e86.js"><link rel="prefetch" href="/design/assets/js/77.631fd31e.js"><link rel="prefetch" href="/design/assets/js/78.b642c4ea.js"><link rel="prefetch" href="/design/assets/js/79.09f8c9ad.js"><link rel="prefetch" href="/design/assets/js/8.bbc07c86.js"><link rel="prefetch" href="/design/assets/js/80.15162b19.js"><link rel="prefetch" href="/design/assets/js/81.0a02424d.js"><link rel="prefetch" href="/design/assets/js/82.0a6de1bd.js"><link rel="prefetch" href="/design/assets/js/83.8bd118c7.js"><link rel="prefetch" href="/design/assets/js/84.c9db97ea.js"><link rel="prefetch" href="/design/assets/js/85.ea23932a.js"><link rel="prefetch" href="/design/assets/js/86.a70e5ac7.js"><link rel="prefetch" href="/design/assets/js/9.c3d97cd4.js"><link rel="prefetch" href="/design/assets/js/vendors~flowchart.5fa23d41.js"><link rel="prefetch" href="/design/assets/js/vendors~notification.4b668bb8.js">
    <link rel="stylesheet" href="/design/assets/css/0.styles.3c2ef156.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/design/" class="home-link router-link-active"><img src="https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo-200.png" alt="DESIGN" class="logo"> <span class="site-name can-hide">DESIGN</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/design/architecture/" class="nav-link">
  цЮ╢цЮД
</a></div><div class="nav-item"><a href="/design/distributed/" class="nav-link router-link-active">
  хИЖх╕Гх╝П
</a></div><div class="nav-item"><a href="/design/pattern/" class="nav-link">
  шо╛шобцибх╝П
</a></div><div class="nav-item"><a href="/design/refactor/" class="nav-link">
  щЗНцЮД
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ЁЯОп хНЪхов
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/design" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/design/architecture/" class="nav-link">
  цЮ╢цЮД
</a></div><div class="nav-item"><a href="/design/distributed/" class="nav-link router-link-active">
  хИЖх╕Гх╝П
</a></div><div class="nav-item"><a href="/design/pattern/" class="nav-link">
  шо╛шобцибх╝П
</a></div><div class="nav-item"><a href="/design/refactor/" class="nav-link">
  щЗНцЮД
</a></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ЁЯОп хНЪхов
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/dunwu/design" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>хИЖх╕Гх╝ПщФБхЯ║цЬмхОЯчРЖ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#ф╕АуАБхИЖх╕Гх╝ПщФБцАЭш╖п" class="sidebar-link">ф╕АуАБхИЖх╕Гх╝ПщФБцАЭш╖п</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#ф║МуАБцХ░цНох║УхИЖх╕Гх╝ПщФБ" class="sidebar-link">ф║МуАБцХ░цНох║УхИЖх╕Гх╝ПщФБ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#цХ░цНох║УхИЖх╕Гх╝ПщФБхОЯчРЖ" class="sidebar-link">цХ░цНох║УхИЖх╕Гх╝ПщФБхОЯчРЖ</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#цХ░цНох║УхИЖх╕Гх╝ПщФБщЧощвШ" class="sidebar-link">цХ░цНох║УхИЖх╕Гх╝ПщФБщЧощвШ</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У" class="sidebar-link">цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У</a></li></ul></li><li><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#ф╕ЙуАБredis-хИЖх╕Гх╝ПщФБ" class="sidebar-link">ф╕ЙуАБRedis хИЖх╕Гх╝ПщФБ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#redis-хИЖх╕Гх╝ПщФБхОЯчРЖ" class="sidebar-link">Redis хИЖх╕Гх╝ПщФБхОЯчРЖ</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#redis-хИЖх╕Гх╝ПщФБхоЮчО░" class="sidebar-link">Redis хИЖх╕Гх╝ПщФБхоЮчО░</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У-2" class="sidebar-link">цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#redlock-чоЧц│Х" class="sidebar-link">RedLock чоЧц│Х</a></li></ul></li><li><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#хЫЫуАБzookeeper-хИЖх╕Гх╝ПщФБ" class="sidebar-link">хЫЫуАБZooKeeper хИЖх╕Гх╝ПщФБ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#zookeeper-хИЖх╕Гх╝ПщФБхОЯчРЖ" class="sidebar-link">ZooKeeper хИЖх╕Гх╝ПщФБхОЯчРЖ</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#zookeeper-хИЖх╕Гх╝ПщФБхоЮчО░" class="sidebar-link">ZooKeeper хИЖх╕Гх╝ПщФБхоЮчО░</a></li><li class="sidebar-sub-header"><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#zookeeper-хИЖх╕Гх╝ПщФБх░Пч╗У" class="sidebar-link">ZooKeeper хИЖх╕Гх╝ПщФБх░Пч╗У</a></li></ul></li><li><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#ф║ФуАБ-хИЖх╕Гх╝ПщФБцЦ╣цбИхп╣цпФ" class="sidebar-link">ф║ФуАБ хИЖх╕Гх╝ПщФБцЦ╣цбИхп╣цпФ</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/design/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html#хПВшАГш╡ДцЦЩ" class="sidebar-link">хПВшАГш╡ДцЦЩ</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="хИЖх╕Гх╝ПщФБхЯ║цЬмхОЯчРЖ"><a href="#хИЖх╕Гх╝ПщФБхЯ║цЬмхОЯчРЖ" class="header-anchor">#</a> хИЖх╕Гх╝ПщФБхЯ║цЬмхОЯчРЖ</h1> <blockquote><p>хЬих╣╢хПСхЬ║цЩпф╕Ля╝Мф╕║ф║Жф┐ЭшпБх╣╢хПСхоЙхЕия╝МцИСф╗мх╕╕х╕╕шжБщАЪш┐Зф║ТцЦея╝ИхКащФБя╝ЙцЙЛцо╡цЭеф┐ЭшпБцХ░цНохРМцнехоЙхЕиуАВ</p> <p>JDK шЩ╜чД╢цПРф╛Ыф║ЖхдзщЗПщФБх╖ехЕ╖я╝Мф╜ЖцШпхПкшГ╜ф╜ЬчФиф║ОхНХф╕А Java ш┐ЫчиЛя╝МцЧац│Хх║ФчФиф║ОхИЖх╕Гх╝Пч│╗ч╗ЯуАВф╕║ф║ЖшзгхЖ│ш┐Щф╕кщЧощвШя╝МщЬАшжБф╜┐чФихИЖх╕Гх╝ПщФБуАВ</p> <p>хИЖх╕Гх╝ПщФБчЪДшзгхЖ│цЦ╣цбИхдзшЗ┤цЬЙф╗еф╕ЛхЗачзНя╝Ъ</p> <ul><li>хЯ║ф║ОцХ░цНох║УхоЮчО░</li> <li>хЯ║ф║Оч╝УхнШя╝Иredisя╝Мmemcached чнЙя╝ЙхоЮчО░</li> <li>хЯ║ф║О Zookeeper хоЮчО░ тЬЕ</li></ul> <p>ц│ия╝ЪцОишНРхЯ║ф║О ZooKeeper хоЮчО░хИЖх╕Гх╝ПщФБя╝МхЕ╖ф╜УхОЯхЫачЬЛхоМцЬмцЦЗхН│хПпцШОф║ЖуАВ</p> <p>ЁЯУж цЬмцЦЗх╖▓х╜ТцбгхИ░я╝ЪуАМ<a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer">blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>уАН</p></blockquote> <ul><li><a href="#%E4%B8%80%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%80%9D%E8%B7%AF">ф╕АуАБхИЖх╕Гх╝ПщФБцАЭш╖п</a></li> <li><a href="#%E4%BA%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">ф║МуАБцХ░цНох║УхИЖх╕Гх╝ПщФБ</a> <ul><li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%8E%9F%E7%90%86">цХ░цНох║УхИЖх╕Гх╝ПщФБхОЯчРЖ</a></li> <li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E9%97%AE%E9%A2%98">цХ░цНох║УхИЖх╕Гх╝ПщФБщЧощвШ</a></li> <li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%B0%8F%E7%BB%93">цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У</a></li></ul></li> <li><a href="#%E4%B8%89redis-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">ф╕ЙуАБRedis хИЖх╕Гх╝ПщФБ</a> <ul><li><a href="#redis-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%8E%9F%E7%90%86">Redis хИЖх╕Гх╝ПщФБхОЯчРЖ</a></li> <li><a href="#redis-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0">Redis хИЖх╕Гх╝ПщФБхоЮчО░</a></li> <li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%B0%8F%E7%BB%93-1">цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У</a></li> <li><a href="#redlock-%E7%AE%97%E6%B3%95">RedLock чоЧц│Х</a></li></ul></li> <li><a href="#%E5%9B%9Bzookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">хЫЫуАБZooKeeper хИЖх╕Гх╝ПщФБ</a> <ul><li><a href="#zookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%8E%9F%E7%90%86">ZooKeeper хИЖх╕Гх╝ПщФБхОЯчРЖ</a></li> <li><a href="#zookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0">ZooKeeper хИЖх╕Гх╝ПщФБхоЮчО░</a></li> <li><a href="#zookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%B0%8F%E7%BB%93">ZooKeeper хИЖх╕Гх╝ПщФБх░Пч╗У</a></li></ul></li> <li><a href="#%E4%BA%94-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94">ф║ФуАБ хИЖх╕Гх╝ПщФБцЦ╣цбИхп╣цпФ</a></li> <li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">хПВшАГш╡ДцЦЩ</a></li></ul> <h2 id="ф╕АуАБхИЖх╕Гх╝ПщФБцАЭш╖п"><a href="#ф╕АуАБхИЖх╕Гх╝ПщФБцАЭш╖п" class="header-anchor">#</a> ф╕АуАБхИЖх╕Гх╝ПщФБцАЭш╖п</h2> <p>хИЖх╕Гх╝ПщФБчЪДцА╗ф╜УцАЭш╖пхдзхРМх░Пх╝Вя╝Мф╗ЕхЬихоЮчО░ч╗ЖшКВф╕КцЬЙцЙАф╕НхРМуАВ</p> <p>хИЖх╕Гх╝ПщФБчЪДф╕╗шжБцАЭш╖пхжВф╕Ля╝Ъ</p> <ul><li><strong>ф║ТцЦеуАБхПпщЗНхЕе</strong> - хИЫх╗║щФБх┐Ещб╗цШпхФпф╕АчЪДя╝МшбичО░х╜вх╝Пф╕║хРСцХ░цНохнШхВицЬНхКбхЩицИЦхо╣хЩицПТхЕеф╕Аф╕кхФпф╕АчЪД keyя╝Мф╕АцЧжцЬЙф╕Аф╕кч║┐чиЛцПТхЕеш┐Щф╕к keyя╝МхЕ╢ф╗Цч║┐чиЛх░▒ф╕НшГ╜хЖНцПТхЕеф║ЖуАВ
<ul><li>ф┐ЭшпБ key хФпф╕АцАзчЪДцЬАчоАхНХчЪДцЦ╣х╝ПцШпф╜┐чФи UUIDуАВ</li> <li>хнШхВищФБчЪДщЗНхЕецмбцХ░я╝Мф╗ехПКхИЖх╕Гх╝ПчОпхвГф╕ЛхФпф╕АчЪДч║┐чиЛцаЗшпЖуАВф╕╛ф╛ЛцЭешп┤я╝МхПпф╗еф╜┐чФи json хнШхВич╗УцЮДхМЦцХ░цНоя╝Мф╕║ф║Жф┐ЭшпБхФпф╕Ая╝МхПпф╗ешАГшЩСх░Ж mac хЬ░хЭАя╝ИIP хЬ░хЭАуАБцЬ║хЩи IDя╝ЙуАБJvm ш┐ЫчиЛ IDя╝Их║ФчФи IDуАБцЬНхКб IDя╝ЙуАБч║┐чиЛ ID цЛ╝цОеш╡╖цЭеф╜Ьф╕║хФпф╕АцаЗшпЖуАВ<div class="language- extra-class"><pre class="language-text"><code>{&quot;count&quot;:1,&quot;expireAt&quot;:147506817232,&quot;jvmPid&quot;:22224,&quot;mac&quot;:&quot;28-D2-44-0E-0D-9A&quot;,&quot;threadId&quot;:14}
</code></pre></div></li></ul></li> <li><strong>щБ┐хЕНцн╗щФБ</strong> - цХ░цНох║УхИЖх╕Гх╝ПщФБхТМч╝УхнШхИЖх╕Гх╝ПщФБя╝ИRedisя╝ЙчЪДцАЭш╖пщГ╜цШпх╝ХхЕеш╢ЕцЧ╢цЬ║хИ╢я╝МхН│цИРхКЯчФ│шп╖щФБхРОя╝Мш╢Еш┐Зф╕АхоЪцЧ╢щЧ┤я╝МщФБхд▒цХИя╝ИхИащЩд keyя╝Йя╝МхОЯхЫахЬиф║ОхоГф╗мцЧац│ХцДЯчЯечФ│шп╖щФБчЪДховцИ╖члпшКВчВ╣чК╢цАБуАВшАМ ZooKeeper чФ▒ф║ОхЕ╢ znode ф╗ечЫох╜ХуАБцЦЗф╗╢х╜вх╝Пч╗Дч╗Зя╝МхдйчД╢х░▒хнШхЬичЙйчРЖчй║щЧ┤щЪФчж╗я╝МхПкшжБ znode хнШхЬия╝МхН│шбичд║ховцИ╖члпшКВчВ╣ш┐ШхЬих╖еф╜Ья╝МцЙАф╗еф╕НхнШхЬиш┐ЩчзНщЧощвШуАВ</li> <li><strong>хо╣щФЩ</strong> - хПкшжБхдзщГихИЖ Redis шКВчВ╣хПпчФия╝МховцИ╖члпх░▒шГ╜цнгх╕╕хКащФБуАВ</li> <li><strong>шЗкцЧЛщЗНшпХ</strong> - шО╖хПЦф╕НхИ░щФБцЧ╢я╝Мф╕НшжБчЫ┤цОеш┐ФхЫЮхд▒ш┤ея╝МшАМцШпцФпцМБф╕АхоЪчЪДхСицЬЯшЗкцЧЛщЗНшпХя╝Мшо╛ч╜оф╕Аф╕кцА╗чЪДш╢ЕцЧ╢цЧ╢щЧ┤я╝Мх╜Уш┐Зф║Жш╢ЕцЧ╢цЧ╢щЧ┤ф╗ехРОш┐Шц▓бцЬЙшО╖хПЦхИ░щФБхИЩш┐ФхЫЮхд▒ш┤еуАВ</li></ul> <h2 id="ф║МуАБцХ░цНох║УхИЖх╕Гх╝ПщФБ"><a href="#ф║МуАБцХ░цНох║УхИЖх╕Гх╝ПщФБ" class="header-anchor">#</a> ф║МуАБцХ░цНох║УхИЖх╕Гх╝ПщФБ</h2> <h3 id="цХ░цНох║УхИЖх╕Гх╝ПщФБхОЯчРЖ"><a href="#цХ░цНох║УхИЖх╕Гх╝ПщФБхОЯчРЖ" class="header-anchor">#</a> цХ░цНох║УхИЖх╕Гх╝ПщФБхОЯчРЖ</h3> <p>я╝И1я╝ЙхИЫх╗║шби</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>methodLock<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ф╕╗щФо'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>method_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'щФБхоЪчЪДцЦ╣ц│ХхРН'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">desc</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'хдЗц│иф┐бцБп'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'ф┐ЭхнШцХ░цНоцЧ╢щЧ┤я╝МшЗкхКичФЯцИР'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span>uidx_method_name<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>method_name <span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'щФБхоЪф╕нчЪДцЦ╣ц│Х'</span><span class="token punctuation">;</span>
</code></pre></div><p>я╝И2я╝ЙшО╖хПЦщФБ</p> <p>цГ│шжБщФБф╜ПцЯРф╕кцЦ╣ц│ХцЧ╢я╝МцЙзшбМф╗еф╕Л SQLя╝Ъ</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> methodLock<span class="token punctuation">(</span>method_name<span class="token punctuation">,</span><span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>тАШmethod_nameтАЩ<span class="token punctuation">,</span>тАШ<span class="token keyword">desc</span>тАЩ<span class="token punctuation">)</span>
</code></pre></div><p>хЫаф╕║цИСф╗мхп╣ <code>method_name</code> хБЪф║ЖхФпф╕АцАзч║жцЭЯя╝Мш┐ЩщЗМхжВцЮЬцЬЙхдЪф╕кшп╖ц▒ВхРМцЧ╢цПРф║дхИ░цХ░цНох║УчЪДшпЭя╝МцХ░цНох║Уф╝Ъф┐ЭшпБхПкцЬЙф╕Аф╕кцУНф╜ЬхПпф╗ецИРхКЯя╝МщВгф╣ИцИСф╗мх░▒хПпф╗ешодф╕║цУНф╜ЬцИРхКЯчЪДщВгф╕кч║┐чиЛшО╖х╛Чф║ЖшпецЦ╣ц│ХчЪДщФБя╝МхПпф╗ецЙзшбМцЦ╣ц│Хф╜УхЖЕхо╣уАВ</p> <p>цИРхКЯцПТхЕехИЩшО╖хПЦщФБуАВ</p> <p>я╝И3я╝ЙщЗКцФ╛щФБ</p> <p>х╜УцЦ╣ц│ХцЙзшбМхоМцпХф╣ЛхРОя╝МцГ│шжБщЗКцФ╛щФБчЪДшпЭя╝МщЬАшжБцЙзшбМф╗еф╕Л Sql:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> methodLock <span class="token keyword">where</span> method_name <span class="token operator">=</span><span class="token string">'method_name'</span>
</code></pre></div><h3 id="цХ░цНох║УхИЖх╕Гх╝ПщФБщЧощвШ"><a href="#цХ░цНох║УхИЖх╕Гх╝ПщФБщЧощвШ" class="header-anchor">#</a> цХ░цНох║УхИЖх╕Гх╝ПщФБщЧощвШ</h3> <ul><li>ш┐ЩцККщФБх╝║ф╛Эш╡ЦцХ░цНох║УчЪДхПпчФицАзуАВхжВцЮЬцХ░цНох║УцШпф╕Аф╕кхНХчВ╣я╝Мф╕АцЧжцХ░цНох║УцМВцОЙя╝Мф╝Ъхп╝шЗ┤ф╕ЪхКбч│╗ч╗Яф╕НхПпчФиуАВ</li> <li>ш┐ЩцККщФБц▓бцЬЙхд▒цХИцЧ╢щЧ┤я╝Мф╕АцЧжшзгщФБцУНф╜Ьхд▒ш┤ея╝Мх░▒ф╝Ъхп╝шЗ┤щФБшо░х╜Хф╕АчЫ┤хЬицХ░цНох║Уф╕ня╝МхЕ╢ф╗Цч║┐чиЛцЧац│ХхЖНшО╖х╛ЧхИ░щФБуАВ</li> <li>ш┐ЩцККщФБхПкшГ╜цШпщЭЮщШ╗хбЮчЪДя╝МхЫаф╕║цХ░цНочЪД insert цУНф╜Ья╝Мф╕АцЧжцПТхЕехд▒ш┤ех░▒ф╝ЪчЫ┤цОецКещФЩуАВц▓бцЬЙшО╖х╛ЧщФБчЪДч║┐чиЛх╣╢ф╕Нф╝Ъш┐ЫхЕецОТщШЯщШЯхИЧя╝МшжБцГ│хЖНцмбшО╖х╛ЧщФБх░▒шжБхЖНцмбшзжхПСшО╖х╛ЧщФБцУНф╜ЬуАВ</li> <li>ш┐ЩцККщФБцШпщЭЮщЗНхЕечЪДя╝МхРМф╕Аф╕кч║┐чиЛхЬиц▓бцЬЙщЗКцФ╛щФБф╣ЛхЙНцЧац│ХхЖНцмбшО╖х╛ЧшпещФБуАВхЫаф╕║цХ░цНоф╕нцХ░цНох╖▓ч╗ПхнШхЬиф║ЖуАВ</li></ul> <p>шзгхЖ│хКЮц│Хя╝Ъ</p> <ul><li>хНХчВ╣щЧощвШхПпф╗ечФихдЪцХ░цНох║УхоЮф╛Ля╝МхРМцЧ╢хбЮ N ф╕кшбия╝МN/2+1 ф╕кцИРхКЯх░▒ф╗╗хКбщФБхоЪцИРхКЯ</li> <li>хЖЩф╕Аф╕кхоЪцЧ╢ф╗╗хКбя╝МщЪФф╕Ацо╡цЧ╢щЧ┤ц╕ЕщЩдф╕Ацмбш┐ЗцЬЯчЪДцХ░цНоуАВ</li> <li>хЖЩф╕Аф╕к while х╛кчОпя╝Мф╕НцЦнчЪДщЗНшпХцПТхЕея╝МчЫ┤хИ░цИРхКЯуАВ</li> <li>хЬицХ░цНох║Ушбиф╕нхКаф╕кхнЧцо╡я╝Мшо░х╜Хх╜УхЙНшО╖х╛ЧщФБчЪДцЬ║хЩичЪДф╕╗цЬ║ф┐бцБпхТМч║┐чиЛф┐бцБпя╝МщВгф╣Иф╕ЛцмбхЖНшО╖хПЦщФБчЪДцЧ╢хАЩхЕИцЯешпвцХ░цНох║Уя╝МхжВцЮЬх╜УхЙНцЬ║хЩичЪДф╕╗цЬ║ф┐бцБпхТМч║┐чиЛф┐бцБпхЬицХ░цНох║УхПпф╗ецЯехИ░чЪДшпЭя╝МчЫ┤цОецККщФБхИЖщЕНч╗Щф╗Цх░▒хПпф╗еф║ЖуАВ</li></ul> <h3 id="цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У"><a href="#цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У" class="header-anchor">#</a> цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У</h3> <ul><li>ф╝ШчВ╣: чЫ┤цОехАЯхКйцХ░цНох║Уя╝Мхо╣цШУчРЖшзгуАВ</li> <li>ч╝║чВ╣: ф╝ЪцЬЙхРДчзНхРДца╖чЪДщЧощвШя╝МхЬишзгхЖ│щЧощвШчЪДш┐ЗчиЛф╕нф╝Ъф╜┐цХ┤ф╕кцЦ╣цбИхПШх╛Чш╢КцЭеш╢КхдНцЭВуАВцУНф╜ЬцХ░цНох║УщЬАшжБф╕АхоЪчЪДх╝АщФАя╝МцАзшГ╜щЧощвШщЬАшжБшАГшЩСуАВ</li></ul> <h2 id="ф╕ЙуАБredis-хИЖх╕Гх╝ПщФБ"><a href="#ф╕ЙуАБredis-хИЖх╕Гх╝ПщФБ" class="header-anchor">#</a> ф╕ЙуАБRedis хИЖх╕Гх╝ПщФБ</h2> <p>чЫ╕цпФф║ОчФицХ░цНох║УцЭехоЮчО░хИЖх╕Гх╝ПщФБя╝МхЯ║ф║Оч╝УхнШхоЮчО░чЪДхИЖх╕Гх╝ПщФБчЪДцАзшГ╜ф╝ЪцЫ┤хе╜уАВчЫохЙНцЬЙх╛ИхдЪцИРчЖЯчЪДхИЖх╕Гх╝Пф║зхУБя╝МхМЕцЛм RedisуАБmemcacheуАБTair чнЙуАВш┐ЩщЗМф╗е Redis ф╕╛ф╛ЛуАВ</p> <h3 id="redis-хИЖх╕Гх╝ПщФБхОЯчРЖ"><a href="#redis-хИЖх╕Гх╝ПщФБхОЯчРЖ" class="header-anchor">#</a> Redis хИЖх╕Гх╝ПщФБхОЯчРЖ</h3> <p>ш┐Щф╕кхИЖх╕Гх╝ПщФБцЬЙ 3 ф╕кщЗНшжБчЪДшАГщЗПчВ╣я╝Ъ</p> <ol><li>ф║ТцЦея╝ИхПкшГ╜цЬЙф╕Аф╕кховцИ╖члпшО╖хПЦщФБя╝Й</li> <li>ф╕НшГ╜цн╗щФБ</li> <li>хо╣щФЩя╝ИхПкшжБхдзщГихИЖ redis шКВчВ╣хИЫх╗║ф║Жш┐ЩцККщФБх░▒хПпф╗ея╝Й</li></ol> <p>хп╣х║ФчЪД Redis цМЗф╗дхжВф╕Ля╝Ъ</p> <ul><li><code>setnx</code> - <code>setnx key val</code>я╝Ъх╜Уф╕Фф╗Ех╜У key ф╕НхнШхЬицЧ╢я╝Мset ф╕Аф╕к key ф╕║ val чЪДхнЧчмжф╕▓я╝Мш┐ФхЫЮ 1я╝ЫшЛе key хнШхЬия╝МхИЩф╗Аф╣ИщГ╜ф╕НхБЪя╝Мш┐ФхЫЮ 0уАВ</li> <li><code>expire</code> - <code>expire key timeout</code>я╝Ъф╕║ key шо╛ч╜оф╕Аф╕кш╢ЕцЧ╢цЧ╢щЧ┤я╝МхНХф╜Нф╕║ secondя╝Мш╢Еш┐Зш┐Щф╕кцЧ╢щЧ┤щФБф╝ЪшЗкхКищЗКцФ╛я╝МщБ┐хЕНцн╗щФБуАВ</li> <li><code>delete</code> - <code>delete key</code>я╝ЪхИащЩд key</li></ul> <blockquote><p>ц│ицДПя╝Ъ</p> <p>ф╕НшжБх░Ж <code>setnx</code> хТМ <code>expire</code> ф╜Ьф╕║ф╕дф╕кхС╜ф╗дч╗ДхРИхоЮчО░хКащФБя╝Мш┐Щца╖х░▒<strong>цЧац│Хф┐ЭшпБхОЯхнРцАз</strong>уАВхжВцЮЬховцИ╖члпхЬи <code>setnx</code> ф╣ЛхРОх┤йц║Гя╝МщВгф╣Их░Жхп╝шЗ┤щФБцЧац│ХщЗКцФ╛уАВцнгчбочЪДхБЪц│Хх║ФцШпхЬи <code>setnx</code> хС╜ф╗дф╕нцМЗхоЪ <code>expire</code> цЧ╢щЧ┤уАВ</p></blockquote> <h3 id="redis-хИЖх╕Гх╝ПщФБхоЮчО░"><a href="#redis-хИЖх╕Гх╝ПщФБхоЮчО░" class="header-anchor">#</a> Redis хИЖх╕Гх╝ПщФБхоЮчО░</h3> <p>я╝И1я╝ЙчФ│шп╖щФБ</p> <div class="language- extra-class"><pre class="language-text"><code>SET resource_name my_random_value NX PX 30000
</code></pre></div><p>цЙзшбМш┐Щф╕кхС╜ф╗дх░▒ okуАВ</p> <ul><li><code>NX</code>я╝Ъшбичд║хПкцЬЙ <code>key</code> ф╕НхнШхЬичЪДцЧ╢хАЩцЙНф╝Ъшо╛ч╜оцИРхКЯуАВя╝ИхжВцЮЬцндцЧ╢ redis ф╕нхнШхЬиш┐Щф╕к keyя╝МщВгф╣Ишо╛ч╜охд▒ш┤ея╝Мш┐ФхЫЮ <code>nil</code>я╝Й</li> <li><code>PX 30000</code>я╝ЪцДПцАЭцШп 30s хРОщФБшЗкхКищЗКцФ╛уАВхИлф║║хИЫх╗║чЪДцЧ╢хАЩхжВцЮЬхПСчО░х╖▓ч╗ПцЬЙф║Жх░▒ф╕НшГ╜хКащФБф║ЖуАВ</li></ul> <p>я╝И2я╝ЙщЗКцФ╛щФБ</p> <p>щЗКцФ╛щФБх░▒цШпхИащЩд key я╝Мф╜ЖцШпф╕АшИмхПпф╗ечФи <code>lua</code> шДЪцЬмхИащЩдя╝МхИдцЦн value ф╕Аца╖цЙНхИащЩдя╝Ъ</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">-</span><span class="token operator">-</span> хИащЩдщФБчЪДцЧ╢хАЩя╝МцЙ╛хИ░ key хп╣х║ФчЪД valueя╝Мш╖ЯшЗкх╖▒ф╝аш┐ЗхО╗чЪД value хБЪцпФш╛Гя╝МхжВцЮЬцШпф╕Аца╖чЪДцЙНхИащЩдуАВ
<span class="token keyword">if</span> redis<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> then
    <span class="token keyword">return</span> redis<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token string">&quot;del&quot;</span><span class="token punctuation">,</span>KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
end
</code></pre></div><h3 id="цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У-2"><a href="#цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У-2" class="header-anchor">#</a> цХ░цНох║УхИЖх╕Гх╝ПщФБх░Пч╗У</h3> <p>ф╕║хХешжБчФи <code>random_value</code> щЪПцЬ║хА╝хСвя╝ЯхЫаф╕║хжВцЮЬцЯРф╕кховцИ╖члпшО╖хПЦхИ░ф║ЖщФБя╝Мф╜ЖцШпщШ╗хбЮф║Жх╛ИщХ┐цЧ╢щЧ┤цЙНцЙзшбМхоМя╝МцпФхжВшп┤ш╢Еш┐Зф║Ж 30sя╝МцндцЧ╢хПпшГ╜х╖▓ч╗ПшЗкхКищЗКцФ╛щФБф║Жя╝МцндцЧ╢хПпшГ╜хИлчЪДховцИ╖члпх╖▓ч╗ПшО╖хПЦхИ░ф║Жш┐Щф╕кщФБя╝МшжБцШпф╜аш┐Щф╕кцЧ╢хАЩчЫ┤цОехИащЩд key чЪДшпЭф╝ЪцЬЙщЧощвШя╝МцЙАф╗ех╛ЧчФищЪПцЬ║хА╝хКаф╕КщЭвчЪД <code>lua</code> шДЪцЬмцЭещЗКцФ╛щФБуАВ</p> <p>ф╜ЖцШпш┐Щца╖цШпшВпхоЪф╕НшбМчЪДуАВхЫаф╕║хжВцЮЬцШпцЩощАЪчЪД redis хНХхоЮф╛Ля╝МщВгх░▒цШпхНХчВ╣цХЕщЪЬуАВцИЦшАЕцШп redis цЩощАЪф╕╗ф╗Оя╝МщВг redis ф╕╗ф╗Ох╝ВцнехдНхИ╢я╝МхжВцЮЬф╕╗шКВчВ╣цМВф║Жя╝Иkey х░▒ц▓бцЬЙф║Жя╝Йя╝Мkey ш┐Шц▓бхРМцнехИ░ф╗ОшКВчВ╣я╝МцндцЧ╢ф╗ОшКВчВ╣хИЗцНвф╕║ф╕╗шКВчВ╣я╝МхИлф║║х░▒хПпф╗е set keyя╝Мф╗ОшАМцЛ┐хИ░щФБуАВ</p> <h3 id="redlock-чоЧц│Х"><a href="#redlock-чоЧц│Х" class="header-anchor">#</a> RedLock чоЧц│Х</h3> <p>ш┐Щф╕кхЬ║цЩпцШпхБЗшо╛цЬЙф╕Аф╕к redis clusterя╝МцЬЙ 5 ф╕к redis master хоЮф╛ЛуАВчД╢хРОцЙзшбМхжВф╕ЛцнещкдшО╖хПЦф╕АцККщФБя╝Ъ</p> <ol><li>шО╖хПЦх╜УхЙНцЧ╢щЧ┤цИ│я╝МхНХф╜НцШпцплчзТя╝Ы</li> <li>ш╖Яф╕КщЭвч▒╗ф╝╝я╝Мш╜оц╡Бх░ЭшпХхЬицпПф╕к master шКВчВ╣ф╕КхИЫх╗║щФБя╝Мш┐ЗцЬЯцЧ╢щЧ┤ш╛ГчЯня╝Мф╕АшИмх░▒хЗахНБцплчзТя╝Ы</li> <li>х░ЭшпХхЬи<strong>хдзхдЪцХ░шКВчВ╣</strong>ф╕Кх╗║члЛф╕Аф╕кщФБя╝МцпФхжВ 5 ф╕кшКВчВ╣х░▒шжБц▒ВцШп 3 ф╕кшКВчВ╣ <code>n / 2 + 1</code>я╝Ы</li> <li>ховцИ╖члпшобчоЧх╗║члЛхе╜щФБчЪДцЧ╢щЧ┤я╝МхжВцЮЬх╗║члЛщФБчЪДцЧ╢щЧ┤х░Пф║Ош╢ЕцЧ╢цЧ╢щЧ┤я╝Мх░▒чоЧх╗║члЛцИРхКЯф║Жя╝Ы</li> <li>шжБцШпщФБх╗║члЛхд▒ш┤еф║Жя╝МщВгф╣Их░▒ф╛Эцмбф╣ЛхЙНх╗║члЛш┐ЗчЪДщФБхИащЩдя╝Ы</li> <li>хПкшжБхИлф║║х╗║члЛф║Жф╕АцККхИЖх╕Гх╝ПщФБя╝Мф╜ах░▒х╛Ч<strong>ф╕НцЦнш╜ошпвхО╗х░ЭшпХшО╖хПЦщФБ</strong>уАВ</li></ol> <p><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis хоШцЦ╣<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ч╗ЩхЗ║ф║Жф╗еф╕Кф╕дчзНхЯ║ф║О Redis хоЮчО░хИЖх╕Гх╝ПщФБчЪДцЦ╣ц│Хя╝Мшпжч╗Жшп┤цШОхПпф╗ецЯечЬЛя╝Ъ<a href="https://redis.io/topics/distlock" target="_blank" rel="noopener noreferrer">https://redis.io/topics/distlock<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> уАВ</p> <h2 id="хЫЫуАБzookeeper-хИЖх╕Гх╝ПщФБ"><a href="#хЫЫуАБzookeeper-хИЖх╕Гх╝ПщФБ" class="header-anchor">#</a> хЫЫуАБZooKeeper хИЖх╕Гх╝ПщФБ</h2> <h3 id="zookeeper-хИЖх╕Гх╝ПщФБхОЯчРЖ"><a href="#zookeeper-хИЖх╕Гх╝ПщФБхОЯчРЖ" class="header-anchor">#</a> ZooKeeper хИЖх╕Гх╝ПщФБхОЯчРЖ</h3> <p>ZooKeeper хоЮчО░хИЖх╕Гх╝ПщФБхЯ║ф║О ZooKeeper чЪДф╕дф╕кчЙ╣цАзя╝Ъ</p> <ul><li><strong>щб║х║Пф╕┤цЧ╢шКВчВ╣</strong>я╝ЪZooKeeper чЪДхнШхВич▒╗ф╝╝ф║О DNS щВгца╖чЪДхЕ╖цЬЙх▒Вч║зчЪДхС╜хРНчй║щЧ┤уАВZooKeeper шКВчВ╣ч▒╗хЮЛхПпф╗ехИЖф╕║цМБф╣ЕшКВчВ╣я╝ИPERSISTENT я╝ЙуАБф╕┤цЧ╢шКВчВ╣я╝ИEPHEMERALя╝Йя╝МцпПф╕кшКВчВ╣ш┐ШшГ╜швлцаЗшо░ф╕║цЬЙх║ПцАзя╝ИSEQUENTIALя╝Йя╝Мф╕АцЧжшКВчВ╣швлцаЗшо░ф╕║цЬЙх║ПцАзя╝МщВгф╣ИцХ┤ф╕кшКВчВ╣х░▒хЕ╖цЬЙщб║х║ПшЗкхвЮчЪДчЙ╣чВ╣уАВ</li> <li><strong>Watch цЬ║хИ╢</strong>я╝ЪZooKeeper хЕБшо╕чФицИ╖хЬицМЗхоЪшКВчВ╣ф╕Кц│ихЖМф╕Аф║Ы Watcherя╝Мх╣╢ф╕ФхЬичЙ╣хоЪф║Лф╗╢шзжхПСчЪДцЧ╢хАЩя╝МZooKeeper цЬНхКбчлпф╝Ъх░Жф║Лф╗╢щАЪчЯеч╗ЩчФицИ╖уАВ</li></ul> <p>ш┐Щф╣ЯцШп ZooKeeper ховцИ╖члп curator чЪДхИЖх╕Гх╝ПщФБхоЮчО░уАВ</p> <ol><li>хИЫх╗║ф╕Аф╕кчЫох╜Х mylockя╝Ы</li> <li>ч║┐чиЛ A цГ│шО╖хПЦщФБх░▒хЬи mylock чЫох╜Хф╕ЛхИЫх╗║ф╕┤цЧ╢щб║х║ПшКВчВ╣я╝Ы</li> <li>шО╖хПЦ mylock чЫох╜Хф╕ЛцЙАцЬЙчЪДхнРшКВчВ╣я╝МчД╢хРОшО╖хПЦцпФшЗкх╖▒х░ПчЪДхЕДх╝ЯшКВчВ╣я╝МхжВцЮЬф╕НхнШхЬия╝МхИЩшп┤цШОх╜УхЙНч║┐чиЛщб║х║ПхП╖цЬАх░Пя╝МшО╖х╛ЧщФБя╝Ы</li> <li>ч║┐чиЛ B шО╖хПЦцЙАцЬЙшКВчВ╣я╝МхИдцЦншЗкх╖▒ф╕НцШпцЬАх░ПшКВчВ╣я╝Мшо╛ч╜очЫСхРмцпФшЗкх╖▒цмбх░ПчЪДшКВчВ╣я╝Ы</li> <li>ч║┐чиЛ A хдДчРЖхоМя╝МхИащЩдшЗкх╖▒чЪДшКВчВ╣я╝Мч║┐чиЛ B чЫСхРмхИ░хПШцЫ┤ф║Лф╗╢я╝МхИдцЦншЗкх╖▒цШпф╕НцШпцЬАх░ПчЪДшКВчВ╣я╝МхжВцЮЬцШпхИЩшО╖х╛ЧщФБуАВ</li></ol> <h3 id="zookeeper-хИЖх╕Гх╝ПщФБхоЮчО░"><a href="#zookeeper-хИЖх╕Гх╝ПщФБхоЮчО░" class="header-anchor">#</a> ZooKeeper хИЖх╕Гх╝ПщФБхоЮчО░</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * ZooKeeperSession
 *
 * @author bingo
 * @since 2018/11/29
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZooKeeperSession</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CountDownLatch</span> connectedSemaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ZooKeeper</span> zookeeper<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">CountDownLatch</span> latch<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ZooKeeperSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>zookeeper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.31.187:2181,192.168.31.19:2181,192.168.31.227:2181&quot;</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeperWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                connectedSemaphore<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ZooKeeper session established......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * шО╖хПЦхИЖх╕Гх╝ПщФБ
     *
     * @param productId
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">acquireDistributedLock</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/product-lock-&quot;</span> <span class="token operator">+</span> productId<span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>EPHEMERAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// чЫ╕х╜Уф║ОцШпч╗Щnodeц│ихЖМф╕Аф╕кчЫСхРмхЩия╝МхО╗чЬЛчЬЛш┐Щф╕кчЫСхРмхЩицШпхРжхнШхЬи</span>
                    <span class="token class-name">Stat</span> stat <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>stat <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span>waitTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>latch <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>EPHEMERAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * щЗКцФ╛цОЙф╕Аф╕кхИЖх╕Гх╝ПщФБ
     *
     * @param productId
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">releaseDistributedLock</span><span class="token punctuation">(</span><span class="token class-name">Long</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/product-lock-&quot;</span> <span class="token operator">+</span> productId<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            zookeeper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;release the lock for product[id=&quot;</span> <span class="token operator">+</span> productId <span class="token operator">+</span> <span class="token string">&quot;]......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * х╗║члЛzk sessionчЪДwatcher
     *
     * @author bingo
     * @since 2018/11/29
     *
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">ZooKeeperWatcher</span> <span class="token keyword">implements</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Receive watched event: &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">KeeperState<span class="token punctuation">.</span>SyncConnected</span> <span class="token operator">==</span> event<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                connectedSemaphore<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>latch <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * х░БшгЕхНХф╛ЛчЪДщЭЩцАБхЖЕщГич▒╗
     *
     * @author bingo
     * @since 2018/11/29
     *
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperSession</span> instance<span class="token punctuation">;</span>

        <span class="token keyword">static</span> <span class="token punctuation">{</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeperSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperSession</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * шО╖хПЦхНХф╛Л
     *
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperSession</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * хИЭхзЛхМЦхНХф╛ЛчЪДф╛┐цН╖цЦ╣ц│Х
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>ф╣ЯхПпф╗ещЗЗчФихПжф╕АчзНцЦ╣х╝Пя╝МхИЫх╗║ф╕┤цЧ╢щб║х║ПшКВчВ╣я╝Ъ</p> <p>хжВцЮЬцЬЙф╕АцККщФБя╝МшвлхдЪф╕кф║║ч╗ЩчлЮф║Йя╝МцндцЧ╢хдЪф╕кф║║ф╝ЪцОТщШЯя╝Мчммф╕Аф╕кцЛ┐хИ░щФБчЪДф║║ф╝ЪцЙзшбМя╝МчД╢хРОщЗКцФ╛щФБя╝ЫхРОщЭвчЪДцпПф╕кф║║щГ╜ф╝ЪхО╗чЫСхРм<strong>цОТхЬишЗкх╖▒хЙНщЭв</strong>чЪДщВгф╕кф║║хИЫх╗║чЪД node ф╕Кя╝Мф╕АцЧжцЯРф╕кф║║щЗКцФ╛ф║ЖщФБя╝МцОТхЬишЗкх╖▒хРОщЭвчЪДф║║х░▒ф╝Ъшвл zookeeper ч╗ЩщАЪчЯея╝Мф╕АцЧжшвлщАЪчЯеф║Жф╣ЛхРОя╝Мх░▒ ok ф║Жя╝МшЗкх╖▒х░▒шО╖хПЦхИ░ф║ЖщФБя╝Мх░▒хПпф╗ецЙзшбМф╗гчаБф║ЖуАВ</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZooKeeperDistributedLock</span> <span class="token keyword">implements</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ZooKeeper</span> zk<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> locksRoot <span class="token operator">=</span> <span class="token string">&quot;/locks&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> waitNode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> lockNode<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">CountDownLatch</span> latch<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">CountDownLatch</span> connectedLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> sessionTimeout <span class="token operator">=</span> <span class="token number">30000</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ZooKeeperDistributedLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>productId <span class="token operator">=</span> productId<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> address <span class="token operator">=</span> <span class="token string">&quot;192.168.31.187:2181,192.168.31.19:2181,192.168.31.227:2181&quot;</span><span class="token punctuation">;</span>
            zk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> sessionTimeout<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            connectedLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeeperException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">KeeperState<span class="token punctuation">.</span>SyncConnected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            connectedLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>latch <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquireDistributedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">waitForLock</span><span class="token punctuation">(</span>waitNode<span class="token punctuation">,</span> sessionTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeeperException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
 		    <span class="token comment">// ф╝ахЕеш┐ЫхО╗чЪДlocksRoot + тАЬ/тАЭ + productId</span>
		    <span class="token comment">// хБЗшо╛productIdф╗гшбиф║Жф╕Аф╕кхХЖхУБidя╝МцпФхжВшп┤1</span>
		    <span class="token comment">// locksRoot = locks</span>
		    <span class="token comment">// /locks/10000000000я╝М/locks/10000000001я╝М/locks/10000000002</span>
            lockNode <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>locksRoot <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> productId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>EPHEMERAL_SEQUENTIAL<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// чЬЛчЬЛхИЪхИЫх╗║чЪДшКВчВ╣цШпф╕НцШпцЬАх░ПчЪДшКВчВ╣</span>
	 	    <span class="token comment">// locksя╝Ъ10000000000я╝М10000000001я╝М10000000002</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> locks <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span>locksRoot<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>locks<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>lockNode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>locksRoot<span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token operator">+</span> locks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//хжВцЮЬцШпцЬАх░ПчЪДшКВчВ╣,хИЩшбичд║хПЦх╛ЧщФБ</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//хжВцЮЬф╕НцШпцЬАх░ПчЪДшКВчВ╣я╝МцЙ╛хИ░цпФшЗкх╖▒х░П1чЪДшКВчВ╣</span>
	  <span class="token keyword">int</span> previousLockIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> locks<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>lockNode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>locksRoot <span class="token operator">+</span> тАЬ<span class="token operator">/</span>тАЭ <span class="token operator">+</span> locks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	         	    previousLockIndex <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
		    <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	   <span class="token punctuation">}</span>

	   <span class="token keyword">this</span><span class="token punctuation">.</span>waitNode <span class="token operator">=</span> locks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>previousLockIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeeperException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">waitForLock</span><span class="token punctuation">(</span><span class="token class-name">String</span> waitNode<span class="token punctuation">,</span> <span class="token keyword">long</span> waitTime<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">KeeperException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stat</span> stat <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>locksRoot <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> waitNode<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stat <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span>waitTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>latch <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// хИащЩд/locks/10000000000шКВчВ╣</span>
            <span class="token comment">// хИащЩд/locks/10000000001шКВчВ╣</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;unlock &quot;</span> <span class="token operator">+</span> lockNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            zk<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>lockNode<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lockNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            zk<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeeperException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span><span class="token class-name">String</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">LockException</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="zookeeper-хИЖх╕Гх╝ПщФБх░Пч╗У"><a href="#zookeeper-хИЖх╕Гх╝ПщФБх░Пч╗У" class="header-anchor">#</a> ZooKeeper хИЖх╕Гх╝ПщФБх░Пч╗У</h3> <p>ZooKeeper чЙИцЬмчЪДхИЖх╕Гх╝ПщФБщЧощвШчЫ╕хп╣цпФш╛ГцЭешп┤х░СуАВ</p> <ul><li>щФБчЪДхНачФицЧ╢щЧ┤щЩРхИ╢я╝Ъredis х░▒цЬЙхНачФицЧ╢щЧ┤щЩРхИ╢я╝МшАМ ZooKeeper хИЩц▓бцЬЙя╝МцЬАф╕╗шжБчЪДхОЯхЫацШп redis чЫохЙНц▓бцЬЙхКЮц│ХчЯещБУх╖▓ч╗ПшО╖хПЦщФБчЪДховцИ╖члпчЪДчК╢цАБя╝МцШпх╖▓ч╗ПцМВф║ЖхСвш┐ШцШпцнгхЬицЙзшбМшАЧцЧ╢ш╛ГщХ┐чЪДф╕ЪхКбщА╗ш╛СуАВшАМ ZooKeeper щАЪш┐Зф╕┤цЧ╢шКВчВ╣х░▒шГ╜ц╕ЕцЩ░чЯещБУя╝МхжВцЮЬф╕┤цЧ╢шКВчВ╣хнШхЬишп┤цШОш┐ШхЬицЙзшбМф╕ЪхКбщА╗ш╛Ся╝МхжВцЮЬф╕┤цЧ╢шКВчВ╣ф╕НхнШхЬишп┤цШОх╖▓ч╗ПцЙзшбМхоМцпХщЗКцФ╛щФБцИЦшАЕцШпцМВф║ЖуАВчФ▒цндчЬЛцЭе redis хжВцЮЬшГ╜хГП ZooKeeper ф╕Аца╖ц╖╗хКаф╕Аф║Ыф╕ОховцИ╖члпч╗СхоЪчЪДф╕┤цЧ╢щФоя╝Мф╣ЯцШпф╕Ахдзхе╜ф║ЛуАВ</li> <li>цШпхРжхНХчВ╣цХЕщЪЬя╝Ъredis цЬмш║лцЬЙх╛ИхдЪф╕нчОйц│Хя╝МхжВховцИ╖члпф╕АшЗ┤цАз hashя╝МцЬНхКбхЩичлп sentinel цЦ╣цбИцИЦшАЕ cluster цЦ╣цбИя╝Мх╛ИщЪ╛хБЪхИ░ф╕АчзНхИЖх╕Гх╝ПщФБцЦ╣х╝ПшГ╜х║Фхп╣цЙАцЬЙш┐Щф║ЫцЦ╣цбИуАВшАМ ZooKeeper хПкцЬЙф╕АчзНчОйц│Хя╝МхдЪхП░цЬ║хЩичЪДшКВчВ╣цХ░цНоцШпф╕АшЗ┤чЪДя╝Мц▓бцЬЙ redis чЪДщВгф╣ИхдЪчЪДщ║╗чГжхЫач┤ашжБшАГшЩСуАВ</li></ul> <p>цА╗ф╜Уф╕КцЭешп┤ ZooKeeper хоЮчО░хИЖх╕Гх╝ПщФБцЫ┤хКачЪДчоАхНХя╝МхПпщЭацАзцЫ┤щлШуАВф╜Ж ZooKeeper хЫаф╕║щЬАшжБщвСч╣БчЪДхИЫх╗║хТМхИащЩдшКВчВ╣я╝МцАзшГ╜ф╕Кф╕НхжВ Redis цЦ╣х╝ПуАВ</p> <h2 id="ф║ФуАБ-хИЖх╕Гх╝ПщФБцЦ╣цбИхп╣цпФ"><a href="#ф║ФуАБ-хИЖх╕Гх╝ПщФБцЦ╣цбИхп╣цпФ" class="header-anchor">#</a> ф║ФуАБ хИЖх╕Гх╝ПщФБцЦ╣цбИхп╣цпФ</h2> <p>цХ░цНох║УхИЖх╕Гх╝ПщФБя╝МщЧощвШцпФш╛ГхдЪя╝МшзгхЖ│ш╡╖цЭецпФш╛Гщ║╗чГжя╝Мф╕НцОишНРуАВ</p> <p>цАзшГ╜я╝Ъ</p> <ul><li>Redis хИЖх╕Гх╝ПщФБя╝МхЕ╢хоЮ<strong>щЬАшжБшЗкх╖▒ф╕НцЦншЗкцЧЛхО╗х░ЭшпХшО╖хПЦщФБ</strong>я╝МцпФш╛Гц╢ИшАЧцАзшГ╜уАВ</li> <li>ZooKeeper хИЖх╕Гх╝ПщФБя╝МшО╖хПЦф╕НхИ░щФБя╝Мц│ихЖМф╕кчЫСхРмхЩихН│хПпя╝Мф╕НщЬАшжБф╕НцЦнф╕╗хКих░ЭшпХшО╖хПЦщФБя╝МцАзшГ╜х╝АщФАш╛Гх░ПуАВ</li></ul> <p>хПпщЭацАзя╝Ъ</p> <ul><li>хжВцЮЬцШп redis шО╖хПЦщФБчЪДщВгф╕кховцИ╖члпхЗ║чО░ bug цМВф║Жя╝МщВгф╣ИхПкшГ╜чнЙх╛Еш╢ЕцЧ╢цЧ╢щЧ┤ф╣ЛхРОцЙНшГ╜щЗКцФ╛щФБя╝Ы</li> <li>шАМ zk чЪДшпЭя╝МхЫаф╕║хИЫх╗║чЪДцШпф╕┤цЧ╢ znodeя╝МхПкшжБховцИ╖члпцМВф║Жя╝Мznode х░▒ц▓бф║Жя╝МцндцЧ╢х░▒шЗкхКищЗКцФ╛щФБуАВ</li></ul> <p>ч╗╝ф╕КхИЖцЮРя╝М<strong>ZooKeeper хоЮчО░хИЖх╕Гх╝ПщФБцЫ┤хКачЪДчоАхНХя╝МхПпщЭацАзцЫ┤щлШ</strong>уАВтЬЕ</p> <h2 id="хПВшАГш╡ДцЦЩ"><a href="#хПВшАГш╡ДцЦЩ" class="header-anchor">#</a> хПВшАГш╡ДцЦЩ</h2> <ul><li><a href="https://juejin.im/post/5a20cd8bf265da43163cdd9a" target="_blank" rel="noopener noreferrer">хИЖх╕Гх╝ПщФБхоЮчО░ц▒ЗцА╗<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.jianshu.com/p/1c5c1a592088" target="_blank" rel="noopener noreferrer">Redis хоЮчО░хИЖх╕Гх╝ПщФБя╝Мф╗ехПКхПпщЗНхЕещФБцАЭш╖п<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/design/edit/master/docs/distributed/хИЖх╕Гх╝ПщФБ.md" target="_blank" rel="noopener noreferrer">х╕охКйцИСф╗мцФ╣хЦДцндщб╡щЭвя╝Б</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ф╕КцмбцЫ┤цЦ░:</span> <span class="time">3 months ago</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/design/assets/js/app.31535b90.js" defer></script><script src="/design/assets/js/4.843d76c1.js" defer></script><script src="/design/assets/js/33.3a07575c.js" defer></script><script src="/design/assets/js/5.eb6f8f38.js" defer></script>
  </body>
</html>
