(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{430:function(t,s,a){"use strict";a.r(s);var n=a(15),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†"}},[t._v("#")]),t._v(" åˆ†å¸ƒå¼é”åŸºæœ¬åŸç†")]),t._v(" "),a("blockquote",[a("p",[t._v("åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸ºäº†ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæˆ‘ä»¬å¸¸å¸¸è¦é€šè¿‡äº’æ–¥ï¼ˆåŠ é”ï¼‰æ‰‹æ®µæ¥ä¿è¯æ•°æ®åŒæ­¥å®‰å…¨ã€‚")]),t._v(" "),a("p",[t._v("JDK è™½ç„¶æä¾›äº†å¤§é‡é”å·¥å…·ï¼Œä½†æ˜¯åªèƒ½ä½œç”¨äºå•ä¸€ Java è¿›ç¨‹ï¼Œæ— æ³•åº”ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”ã€‚")]),t._v(" "),a("p",[t._v("åˆ†å¸ƒå¼é”çš„è§£å†³æ–¹æ¡ˆå¤§è‡´æœ‰ä»¥ä¸‹å‡ ç§ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("åŸºäºæ•°æ®åº“å®ç°")]),t._v(" "),a("li",[t._v("åŸºäºç¼“å­˜ï¼ˆredisï¼Œmemcached ç­‰ï¼‰å®ç°")]),t._v(" "),a("li",[t._v("åŸºäº Zookeeper å®ç° âœ…")])]),t._v(" "),a("p",[t._v("æ³¨ï¼šæ¨èåŸºäº ZooKeeper å®ç°åˆ†å¸ƒå¼é”ï¼Œå…·ä½“åŸå› çœ‹å®Œæœ¬æ–‡å³å¯æ˜äº†ã€‚")]),t._v(" "),a("p",[t._v("ğŸ“¦ æœ¬æ–‡å·²å½’æ¡£åˆ°ï¼šã€Œ"),a("a",{attrs:{href:"https://github.com/dunwu/blog",target:"_blank",rel:"noopener noreferrer"}},[t._v("blog"),a("OutboundLink")],1),t._v("ã€")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E4%B8%80%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%80%9D%E8%B7%AF"}},[t._v("ä¸€ã€åˆ†å¸ƒå¼é”æ€è·¯")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BA%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"}},[t._v("äºŒã€æ•°æ®åº“åˆ†å¸ƒå¼é”")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%8E%9F%E7%90%86"}},[t._v("æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E9%97%AE%E9%A2%98"}},[t._v("æ•°æ®åº“åˆ†å¸ƒå¼é”é—®é¢˜")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%B0%8F%E7%BB%93"}},[t._v("æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%B8%89redis-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"}},[t._v("ä¸‰ã€Redis åˆ†å¸ƒå¼é”")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#redis-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%8E%9F%E7%90%86"}},[t._v("Redis åˆ†å¸ƒå¼é”åŸç†")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#redis-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0"}},[t._v("Redis åˆ†å¸ƒå¼é”å®ç°")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%B0%8F%E7%BB%93-1"}},[t._v("æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#redlock-%E7%AE%97%E6%B3%95"}},[t._v("RedLock ç®—æ³•")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%9B%9Bzookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"}},[t._v("å››ã€ZooKeeper åˆ†å¸ƒå¼é”")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#zookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%8E%9F%E7%90%86"}},[t._v("ZooKeeper åˆ†å¸ƒå¼é”åŸç†")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#zookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0"}},[t._v("ZooKeeper åˆ†å¸ƒå¼é”å®ç°")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#zookeeper-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%B0%8F%E7%BB%93"}},[t._v("ZooKeeper åˆ†å¸ƒå¼é”å°ç»“")])])])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E4%BA%94-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94"}},[t._v("äº”ã€ åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯”")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"}},[t._v("å‚è€ƒèµ„æ–™")])])]),t._v(" "),a("h2",{attrs:{id:"ä¸€ã€åˆ†å¸ƒå¼é”æ€è·¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€åˆ†å¸ƒå¼é”æ€è·¯"}},[t._v("#")]),t._v(" ä¸€ã€åˆ†å¸ƒå¼é”æ€è·¯")]),t._v(" "),a("p",[t._v("åˆ†å¸ƒå¼é”çš„æ€»ä½“æ€è·¯å¤§åŒå°å¼‚ï¼Œä»…åœ¨å®ç°ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚")]),t._v(" "),a("p",[t._v("åˆ†å¸ƒå¼é”çš„ä¸»è¦æ€è·¯å¦‚ä¸‹ï¼š")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("äº’æ–¥ã€å¯é‡å…¥")]),t._v(" - åˆ›å»ºé”å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œè¡¨ç°å½¢å¼ä¸ºå‘æ•°æ®å­˜å‚¨æœåŠ¡å™¨æˆ–å®¹å™¨æ’å…¥ä¸€ä¸ªå”¯ä¸€çš„ keyï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªçº¿ç¨‹æ’å…¥è¿™ä¸ª keyï¼Œå…¶ä»–çº¿ç¨‹å°±ä¸èƒ½å†æ’å…¥äº†ã€‚\n"),a("ul",[a("li",[t._v("ä¿è¯ key å”¯ä¸€æ€§çš„æœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨ UUIDã€‚")]),t._v(" "),a("li",[t._v("å­˜å‚¨é”çš„é‡å…¥æ¬¡æ•°ï¼Œä»¥åŠåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å”¯ä¸€çš„çº¿ç¨‹æ ‡è¯†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ json å­˜å‚¨ç»“æ„åŒ–æ•°æ®ï¼Œä¸ºäº†ä¿è¯å”¯ä¸€ï¼Œå¯ä»¥è€ƒè™‘å°† mac åœ°å€ï¼ˆIP åœ°å€ã€æœºå™¨ IDï¼‰ã€Jvm è¿›ç¨‹ IDï¼ˆåº”ç”¨ IDã€æœåŠ¡ IDï¼‰ã€çº¿ç¨‹ ID æ‹¼æ¥èµ·æ¥ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚"),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{"count":1,"expireAt":147506817232,"jvmPid":22224,"mac":"28-D2-44-0E-0D-9A","threadId":14}\n')])])])])])]),t._v(" "),a("li",[a("strong",[t._v("é¿å…æ­»é”")]),t._v(" - æ•°æ®åº“åˆ†å¸ƒå¼é”å’Œç¼“å­˜åˆ†å¸ƒå¼é”ï¼ˆRedisï¼‰çš„æ€è·¯éƒ½æ˜¯å¼•å…¥è¶…æ—¶æœºåˆ¶ï¼Œå³æˆåŠŸç”³è¯·é”åï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œé”å¤±æ•ˆï¼ˆåˆ é™¤ keyï¼‰ï¼ŒåŸå› åœ¨äºå®ƒä»¬æ— æ³•æ„ŸçŸ¥ç”³è¯·é”çš„å®¢æˆ·ç«¯èŠ‚ç‚¹çŠ¶æ€ã€‚è€Œ ZooKeeper ç”±äºå…¶ znode ä»¥ç›®å½•ã€æ–‡ä»¶å½¢å¼ç»„ç»‡ï¼Œå¤©ç„¶å°±å­˜åœ¨ç‰©ç†ç©ºé—´éš”ç¦»ï¼Œåªè¦ znode å­˜åœ¨ï¼Œå³è¡¨ç¤ºå®¢æˆ·ç«¯èŠ‚ç‚¹è¿˜åœ¨å·¥ä½œï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¿™ç§é—®é¢˜ã€‚")]),t._v(" "),a("li",[a("strong",[t._v("å®¹é”™")]),t._v(" - åªè¦å¤§éƒ¨åˆ† Redis èŠ‚ç‚¹å¯ç”¨ï¼Œå®¢æˆ·ç«¯å°±èƒ½æ­£å¸¸åŠ é”ã€‚")]),t._v(" "),a("li",[a("strong",[t._v("è‡ªæ—‹é‡è¯•")]),t._v(" - è·å–ä¸åˆ°é”æ—¶ï¼Œä¸è¦ç›´æ¥è¿”å›å¤±è´¥ï¼Œè€Œæ˜¯æ”¯æŒä¸€å®šçš„å‘¨æœŸè‡ªæ—‹é‡è¯•ï¼Œè®¾ç½®ä¸€ä¸ªæ€»çš„è¶…æ—¶æ—¶é—´ï¼Œå½“è¿‡äº†è¶…æ—¶æ—¶é—´ä»¥åè¿˜æ²¡æœ‰è·å–åˆ°é”åˆ™è¿”å›å¤±è´¥ã€‚")])]),t._v(" "),a("h2",{attrs:{id:"äºŒã€æ•°æ®åº“åˆ†å¸ƒå¼é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€æ•°æ®åº“åˆ†å¸ƒå¼é”"}},[t._v("#")]),t._v(" äºŒã€æ•°æ®åº“åˆ†å¸ƒå¼é”")]),t._v(" "),a("h3",{attrs:{id:"æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†"}},[t._v("#")]),t._v(" æ•°æ®åº“åˆ†å¸ƒå¼é”åŸç†")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰åˆ›å»ºè¡¨")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("methodLock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AUTO_INCREMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ä¸»é”®'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("method_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'é”å®šçš„æ–¹æ³•å'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'å¤‡æ³¨ä¿¡æ¯'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("update_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("timestamp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("NOT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("NULL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UPDATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CURRENT_TIMESTAMP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ä¿å­˜æ•°æ®æ—¶é—´ï¼Œè‡ªåŠ¨ç”Ÿæˆ'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIMARY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNIQUE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("KEY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("uidx_method_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("method_name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USING")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BTREE")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("InnoDB")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COMMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'é”å®šä¸­çš„æ–¹æ³•'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("ï¼ˆ2ï¼‰è·å–é”")]),t._v(" "),a("p",[t._v("æƒ³è¦é”ä½æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹ SQLï¼š")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("into")]),t._v(" methodLock"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("method_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("values")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("â€˜method_nameâ€™"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("â€˜"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("desc")]),t._v("â€™"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("å› ä¸ºæˆ‘ä»¬å¯¹ "),a("code",[t._v("method_name")]),t._v(" åšäº†å”¯ä¸€æ€§çº¦æŸï¼Œè¿™é‡Œå¦‚æœæœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶æäº¤åˆ°æ•°æ®åº“çš„è¯ï¼Œæ•°æ®åº“ä¼šä¿è¯åªæœ‰ä¸€ä¸ªæ“ä½œå¯ä»¥æˆåŠŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºæ“ä½œæˆåŠŸçš„é‚£ä¸ªçº¿ç¨‹è·å¾—äº†è¯¥æ–¹æ³•çš„é”ï¼Œå¯ä»¥æ‰§è¡Œæ–¹æ³•ä½“å†…å®¹ã€‚")]),t._v(" "),a("p",[t._v("æˆåŠŸæ’å…¥åˆ™è·å–é”ã€‚")]),t._v(" "),a("p",[t._v("ï¼ˆ3ï¼‰é‡Šæ”¾é”")]),t._v(" "),a("p",[t._v("å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæƒ³è¦é‡Šæ”¾é”çš„è¯ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹ Sql:")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" methodLock "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("where")]),t._v(" method_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'method_name'")]),t._v("\n")])])]),a("h3",{attrs:{id:"æ•°æ®åº“åˆ†å¸ƒå¼é”é—®é¢˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®åº“åˆ†å¸ƒå¼é”é—®é¢˜"}},[t._v("#")]),t._v(" æ•°æ®åº“åˆ†å¸ƒå¼é”é—®é¢˜")]),t._v(" "),a("ul",[a("li",[t._v("è¿™æŠŠé”å¼ºä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ã€‚å¦‚æœæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚")]),t._v(" "),a("li",[t._v("è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£é”æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´é”è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†è·å¾—åˆ°é”ã€‚")]),t._v(" "),a("li",[t._v("è¿™æŠŠé”åªèƒ½æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºæ•°æ®çš„ insert æ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æ¥æŠ¥é”™ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡è·å¾—é”å°±è¦å†æ¬¡è§¦å‘è·å¾—é”æ“ä½œã€‚")]),t._v(" "),a("li",[t._v("è¿™æŠŠé”æ˜¯éé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚")])]),t._v(" "),a("p",[t._v("è§£å†³åŠæ³•ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å•ç‚¹é—®é¢˜å¯ä»¥ç”¨å¤šæ•°æ®åº“å®ä¾‹ï¼ŒåŒæ—¶å¡ N ä¸ªè¡¨ï¼ŒN/2+1 ä¸ªæˆåŠŸå°±ä»»åŠ¡é”å®šæˆåŠŸ")]),t._v(" "),a("li",[t._v("å†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œéš”ä¸€æ®µæ—¶é—´æ¸…é™¤ä¸€æ¬¡è¿‡æœŸçš„æ•°æ®ã€‚")]),t._v(" "),a("li",[t._v("å†™ä¸€ä¸ª while å¾ªç¯ï¼Œä¸æ–­çš„é‡è¯•æ’å…¥ï¼Œç›´åˆ°æˆåŠŸã€‚")]),t._v(" "),a("li",[t._v("åœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰è·å¾—é”çš„æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†è·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œç›´æ¥æŠŠé”åˆ†é…ç»™ä»–å°±å¯ä»¥äº†ã€‚")])]),t._v(" "),a("h3",{attrs:{id:"æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“"}},[t._v("#")]),t._v(" æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“")]),t._v(" "),a("ul",[a("li",[t._v("ä¼˜ç‚¹: ç›´æ¥å€ŸåŠ©æ•°æ®åº“ï¼Œå®¹æ˜“ç†è§£ã€‚")]),t._v(" "),a("li",[t._v("ç¼ºç‚¹: ä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œåœ¨è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­ä¼šä½¿æ•´ä¸ªæ–¹æ¡ˆå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚æ“ä½œæ•°æ®åº“éœ€è¦ä¸€å®šçš„å¼€é”€ï¼Œæ€§èƒ½é—®é¢˜éœ€è¦è€ƒè™‘ã€‚")])]),t._v(" "),a("h2",{attrs:{id:"ä¸‰ã€redis-åˆ†å¸ƒå¼é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€redis-åˆ†å¸ƒå¼é”"}},[t._v("#")]),t._v(" ä¸‰ã€Redis åˆ†å¸ƒå¼é”")]),t._v(" "),a("p",[t._v("ç›¸æ¯”äºç”¨æ•°æ®åº“æ¥å®ç°åˆ†å¸ƒå¼é”ï¼ŒåŸºäºç¼“å­˜å®ç°çš„åˆ†å¸ƒå¼é”çš„æ€§èƒ½ä¼šæ›´å¥½ã€‚ç›®å‰æœ‰å¾ˆå¤šæˆç†Ÿçš„åˆ†å¸ƒå¼äº§å“ï¼ŒåŒ…æ‹¬ Redisã€memcacheã€Tair ç­‰ã€‚è¿™é‡Œä»¥ Redis ä¸¾ä¾‹ã€‚")]),t._v(" "),a("h3",{attrs:{id:"redis-åˆ†å¸ƒå¼é”åŸç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-åˆ†å¸ƒå¼é”åŸç†"}},[t._v("#")]),t._v(" Redis åˆ†å¸ƒå¼é”åŸç†")]),t._v(" "),a("p",[t._v("è¿™ä¸ªåˆ†å¸ƒå¼é”æœ‰ 3 ä¸ªé‡è¦çš„è€ƒé‡ç‚¹ï¼š")]),t._v(" "),a("ol",[a("li",[t._v("äº’æ–¥ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è·å–é”ï¼‰")]),t._v(" "),a("li",[t._v("ä¸èƒ½æ­»é”")]),t._v(" "),a("li",[t._v("å®¹é”™ï¼ˆåªè¦å¤§éƒ¨åˆ† redis èŠ‚ç‚¹åˆ›å»ºäº†è¿™æŠŠé”å°±å¯ä»¥ï¼‰")])]),t._v(" "),a("p",[t._v("å¯¹åº”çš„ Redis æŒ‡ä»¤å¦‚ä¸‹ï¼š")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("setnx")]),t._v(" - "),a("code",[t._v("setnx key val")]),t._v("ï¼šå½“ä¸”ä»…å½“ key ä¸å­˜åœ¨æ—¶ï¼Œset ä¸€ä¸ª key ä¸º val çš„å­—ç¬¦ä¸²ï¼Œè¿”å› 1ï¼›è‹¥ key å­˜åœ¨ï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å› 0ã€‚")]),t._v(" "),a("li",[a("code",[t._v("expire")]),t._v(" - "),a("code",[t._v("expire key timeout")]),t._v("ï¼šä¸º key è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸º secondï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚")]),t._v(" "),a("li",[a("code",[t._v("delete")]),t._v(" - "),a("code",[t._v("delete key")]),t._v("ï¼šåˆ é™¤ key")])]),t._v(" "),a("blockquote",[a("p",[t._v("æ³¨æ„ï¼š")]),t._v(" "),a("p",[t._v("ä¸è¦å°† "),a("code",[t._v("setnx")]),t._v(" å’Œ "),a("code",[t._v("expire")]),t._v(" ä½œä¸ºä¸¤ä¸ªå‘½ä»¤ç»„åˆå®ç°åŠ é”ï¼Œè¿™æ ·å°±"),a("strong",[t._v("æ— æ³•ä¿è¯åŸå­æ€§")]),t._v("ã€‚å¦‚æœå®¢æˆ·ç«¯åœ¨ "),a("code",[t._v("setnx")]),t._v(" ä¹‹åå´©æºƒï¼Œé‚£ä¹ˆå°†å¯¼è‡´é”æ— æ³•é‡Šæ”¾ã€‚æ­£ç¡®çš„åšæ³•åº”æ˜¯åœ¨ "),a("code",[t._v("setnx")]),t._v(" å‘½ä»¤ä¸­æŒ‡å®š "),a("code",[t._v("expire")]),t._v(" æ—¶é—´ã€‚")])]),t._v(" "),a("h3",{attrs:{id:"redis-åˆ†å¸ƒå¼é”å®ç°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-åˆ†å¸ƒå¼é”å®ç°"}},[t._v("#")]),t._v(" Redis åˆ†å¸ƒå¼é”å®ç°")]),t._v(" "),a("p",[t._v("ï¼ˆ1ï¼‰ç”³è¯·é”")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SET resource_name my_random_value NX PX 30000\n")])])]),a("p",[t._v("æ‰§è¡Œè¿™ä¸ªå‘½ä»¤å°± okã€‚")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("NX")]),t._v("ï¼šè¡¨ç¤ºåªæœ‰ "),a("code",[t._v("key")]),t._v(" ä¸å­˜åœ¨çš„æ—¶å€™æ‰ä¼šè®¾ç½®æˆåŠŸã€‚ï¼ˆå¦‚æœæ­¤æ—¶ redis ä¸­å­˜åœ¨è¿™ä¸ª keyï¼Œé‚£ä¹ˆè®¾ç½®å¤±è´¥ï¼Œè¿”å› "),a("code",[t._v("nil")]),t._v("ï¼‰")]),t._v(" "),a("li",[a("code",[t._v("PX 30000")]),t._v("ï¼šæ„æ€æ˜¯ 30s åé”è‡ªåŠ¨é‡Šæ”¾ã€‚åˆ«äººåˆ›å»ºçš„æ—¶å€™å¦‚æœå‘ç°å·²ç»æœ‰äº†å°±ä¸èƒ½åŠ é”äº†ã€‚")])]),t._v(" "),a("p",[t._v("ï¼ˆ2ï¼‰é‡Šæ”¾é”")]),t._v(" "),a("p",[t._v("é‡Šæ”¾é”å°±æ˜¯åˆ é™¤ key ï¼Œä½†æ˜¯ä¸€èˆ¬å¯ä»¥ç”¨ "),a("code",[t._v("lua")]),t._v(" è„šæœ¬åˆ é™¤ï¼Œåˆ¤æ–­ value ä¸€æ ·æ‰åˆ é™¤ï¼š")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" åˆ é™¤é”çš„æ—¶å€™ï¼Œæ‰¾åˆ° key å¯¹åº”çš„ valueï¼Œè·Ÿè‡ªå·±ä¼ è¿‡å»çš„ value åšæ¯”è¾ƒï¼Œå¦‚æœæ˜¯ä¸€æ ·çš„æ‰åˆ é™¤ã€‚\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("KEYS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" ARGV"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" then\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("call"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"del"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("KEYS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nend\n")])])]),a("h3",{attrs:{id:"æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“-2"}},[t._v("#")]),t._v(" æ•°æ®åº“åˆ†å¸ƒå¼é”å°ç»“")]),t._v(" "),a("p",[t._v("ä¸ºå•¥è¦ç”¨ "),a("code",[t._v("random_value")]),t._v(" éšæœºå€¼å‘¢ï¼Ÿå› ä¸ºå¦‚æœæŸä¸ªå®¢æˆ·ç«¯è·å–åˆ°äº†é”ï¼Œä½†æ˜¯é˜»å¡äº†å¾ˆé•¿æ—¶é—´æ‰æ‰§è¡Œå®Œï¼Œæ¯”å¦‚è¯´è¶…è¿‡äº† 30sï¼Œæ­¤æ—¶å¯èƒ½å·²ç»è‡ªåŠ¨é‡Šæ”¾é”äº†ï¼Œæ­¤æ—¶å¯èƒ½åˆ«çš„å®¢æˆ·ç«¯å·²ç»è·å–åˆ°äº†è¿™ä¸ªé”ï¼Œè¦æ˜¯ä½ è¿™ä¸ªæ—¶å€™ç›´æ¥åˆ é™¤ key çš„è¯ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥å¾—ç”¨éšæœºå€¼åŠ ä¸Šé¢çš„ "),a("code",[t._v("lua")]),t._v(" è„šæœ¬æ¥é‡Šæ”¾é”ã€‚")]),t._v(" "),a("p",[t._v("ä½†æ˜¯è¿™æ ·æ˜¯è‚¯å®šä¸è¡Œçš„ã€‚å› ä¸ºå¦‚æœæ˜¯æ™®é€šçš„ redis å•å®ä¾‹ï¼Œé‚£å°±æ˜¯å•ç‚¹æ•…éšœã€‚æˆ–è€…æ˜¯ redis æ™®é€šä¸»ä»ï¼Œé‚£ redis ä¸»ä»å¼‚æ­¥å¤åˆ¶ï¼Œå¦‚æœä¸»èŠ‚ç‚¹æŒ‚äº†ï¼ˆkey å°±æ²¡æœ‰äº†ï¼‰ï¼Œkey è¿˜æ²¡åŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼Œæ­¤æ—¶ä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œåˆ«äººå°±å¯ä»¥ set keyï¼Œä»è€Œæ‹¿åˆ°é”ã€‚")]),t._v(" "),a("h3",{attrs:{id:"redlock-ç®—æ³•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redlock-ç®—æ³•"}},[t._v("#")]),t._v(" RedLock ç®—æ³•")]),t._v(" "),a("p",[t._v("è¿™ä¸ªåœºæ™¯æ˜¯å‡è®¾æœ‰ä¸€ä¸ª redis clusterï¼Œæœ‰ 5 ä¸ª redis master å®ä¾‹ã€‚ç„¶åæ‰§è¡Œå¦‚ä¸‹æ­¥éª¤è·å–ä¸€æŠŠé”ï¼š")]),t._v(" "),a("ol",[a("li",[t._v("è·å–å½“å‰æ—¶é—´æˆ³ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼›")]),t._v(" "),a("li",[t._v("è·Ÿä¸Šé¢ç±»ä¼¼ï¼Œè½®æµå°è¯•åœ¨æ¯ä¸ª master èŠ‚ç‚¹ä¸Šåˆ›å»ºé”ï¼Œè¿‡æœŸæ—¶é—´è¾ƒçŸ­ï¼Œä¸€èˆ¬å°±å‡ åæ¯«ç§’ï¼›")]),t._v(" "),a("li",[t._v("å°è¯•åœ¨"),a("strong",[t._v("å¤§å¤šæ•°èŠ‚ç‚¹")]),t._v("ä¸Šå»ºç«‹ä¸€ä¸ªé”ï¼Œæ¯”å¦‚ 5 ä¸ªèŠ‚ç‚¹å°±è¦æ±‚æ˜¯ 3 ä¸ªèŠ‚ç‚¹ "),a("code",[t._v("n / 2 + 1")]),t._v("ï¼›")]),t._v(" "),a("li",[t._v("å®¢æˆ·ç«¯è®¡ç®—å»ºç«‹å¥½é”çš„æ—¶é—´ï¼Œå¦‚æœå»ºç«‹é”çš„æ—¶é—´å°äºè¶…æ—¶æ—¶é—´ï¼Œå°±ç®—å»ºç«‹æˆåŠŸäº†ï¼›")]),t._v(" "),a("li",[t._v("è¦æ˜¯é”å»ºç«‹å¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¾æ¬¡ä¹‹å‰å»ºç«‹è¿‡çš„é”åˆ é™¤ï¼›")]),t._v(" "),a("li",[t._v("åªè¦åˆ«äººå»ºç«‹äº†ä¸€æŠŠåˆ†å¸ƒå¼é”ï¼Œä½ å°±å¾—"),a("strong",[t._v("ä¸æ–­è½®è¯¢å»å°è¯•è·å–é”")]),t._v("ã€‚")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis å®˜æ–¹"),a("OutboundLink")],1),t._v("ç»™å‡ºäº†ä»¥ä¸Šä¸¤ç§åŸºäº Redis å®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ³•ï¼Œè¯¦ç»†è¯´æ˜å¯ä»¥æŸ¥çœ‹ï¼š"),a("a",{attrs:{href:"https://redis.io/topics/distlock",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://redis.io/topics/distlock"),a("OutboundLink")],1),t._v(" ã€‚")]),t._v(" "),a("h2",{attrs:{id:"å››ã€zookeeper-åˆ†å¸ƒå¼é”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€zookeeper-åˆ†å¸ƒå¼é”"}},[t._v("#")]),t._v(" å››ã€ZooKeeper åˆ†å¸ƒå¼é”")]),t._v(" "),a("h3",{attrs:{id:"zookeeper-åˆ†å¸ƒå¼é”åŸç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-åˆ†å¸ƒå¼é”åŸç†"}},[t._v("#")]),t._v(" ZooKeeper åˆ†å¸ƒå¼é”åŸç†")]),t._v(" "),a("p",[t._v("ZooKeeper å®ç°åˆ†å¸ƒå¼é”åŸºäº ZooKeeper çš„ä¸¤ä¸ªç‰¹æ€§ï¼š")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("é¡ºåºä¸´æ—¶èŠ‚ç‚¹")]),t._v("ï¼šZooKeeper çš„å­˜å‚¨ç±»ä¼¼äº DNS é‚£æ ·çš„å…·æœ‰å±‚çº§çš„å‘½åç©ºé—´ã€‚ZooKeeper èŠ‚ç‚¹ç±»å‹å¯ä»¥åˆ†ä¸ºæŒä¹…èŠ‚ç‚¹ï¼ˆPERSISTENT ï¼‰ã€ä¸´æ—¶èŠ‚ç‚¹ï¼ˆEPHEMERALï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹è¿˜èƒ½è¢«æ ‡è®°ä¸ºæœ‰åºæ€§ï¼ˆSEQUENTIALï¼‰ï¼Œä¸€æ—¦èŠ‚ç‚¹è¢«æ ‡è®°ä¸ºæœ‰åºæ€§ï¼Œé‚£ä¹ˆæ•´ä¸ªèŠ‚ç‚¹å°±å…·æœ‰é¡ºåºè‡ªå¢çš„ç‰¹ç‚¹ã€‚")]),t._v(" "),a("li",[a("strong",[t._v("Watch æœºåˆ¶")]),t._v("ï¼šZooKeeper å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº› Watcherï¼Œå¹¶ä¸”åœ¨ç‰¹å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼ŒZooKeeper æœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥ç»™ç”¨æˆ·ã€‚")])]),t._v(" "),a("p",[t._v("è¿™ä¹Ÿæ˜¯ ZooKeeper å®¢æˆ·ç«¯ curator çš„åˆ†å¸ƒå¼é”å®ç°ã€‚")]),t._v(" "),a("ol",[a("li",[t._v("åˆ›å»ºä¸€ä¸ªç›®å½• mylockï¼›")]),t._v(" "),a("li",[t._v("çº¿ç¨‹ A æƒ³è·å–é”å°±åœ¨ mylock ç›®å½•ä¸‹åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼›")]),t._v(" "),a("li",[t._v("è·å– mylock ç›®å½•ä¸‹æ‰€æœ‰çš„å­èŠ‚ç‚¹ï¼Œç„¶åè·å–æ¯”è‡ªå·±å°çš„å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜å½“å‰çº¿ç¨‹é¡ºåºå·æœ€å°ï¼Œè·å¾—é”ï¼›")]),t._v(" "),a("li",[t._v("çº¿ç¨‹ B è·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ¤æ–­è‡ªå·±ä¸æ˜¯æœ€å°èŠ‚ç‚¹ï¼Œè®¾ç½®ç›‘å¬æ¯”è‡ªå·±æ¬¡å°çš„èŠ‚ç‚¹ï¼›")]),t._v(" "),a("li",[t._v("çº¿ç¨‹ A å¤„ç†å®Œï¼Œåˆ é™¤è‡ªå·±çš„èŠ‚ç‚¹ï¼Œçº¿ç¨‹ B ç›‘å¬åˆ°å˜æ›´äº‹ä»¶ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯åˆ™è·å¾—é”ã€‚")])]),t._v(" "),a("h3",{attrs:{id:"zookeeper-åˆ†å¸ƒå¼é”å®ç°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-åˆ†å¸ƒå¼é”å®ç°"}},[t._v("#")]),t._v(" ZooKeeper åˆ†å¸ƒå¼é”å®ç°")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * ZooKeeperSession\n *\n * @author bingo\n * @since 2018/11/29\n *\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperSession")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),t._v(" connectedSemaphore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeper")]),t._v(" zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),t._v(" latch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("zookeeper "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.31.187:2181,192.168.31.19:2181,192.168.31.227:2181"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperWatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                connectedSemaphore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ZooKeeper session established......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * è·å–åˆ†å¸ƒå¼é”\n     *\n     * @param productId\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Boolean")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireDistributedLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" productId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/product-lock-"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" productId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ids")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OPEN_ACL_UNSAFE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CreateMode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EPHEMERAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç›¸å½“äºæ˜¯ç»™nodeæ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œå»çœ‹çœ‹è¿™ä¸ªç›‘å¬å™¨æ˜¯å¦å­˜åœ¨")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Stat")]),t._v(" stat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exists")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("waitTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MILLISECONDS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBytes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ids")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OPEN_ACL_UNSAFE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CreateMode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EPHEMERAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" ee"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("continue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * é‡Šæ”¾æ‰ä¸€ä¸ªåˆ†å¸ƒå¼é”\n     *\n     * @param productId\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("releaseDistributedLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" productId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/product-lock-"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" productId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            zookeeper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"release the lock for product[id="')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" productId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"]......"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * å»ºç«‹zk sessionçš„watcher\n     *\n     * @author bingo\n     * @since 2018/11/29\n     *\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperWatcher")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("process")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WatchedEvent")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Receive watched event: "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeeperState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SyncConnected")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                connectedSemaphore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("countDown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("countDown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * å°è£…å•ä¾‹çš„é™æ€å†…éƒ¨ç±»\n     *\n     * @author bingo\n     * @since 2018/11/29\n     *\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Singleton")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperSession")]),t._v(" instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            instance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperSession")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" instance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * è·å–å•ä¾‹\n     *\n     * @return\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperSession")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Singleton")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * åˆå§‹åŒ–å•ä¾‹çš„ä¾¿æ·æ–¹æ³•\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("ä¹Ÿå¯ä»¥é‡‡ç”¨å¦ä¸€ç§æ–¹å¼ï¼Œåˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹ï¼š")]),t._v(" "),a("p",[t._v("å¦‚æœæœ‰ä¸€æŠŠé”ï¼Œè¢«å¤šä¸ªäººç»™ç«äº‰ï¼Œæ­¤æ—¶å¤šä¸ªäººä¼šæ’é˜Ÿï¼Œç¬¬ä¸€ä¸ªæ‹¿åˆ°é”çš„äººä¼šæ‰§è¡Œï¼Œç„¶åé‡Šæ”¾é”ï¼›åé¢çš„æ¯ä¸ªäººéƒ½ä¼šå»ç›‘å¬"),a("strong",[t._v("æ’åœ¨è‡ªå·±å‰é¢")]),t._v("çš„é‚£ä¸ªäººåˆ›å»ºçš„ node ä¸Šï¼Œä¸€æ—¦æŸä¸ªäººé‡Šæ”¾äº†é”ï¼Œæ’åœ¨è‡ªå·±åé¢çš„äººå°±ä¼šè¢« zookeeper ç»™é€šçŸ¥ï¼Œä¸€æ—¦è¢«é€šçŸ¥äº†ä¹‹åï¼Œå°± ok äº†ï¼Œè‡ªå·±å°±è·å–åˆ°äº†é”ï¼Œå°±å¯ä»¥æ‰§è¡Œä»£ç äº†ã€‚")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperDistributedLock")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeper")]),t._v(" zk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" locksRoot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/locks"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" productId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" waitNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" lockNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),t._v(" latch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),t._v(" connectedLatch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" sessionTimeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeperDistributedLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" productId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("productId "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" productId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" address "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.31.187:2181,192.168.31.19:2181,192.168.31.227:2181"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            zk "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooKeeper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sessionTimeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            connectedLatch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeeperException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("process")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WatchedEvent")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeeperState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SyncConnected")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            connectedLatch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("countDown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("countDown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireDistributedLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("waitForLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("waitNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sessionTimeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeeperException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n \t\t    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¼ å…¥è¿›å»çš„locksRoot + â€œ/â€ + productId")]),t._v("\n\t\t    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‡è®¾productIdä»£è¡¨äº†ä¸€ä¸ªå•†å“idï¼Œæ¯”å¦‚è¯´1")]),t._v("\n\t\t    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// locksRoot = locks")]),t._v("\n\t\t    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// /locks/10000000000ï¼Œ/locks/10000000001ï¼Œ/locks/10000000002")]),t._v("\n            lockNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("locksRoot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" productId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ZooDefs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Ids")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OPEN_ACL_UNSAFE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CreateMode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EPHEMERAL_SEQUENTIAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// çœ‹çœ‹åˆšåˆ›å»ºçš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹")]),t._v("\n\t \t    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// locksï¼š10000000000ï¼Œ10000000001ï¼Œ10000000002")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" locks "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getChildren")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("locksRoot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collections")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lockNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("locksRoot"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å¦‚æœæ˜¯æœ€å°çš„èŠ‚ç‚¹,åˆ™è¡¨ç¤ºå–å¾—é”")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å¦‚æœä¸æ˜¯æœ€å°çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹")]),t._v("\n\t  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" previousLockIndex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lockNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("locksRoot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" â€œ"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("â€ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t         \t    previousLockIndex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" locks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("previousLockIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeeperException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("waitForLock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" waitNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" waitTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeeperException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Stat")]),t._v(" stat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" zk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exists")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("locksRoot "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" waitNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stat "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CountDownLatch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("waitTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MILLISECONDS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("latch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ é™¤/locks/10000000000èŠ‚ç‚¹")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ é™¤/locks/10000000001èŠ‚ç‚¹")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"unlock "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" lockNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            zk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lockNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            lockNode "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            zk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KeeperException")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RuntimeException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" serialVersionUID "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1L")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LockException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"zookeeper-åˆ†å¸ƒå¼é”å°ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-åˆ†å¸ƒå¼é”å°ç»“"}},[t._v("#")]),t._v(" ZooKeeper åˆ†å¸ƒå¼é”å°ç»“")]),t._v(" "),a("p",[t._v("ZooKeeper ç‰ˆæœ¬çš„åˆ†å¸ƒå¼é”é—®é¢˜ç›¸å¯¹æ¯”è¾ƒæ¥è¯´å°‘ã€‚")]),t._v(" "),a("ul",[a("li",[t._v("é”çš„å ç”¨æ—¶é—´é™åˆ¶ï¼šredis å°±æœ‰å ç”¨æ—¶é—´é™åˆ¶ï¼Œè€Œ ZooKeeper åˆ™æ²¡æœ‰ï¼Œæœ€ä¸»è¦çš„åŸå› æ˜¯ redis ç›®å‰æ²¡æœ‰åŠæ³•çŸ¥é“å·²ç»è·å–é”çš„å®¢æˆ·ç«¯çš„çŠ¶æ€ï¼Œæ˜¯å·²ç»æŒ‚äº†å‘¢è¿˜æ˜¯æ­£åœ¨æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä¸šåŠ¡é€»è¾‘ã€‚è€Œ ZooKeeper é€šè¿‡ä¸´æ—¶èŠ‚ç‚¹å°±èƒ½æ¸…æ™°çŸ¥é“ï¼Œå¦‚æœä¸´æ—¶èŠ‚ç‚¹å­˜åœ¨è¯´æ˜è¿˜åœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœä¸´æ—¶èŠ‚ç‚¹ä¸å­˜åœ¨è¯´æ˜å·²ç»æ‰§è¡Œå®Œæ¯•é‡Šæ”¾é”æˆ–è€…æ˜¯æŒ‚äº†ã€‚ç”±æ­¤çœ‹æ¥ redis å¦‚æœèƒ½åƒ ZooKeeper ä¸€æ ·æ·»åŠ ä¸€äº›ä¸å®¢æˆ·ç«¯ç»‘å®šçš„ä¸´æ—¶é”®ï¼Œä¹Ÿæ˜¯ä¸€å¤§å¥½äº‹ã€‚")]),t._v(" "),a("li",[t._v("æ˜¯å¦å•ç‚¹æ•…éšœï¼šredis æœ¬èº«æœ‰å¾ˆå¤šä¸­ç©æ³•ï¼Œå¦‚å®¢æˆ·ç«¯ä¸€è‡´æ€§ hashï¼ŒæœåŠ¡å™¨ç«¯ sentinel æ–¹æ¡ˆæˆ–è€… cluster æ–¹æ¡ˆï¼Œå¾ˆéš¾åšåˆ°ä¸€ç§åˆ†å¸ƒå¼é”æ–¹å¼èƒ½åº”å¯¹æ‰€æœ‰è¿™äº›æ–¹æ¡ˆã€‚è€Œ ZooKeeper åªæœ‰ä¸€ç§ç©æ³•ï¼Œå¤šå°æœºå™¨çš„èŠ‚ç‚¹æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œæ²¡æœ‰ redis çš„é‚£ä¹ˆå¤šçš„éº»çƒ¦å› ç´ è¦è€ƒè™‘ã€‚")])]),t._v(" "),a("p",[t._v("æ€»ä½“ä¸Šæ¥è¯´ ZooKeeper å®ç°åˆ†å¸ƒå¼é”æ›´åŠ çš„ç®€å•ï¼Œå¯é æ€§æ›´é«˜ã€‚ä½† ZooKeeper å› ä¸ºéœ€è¦é¢‘ç¹çš„åˆ›å»ºå’Œåˆ é™¤èŠ‚ç‚¹ï¼Œæ€§èƒ½ä¸Šä¸å¦‚ Redis æ–¹å¼ã€‚")]),t._v(" "),a("h2",{attrs:{id:"äº”ã€-åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯”"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äº”ã€-åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯”"}},[t._v("#")]),t._v(" äº”ã€ åˆ†å¸ƒå¼é”æ–¹æ¡ˆå¯¹æ¯”")]),t._v(" "),a("p",[t._v("æ•°æ®åº“åˆ†å¸ƒå¼é”ï¼Œé—®é¢˜æ¯”è¾ƒå¤šï¼Œè§£å†³èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œä¸æ¨èã€‚")]),t._v(" "),a("p",[t._v("æ€§èƒ½ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("Redis åˆ†å¸ƒå¼é”ï¼Œå…¶å®"),a("strong",[t._v("éœ€è¦è‡ªå·±ä¸æ–­è‡ªæ—‹å»å°è¯•è·å–é”")]),t._v("ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚")]),t._v(" "),a("li",[t._v("ZooKeeper åˆ†å¸ƒå¼é”ï¼Œè·å–ä¸åˆ°é”ï¼Œæ³¨å†Œä¸ªç›‘å¬å™¨å³å¯ï¼Œä¸éœ€è¦ä¸æ–­ä¸»åŠ¨å°è¯•è·å–é”ï¼Œæ€§èƒ½å¼€é”€è¾ƒå°ã€‚")])]),t._v(" "),a("p",[t._v("å¯é æ€§ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("å¦‚æœæ˜¯ redis è·å–é”çš„é‚£ä¸ªå®¢æˆ·ç«¯å‡ºç° bug æŒ‚äº†ï¼Œé‚£ä¹ˆåªèƒ½ç­‰å¾…è¶…æ—¶æ—¶é—´ä¹‹åæ‰èƒ½é‡Šæ”¾é”ï¼›")]),t._v(" "),a("li",[t._v("è€Œ zk çš„è¯ï¼Œå› ä¸ºåˆ›å»ºçš„æ˜¯ä¸´æ—¶ znodeï¼Œåªè¦å®¢æˆ·ç«¯æŒ‚äº†ï¼Œznode å°±æ²¡äº†ï¼Œæ­¤æ—¶å°±è‡ªåŠ¨é‡Šæ”¾é”ã€‚")])]),t._v(" "),a("p",[t._v("ç»¼ä¸Šåˆ†æï¼Œ"),a("strong",[t._v("ZooKeeper å®ç°åˆ†å¸ƒå¼é”æ›´åŠ çš„ç®€å•ï¼Œå¯é æ€§æ›´é«˜")]),t._v("ã€‚âœ…")]),t._v(" "),a("h2",{attrs:{id:"å‚è€ƒèµ„æ–™"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒèµ„æ–™"}},[t._v("#")]),t._v(" å‚è€ƒèµ„æ–™")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://juejin.im/post/5a20cd8bf265da43163cdd9a",target:"_blank",rel:"noopener noreferrer"}},[t._v("åˆ†å¸ƒå¼é”å®ç°æ±‡æ€»"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/1c5c1a592088",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis å®ç°åˆ†å¸ƒå¼é”ï¼Œä»¥åŠå¯é‡å…¥é”æ€è·¯"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);